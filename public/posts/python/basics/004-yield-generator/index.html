<!DOCTYPE html>
<html lang="en">
<head>
  
    
    <title>Yeild &amp; Generator Python :: 为霜的博客</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="1. Definition yield is a keyword that is used like return, but it will make the function return a generator.
def create_generator(): print(&#34;create_generator&#34;) for i in range(10): yield i ite = create_generator() print(ite) # ite is a generator object for i in ite: print(i) # &lt;generator object create_generator at 0x102d2bdd0&gt; # create_generator # 0 # 1 # 2 When you call a function that contains a yield statement, you get a generator object, but no code runs. Then each time you extract from the generator, Python resumes the function from where it left off (from the yield), runs until the next yield, and then pauses again.
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.jiyi27.com/posts/python/basics/004-yield-generator/" />





  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/categories.min.3202f75cbb294747099af3850a68a09ee94b3ce505fc39e134692d90ff0a9b2a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/code.min.dd73d157e77e82a3dc1cb06ba424cf6cc6811af0bb604ad6c68e70faf2439c8a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/main.min.3fb8954e26342ad3afabb4525959bfec6f9fc0d6929f0dda738ddeee30211690.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/menu.min.8cee75f73b9f9b1e40bd0dd53e6e770156b08bbfe1c579cd256c3f6cd3b6d32b.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/post.min.014a50745fbdd41d5f420a3e288730d5af4b7d90344dc6211d0e50c368b5b303.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/prism.min.b958d3d7c6c67361b945f9062d07d403422604b3d2cd33f93b88d41ed0ba634d.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/term.min.94de320c1b850e126e6d2c88a7c90acf58bb1313f0ea14a14cda2a42f2a88db2.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.jiyi27.com/terminal.css">




<link rel="shortcut icon" href="https://blog.jiyi27.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.jiyi27.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Yeild &amp; Generator Python">
<meta property="og:description" content="1. Definition yield is a keyword that is used like return, but it will make the function return a generator.
def create_generator(): print(&#34;create_generator&#34;) for i in range(10): yield i ite = create_generator() print(ite) # ite is a generator object for i in ite: print(i) # &lt;generator object create_generator at 0x102d2bdd0&gt; # create_generator # 0 # 1 # 2 When you call a function that contains a yield statement, you get a generator object, but no code runs. Then each time you extract from the generator, Python resumes the function from where it left off (from the yield), runs until the next yield, and then pauses again.
" />
<meta property="og:url" content="https://blog.jiyi27.com/posts/python/basics/004-yield-generator/" />
<meta property="og:site_name" content="为霜的博客" />

  <meta property="og:image" content="https://blog.jiyi27.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="python" />


  <meta property="article:published_time" content="2023-11-23 16:04:26 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  
  
  

  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.jiyi27.com/posts/python/basics/004-yield-generator/">Yeild &amp; Generator Python</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-11-23</time><span class="post-reading-time">3 分钟阅读 (627 字数)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.jiyi27.com/tags/python/">python</a>&nbsp;
      
      #<a href="https://blog.jiyi27.com/tags/io/">io</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h2 id="1-definition">1. Definition<a href="#1-definition" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p><code>yield</code> is a keyword that is used like <code>return</code>, but it will make the function return a <strong>generator</strong>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_generator</span>():
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;create_generator&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> i
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ite <span style="color:#f92672">=</span> create_generator()
</span></span><span style="display:flex;"><span>print(ite) <span style="color:#75715e"># ite is a generator object</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ite:
</span></span><span style="display:flex;"><span>    print(i)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># &lt;generator object create_generator at 0x102d2bdd0&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># create_generator</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2</span>
</span></span></code></pre></div><p>When you call a function that contains a <code>yield</code> statement, you get a generator object, but <strong>no code runs</strong>. Then each time you extract from the generator, Python resumes the function from where it left off (from the <code>yield</code>), runs until the next <code>yield</code>, and then pauses again.</p>
<h2 id="2-why-yield">2. Why <code>yield</code><a href="#2-why-yield" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p><strong>Handling Large Data</strong>: If you&rsquo;re working with a large amount of data that doesn&rsquo;t fit into memory, a generator can be a great solution. It allows you to process <strong>one item at a time</strong> rather than loading everything into memory at once.</p>
<blockquote>
<p>Yield is more efficient, memory-wise, and also sometimes execution-wise. If you iterate over a list of 1,000,000 elements, Python has to generate the entire list and store the contents in memory before beginning the first iteration. With a generator (using yield), the elements are created at the time of iteration, so 1,000,000 elements don’t need to be pre-calculated first and stored in memory.</p>
<p>There are other benefits such as using generators with async or performing logic after certain iterations (that generators can potentially give better control over than iterating over a list), but in my opinion the main reason for using them is the memory and processing considerations.</p>
<p><a href="https://www.reddit.com/r/learnpython/comments/rzukrb/comment/hrxetbx/?utm_source=share&amp;utm_medium=web2x&amp;context=3">https://www.reddit.com/r/learnpython/comments/rzukrb/comment/hrxetbx/?utm_source=share&utm_medium=web2x&context=3</a></p>
</blockquote>
<blockquote>
<p>Yep its 99% about memory. First time I used it was when I was working with huge amounts of data from a SQL server. Rather than do analysis on all 100,000,000 lines at once, not joking about how many, I pulled back 10k at a time used yield to send the 10k to the analysis function. Then sent the updated data on to the system that needed it. Used like 20MB of RAM as apposed to like 200GB.</p>
<p><a href="https://www.reddit.com/r/learnpython/comments/rzukrb/comment/hrxhm46/?utm_source=share&amp;utm_medium=web2x&amp;context=3">https://www.reddit.com/r/learnpython/comments/rzukrb/comment/hrxhm46/?utm_source=share&utm_medium=web2x&context=3</a></p>
</blockquote>
<h2 id="3-example">3. Example<a href="#3-example" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="31--read-large-file">3.1.  Read Large File<a href="#31--read-large-file" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>The files range between 1Gb and ~20Gb in length which is too big to read into RAM. So I would like to read the lines in chunks/bins of say 10000 lines at a time so that I can perform calculations on the final column in these bin sizes.</p>
<p>Instead of playing with offsets in the file, try to build and yield lists of 10000 elements from a loop:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">read_large_file</span>(file_handler, block_size<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>):
</span></span><span style="display:flex;"><span>    block <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> file_handler:
</span></span><span style="display:flex;"><span>        block<span style="color:#f92672">.</span>append(line)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(block) <span style="color:#f92672">==</span> block_size:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">yield</span> block
</span></span><span style="display:flex;"><span>            block <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># don&#39;t forget to yield the last block</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> block:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> block
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(path) <span style="color:#66d9ef">as</span> file_handler:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> block <span style="color:#f92672">in</span> read_large_file(file_handler):
</span></span><span style="display:flex;"><span>        print(block)
</span></span></code></pre></div><p>Learn more: <a href="https://stackoverflow.com/questions/49752452/using-a-python-generator-to-process-large-text-files">using a python generator to process large text files - Stack Overflow</a></p>
<h3 id="32-async">3.2. async<a href="#32-async" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Iterator, Any, cast
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> openai <span style="color:#f92672">import</span> OpenAI
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>client <span style="color:#f92672">=</span> OpenAI()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">chat</span>(messages: list, stream: bool) <span style="color:#f92672">-&gt;</span> Iterator[str]:
</span></span><span style="display:flex;"><span>    response_iter <span style="color:#f92672">=</span> cast(
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># The Any type is a special type that represents an unconstrained value</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># and is often used when the type of the value is not known or needs to be dynamically determined.</span>
</span></span><span style="display:flex;"><span>        Any,
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># client.chat.completions.create() won&#39;t return immediately, it will make requests to the API.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># time.sleep(1), you can umcomment this to stimulate the time of the request.</span>
</span></span><span style="display:flex;"><span>        client<span style="color:#f92672">.</span>chat<span style="color:#f92672">.</span>completions<span style="color:#f92672">.</span>create(
</span></span><span style="display:flex;"><span>            messages<span style="color:#f92672">=</span>messages,
</span></span><span style="display:flex;"><span>            stream<span style="color:#f92672">=</span>stream,
</span></span><span style="display:flex;"><span>            model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;gpt-3.5-turbo-1106&#34;</span>,
</span></span><span style="display:flex;"><span>            max_tokens<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> stream:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> response <span style="color:#f92672">in</span> response_iter:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>choices[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>delta<span style="color:#f92672">.</span>content <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>                chunk <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>choices[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>delta<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">yield</span> chunk
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">yield</span> response_iter<span style="color:#f92672">.</span>choices[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>message<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msg <span style="color:#f92672">=</span> [{<span style="color:#e6db74">&#34;role&#34;</span>: <span style="color:#e6db74">&#34;user&#34;</span>, <span style="color:#e6db74">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;Hello, help me write a essay about the history of the United States of America.&#34;</span>}]
</span></span><span style="display:flex;"><span>steam <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>ite <span style="color:#f92672">=</span> chat(msg, steam) <span style="color:#75715e"># async: you will get a generator object, but no code in function chat() runs</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> ite:
</span></span><span style="display:flex;"><span>    print(i, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, flush<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div>
      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">查看其他文章</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.jiyi27.com/posts/python/basics/003-exception-handling/" class="button inline prev">
        Exception Handling Python
      </a>
    
    
      ::
    
    
      <a href="https://blog.jiyi27.com/posts/bugs/008-computer-lab-cannot-access-youtube/" class="button inline next">
        排查实验室电脑无法访问一些网站
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/jiyi27/jiyi27.github.io" target="_blank">Theme</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
