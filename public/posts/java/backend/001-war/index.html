<!DOCTYPE html>
<html lang="en">
<head>
  
    
    <title>手动部署 War 包到 Tomcat 之何为 War :: 为霜的博客</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Web application resources or web application archives are commonly called WAR files. A WAR file is used to deploy a Java EE web application in an application server. Inside a WAR file, all the web components are packed into one single unit. These include JAR files, JavaServer Pages, Java servlets, Java class files, XML files, HTML files, and other resource files that we need for web applications. We can use the Maven WAR plugin to build our project as a WAR file.
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.jiyi27.com/posts/java/backend/001-war/" />





  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/categories.min.3202f75cbb294747099af3850a68a09ee94b3ce505fc39e134692d90ff0a9b2a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/code.min.dd73d157e77e82a3dc1cb06ba424cf6cc6811af0bb604ad6c68e70faf2439c8a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/main.min.3fb8954e26342ad3afabb4525959bfec6f9fc0d6929f0dda738ddeee30211690.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/menu.min.8cee75f73b9f9b1e40bd0dd53e6e770156b08bbfe1c579cd256c3f6cd3b6d32b.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/post.min.014a50745fbdd41d5f420a3e288730d5af4b7d90344dc6211d0e50c368b5b303.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/prism.min.b958d3d7c6c67361b945f9062d07d403422604b3d2cd33f93b88d41ed0ba634d.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/term.min.94de320c1b850e126e6d2c88a7c90acf58bb1313f0ea14a14cda2a42f2a88db2.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.jiyi27.com/terminal.css">




<link rel="shortcut icon" href="https://blog.jiyi27.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.jiyi27.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="手动部署 War 包到 Tomcat 之何为 War">
<meta property="og:description" content="Web application resources or web application archives are commonly called WAR files. A WAR file is used to deploy a Java EE web application in an application server. Inside a WAR file, all the web components are packed into one single unit. These include JAR files, JavaServer Pages, Java servlets, Java class files, XML files, HTML files, and other resource files that we need for web applications. We can use the Maven WAR plugin to build our project as a WAR file.
" />
<meta property="og:url" content="https://blog.jiyi27.com/posts/java/backend/001-war/" />
<meta property="og:site_name" content="为霜的博客" />

  <meta property="og:image" content="https://blog.jiyi27.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="spring boot" />


  <meta property="article:published_time" content="2023-04-27 21:30:48 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  
  
  

  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.jiyi27.com/posts/java/backend/001-war/">手动部署 War 包到 Tomcat 之何为 War</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-04-27</time><span class="post-reading-time">5 分钟阅读 (961 字数)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.jiyi27.com/tags/spring-boot/">spring boot</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <p>Web application resources or web application archives are commonly called WAR files. A WAR file is used to deploy a Java EE web application in an application server. Inside a WAR file, all the web components are packed into one single unit. These include JAR files, JavaServer Pages, Java servlets, Java class files, XML files, HTML files, and other resource files that we need for web applications. We can use the Maven WAR plugin to build our project as a <a href="https://www.baeldung.com/java-jar-war-packaging#war">WAR</a> file.</p>
<h2 id="1-add-a-new-user-with-deployment-rights-to-tomcat">1. Add a new user with deployment rights to Tomcat<a href="#1-add-a-new-user-with-deployment-rights-to-tomcat" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>To perform a Maven Tomcat deploy of a <code>WAR</code> file you must first set up a <strong>user</strong> in Tomcat with the appropriate rights. You can do this with an edit of the <code>tomcat-users.xml</code> file, which can be found in Tomcat&rsquo;s <code>conf</code> sub-directory. Add the following entry <strong>inside</strong> the <code>tomcat-users</code> tag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;user</span> <span style="color:#a6e22e">username=</span><span style="color:#e6db74">&#34;war-deployer&#34;</span> <span style="color:#a6e22e">password=</span><span style="color:#e6db74">&#34;maven-tomcat-plugin&#34;</span> <span style="color:#a6e22e">roles=</span><span style="color:#e6db74">&#34;manager-gui, manager-script, manager-jmx&#34;</span> <span style="color:#f92672">/&gt;</span>
</span></span></code></pre></div><p>Save the tomcat-users.xml file and restart the server to have the changes take effect.</p>
<p>重启Tomcat就是进到Tomcat的<code>bin</code>目录下, 执行<code>startup.sh</code>, <code>./shutdown.sh</code>, 其实你直接使用<code>startup.sh</code>命令开启Tomcat服务就会加载配置文件了, 上面说的重启是默认你的Tomcat一直处于运行状态. 现在你也应该启动Tomcat服务了, 启动后尝试访问<code>http://localhost:8080/</code>,</p>
<p><img src="/war/d.png" alt=""></p>
<p>点击后输入上面的<code>username</code>和对应的<code>password</code>, 即可进入管理页面如下:</p>
<p><img src="/war/e.png" alt=""></p>
<p><strong>无法访问 tomcat 主页问题</strong></p>
<p>我在访问Tomcat主页出现了问题, 访问的总是我以前的JSP应用, 我用IDEA开发的, 但我都没打开IDEA, 仍然可以访问到, 如下:</p>
<p><img src="/war/a.png" alt=""></p>
<p>然后我就<a href="https://www.cnblogs.com/yayazi/p/7920257.html">查到了一个博客</a>说需要将Tomcat的首页的工程部署到Tomcat服务器上，我们通过IDEA来操作, 部署步骤如下：</p>
<p>选择菜单栏“Run&ndash;&gt;Edit Configuration&hellip;&ndash;&gt;Deployment”, 选择右上角绿色“+”，选择“External Source&hellip;”，将Apache-tomcat的<code>webapps</code>目录下的ROOT文件夹添加进来, 下面的Application Context 空着, 删除 <code>ROOT</code> 下面的那个<code>ServletDemo:war exploded</code>, 如下图:</p>
<p><img src="/war/b.png" alt=""></p>
<p>然后我IDEA上选择的Tomcat服务器不是我现在用的, 我有个旧的Tomcat服务器, 我不知道, 然后IDEA用的一直是那个旧的(但我在上面部署位置的<code>ROOT</code>文件夹选择的是新的Tomcat下的文件), 所以就导致就算部署项目后, 我依然无法访问Tomcat的主页. 所以检查一下你是否选择了正确的Tomcat服务器,</p>
<p><img src="/war/c.png" alt=""></p>
<p>这样配置好后再在IDEA点击运行, 就可以通过<code>http://localhost:8080/</code>访问 Tomcat 主页了, 之后你关闭IDEA, 直接进入Tomcat根目录的<code>bin</code>下通过执行<code>startup.sh</code>来启动Tomcat.</p>
<p>有时候你会遇到其他情况, 比如8080端口被占用, 这时候解决办法也很简单</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 查看PID</span>
</span></span><span style="display:flex;"><span>lsof -n -i4TCP:8080 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 删除8080端口对应的PID</span>
</span></span><span style="display:flex;"><span>kill -9 PID
</span></span></code></pre></div><p>说了那么多终于要进行下一步了,</p>
<h2 id="2-tell-maven-about-the-tomcat-deploy-user">2. Tell Maven about the Tomcat deploy user<a href="#2-tell-maven-about-the-tomcat-deploy-user" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>After you add the <code>war-deployer</code> user to Tomcat, register that <code>username</code> and <code>password</code> in Maven, along with a named reference to the server. The Maven-Tomcat plugin will use this information when it tries to <a href="https://www.theserverside.com/feature/Is-Apache-Tomcat-the-right-Java-application-server-for-you">connect to the application server</a>. Edit the <code>settings.xml</code> file and add the following entry <strong>within</strong> the <code>&lt;server&gt;</code> tag to create the named reference to the server:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- Configure the Tomcat Maven plugin user --&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;server&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;id&gt;</span>maven-tomcat-war-deployment-server&gt;<span style="color:#f92672">&lt;/id&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;username&gt;</span>war-deployer<span style="color:#f92672">&lt;/username&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;password&gt;</span>maven-tomcat-plugin<span style="color:#f92672">&lt;/password&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/server&gt;</span>
</span></span></code></pre></div><blockquote>
<p>注意, 上面提到的<code>settings.xml</code>文件在<code>Downloads/apache-maven-3.9.1/conf</code>下, 根据你的maven安装目录查找,</p>
<p>另外这里加的账号密码就是上面在Tomcat添加用户时候的账号密码, 这是因为你进入Tomcat管理页面的时候需要,如果你不提供(下面配置<code>pom.xml</code>也会说到), 那生成war文件的时候maven就会报错,</p>
</blockquote>
<h2 id="3-register-the-tomcat7-maven-plugin-in-the-pom">3. Register the tomcat7-maven-plugin in the POM<a href="#3-register-the-tomcat7-maven-plugin-in-the-pom" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>把打包格式改成<code>war</code>, 即在<code>pom.xml</code>中找到<code>&lt;packaging&gt;</code>标签, 没有的话添加一个, 与<code>&lt;dependencies&gt;</code>标签并列:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;groupId&gt;</span>com.example<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;artifactId&gt;</span>ServletDemo<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;version&gt;</span>1.0-SNAPSHOT<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;name&gt;</span>ServletDemo<span style="color:#f92672">&lt;/name&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;packaging&gt;</span>war<span style="color:#f92672">&lt;/packaging&gt;</span>
</span></span></code></pre></div><p>Now that Maven and Tomcat are configured, the next step is to edit the Java web application&rsquo;s POM file to reference the Tomcat Maven plugin.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;groupId&gt;</span>org.apache.tomcat.maven<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;artifactId&gt;</span>tomcat7-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;version&gt;</span>2.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;url&gt;</span>http://localhost:8080/manager/text<span style="color:#f92672">&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;path&gt;</span>/rps<span style="color:#f92672">&lt;/path&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>运行<code>mvn install tomcat7:deploy</code>生成war的时候总是报错(如果你之前已经生成了War文件, 请记得去Tomcat根目录下的<code>webapp</code>目录下删除一生成的war文件, 否则也会报错, 和下面一样):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> Failed to execute goal org.apache.tomcat.maven:tomcat7-maven-plugin:2.0:deploy <span style="color:#f92672">(</span>default-cli<span style="color:#f92672">)</span> on project ServletDemo: Cannot invoke Tomcat manager: Broken pipe -&gt; <span style="color:#f92672">[</span>Help 1<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> To see the full stack trace of the errors, re-run Maven with the -e switch.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> Re-run Maven using the -X switch to enable full debug logging.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> For more information about the errors and possible solutions, please read the following articles:
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>Help 1<span style="color:#f92672">]</span> http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException
</span></span></code></pre></div><p>加入我们在Tomcat Users里配置的账号密码:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;plugin&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;groupId&gt;</span>org.apache.tomcat.maven<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;artifactId&gt;</span>tomcat7-maven-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;version&gt;</span>2.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;configuration&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;url&gt;</span>http://localhost:8080/manager/text<span style="color:#f92672">&lt;/url&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;path&gt;</span>/rps<span style="color:#f92672">&lt;/path&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;username&gt;</span>war-deployer<span style="color:#f92672">&lt;/username&gt;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#f92672">&lt;password&gt;</span>maven-tomcat-plugin<span style="color:#f92672">&lt;/password&gt;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">&lt;/configuration&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/plugin&gt;</span>
</span></span></code></pre></div><blockquote>
<p>注意: 修改<code>pom.xml</code>后需要更新<code>pom.xml</code></p>
<p>提示: 点击IDEA软件的右上角有个浮动的更新小按钮即更新, 或者你可以查查命令行maven怎么更新<code>pom.xml</code>文件.</p>
</blockquote>
<p>然后重新运行<code>mvn install tomcat7:deploy</code>, 成功:</p>
<p><img src="/war/f.png" alt=""></p>
<p>然后去Tomcat根目录的<code>webapps</code>下查看生成的War, 可以看到生成了名为<code>rps</code>的web应用, 即这个名字取决于上面<code>pom.xml</code>填的内容,</p>
<p><img src="/war/g.png" alt=""></p>
<p>然后我们对比一下生成的war与我们的源代码文件结构:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#源代码</span>
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── pom.xml
</span></span><span style="display:flex;"><span>├── src
</span></span><span style="display:flex;"><span>│   └── main
</span></span><span style="display:flex;"><span>│       ├── java
</span></span><span style="display:flex;"><span>│       │   ├── database
</span></span><span style="display:flex;"><span>│       │   └── servlet
</span></span><span style="display:flex;"><span>│       ├── resources
</span></span><span style="display:flex;"><span>│       │   └── log4j.properties
</span></span><span style="display:flex;"><span>│       └── webapp
</span></span><span style="display:flex;"><span>│           ├── WEB-INF
</span></span><span style="display:flex;"><span>│           ├── hello.jsp
</span></span><span style="display:flex;"><span>│           └── index.jsp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># War</span>
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── META-INF
</span></span><span style="display:flex;"><span>│   ├── MANIFEST.MF
</span></span><span style="display:flex;"><span>│   ├── maven
</span></span><span style="display:flex;"><span>│   │   └── com.example
</span></span><span style="display:flex;"><span>│   │       └── ServletDemo
</span></span><span style="display:flex;"><span>│   └── war-tracker
</span></span><span style="display:flex;"><span>├── WEB-INF
</span></span><span style="display:flex;"><span>│   ├── classes
</span></span><span style="display:flex;"><span>│   │   ├── database
</span></span><span style="display:flex;"><span>│   │   │   ├── Controller.class
</span></span><span style="display:flex;"><span>│   │   │   ├── DataEntity.class
</span></span><span style="display:flex;"><span>│   │   │   ├── Database.class
</span></span><span style="display:flex;"><span>│   │   │   └── MysqlDatabase.class
</span></span><span style="display:flex;"><span>│   │   ├── log4j.properties
</span></span><span style="display:flex;"><span>│   │   ├── servlet
</span></span><span style="display:flex;"><span>│   │   │   ├── GetDataServlet$1.class
</span></span><span style="display:flex;"><span>│   │   │   └── GetDataServlet.class
</span></span><span style="display:flex;"><span>│   │   └── test
</span></span><span style="display:flex;"><span>│   ├── lib
</span></span><span style="display:flex;"><span>│   │   ├── gson-2.9.0.jar
</span></span><span style="display:flex;"><span>│   │   ├── log4j-1.2.17.jar
</span></span><span style="display:flex;"><span>│   │   ├── mysql-connector-j-8.0.32.jar
</span></span><span style="display:flex;"><span>│   │   └── protobuf-java-3.21.9.jar
</span></span><span style="display:flex;"><span>│   └── web.xml
</span></span><span style="display:flex;"><span>├── hello.jsp
</span></span><span style="display:flex;"><span>└── index.jsp
</span></span></code></pre></div><p>对于生成的War文件可以发现所有Java相关的文件都在<code>WEB-INF</code>下, 比如我们编写的Servlet字节码文件和和我们用到的依赖(gson, mysql connector, log4j). 然后仔细看源代码文件结构, 在<code>webapp</code>下也有个<code>WEB-INF</code>, 这下面放的就是我们项目的<code>web.xml</code>, 内容如下(所以这有什么联系呢),</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;web-app</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;4.0&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;welcome-file-list&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;welcome-file&gt;</span>/index.jsp<span style="color:#f92672">&lt;/welcome-file&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/welcome-file-list&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;servlet&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;servlet-name&gt;</span>get-data<span style="color:#f92672">&lt;/servlet-name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;servlet-class&gt;</span>servlet.GetDataServlet<span style="color:#f92672">&lt;/servlet-class&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/servlet&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;servlet-mapping&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;servlet-name&gt;</span>get-data<span style="color:#f92672">&lt;/servlet-name&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;url-pattern&gt;</span>/temperature/*<span style="color:#f92672">&lt;/url-pattern&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;url-pattern&gt;</span>/humidity/*<span style="color:#f92672">&lt;/url-pattern&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/servlet-mapping&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/web-app&gt;</span>
</span></span></code></pre></div><h2 id="4-verify">4. Verify<a href="#4-verify" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>确保你已经开启Tomcat服务(即使你关闭了IDEA, IDEA和Tomcat是两个东西, IDEA是个IDE会用到Tomcat作为web服务器来部署web app), 然后访问通过<code>http://localhost:8080/</code>访问到Tomcat主页, 这时候你可以在链接🔗后加上<code>/rps</code>即<code>http://localhost:8080/rps/</code>就可以进入到你的那个web网页, 如下:</p>
<p><img src="/war/h.png" alt=""></p>
<h2 id="5-思考总结">5. 思考总结<a href="#5-思考总结" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>这时候其实我们也就知道了什么是根目录和url中神秘的路径问题, 你看我们若想访问<code>manager</code>页面, 这个页面的url是<code>http://localhost:8080/manager/</code>, 我们访问我们刚部署的页面是<code>http://localhost:8080/rps/</code>, 你看最后的这个路径及<code>/manager</code>, <code>/rps</code>都是tomcat的<code>webapps</code>目录下的文件, 如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># David @ tc0db in ~/Downloads/Programs/apache-tomcat-9.0.73/webapps</span>
</span></span><span style="display:flex;"><span>$ ls
</span></span><span style="display:flex;"><span>ROOT         examples     manager      rps.war
</span></span><span style="display:flex;"><span>docs         host-manager rps
</span></span></code></pre></div><p>所以<code>webapp</code>就是所谓的根目录, 我们访问什么都是根据它来的, 可以看到, <code>webapps</code>目录下还有<code>examples</code>等文件夹, 所以我们可以直接通过<code>http://localhost:8080/example/</code>访问. 但是又有个问题, Tomcat的主页也就是是<code>http://localhost:8080/</code>具体在哪呢? 按理说<code>webapps</code>下应该有个<code>index.html</code>文件呀, 可是却空空, 这是怎么回事, 怎么没有按我们上面推导的路径来呢?</p>
<p>还记不记得当时学习servlet的时候有个<code>web.xml</code>文件, 我们在这个文件里可以配置个welcome标签, 通过这个标签我们就可以直接指定一个html文件作为我们的主页而不是根目录下的<code>index.tml</code>文件, 同样, Tomcat当然也有这个文件 <code>TOMCAT_HOME/conf/web.xml</code>, 搜索<code>welcome</code>找到啦(在<code>tomcat/webapps/ROOT/index.jsp</code>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- ==================== Default Welcome File List ===================== --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- When a request URI refers to a directory, the default servlet looks  --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- for a &#34;welcome file&#34; within that directory and, if present, to the   --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- corresponding resource URI for display.                              --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- If no welcome files are present, the default servlet either serves a --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- directory listing (see default servlet configuration on how to       --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- customize) or returns a 404 status, depending on the value of the    --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- listings setting.                                                    --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!--                                                                      --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- If you define welcome files in your own application&#39;s web.xml        --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- deployment descriptor, that list *replaces* the list configured      --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- here, so be sure to include any of the default values that you wish  --&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- to use within your application.                                       --&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;welcome-file-list&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;welcome-file&gt;</span>index.html<span style="color:#f92672">&lt;/welcome-file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;welcome-file&gt;</span>index.htm<span style="color:#f92672">&lt;/welcome-file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;welcome-file&gt;</span>index.jsp<span style="color:#f92672">&lt;/welcome-file&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/welcome-file-list&gt;</span>
</span></span></code></pre></div><p>然后怎么覆盖这个home page呢? 刚好看到了下面这个回答, 看来和我们猜想的一样, 如下:</p>
<p>In any web application, there will be a <code>web.xml</code> in the <code>WEB-INF/</code> folder. (别忘了我们之前学习JSP的时候可没少在这个文件夹花时间去配置servlet name和对应的jsp, 每创建一个新的servlet就要在这创建个新的servlet pattern)</p>
<p>If you dont have one in your web app, as it seems to be the case in your folder structure, the default <strong>Tomcat</strong> <code>web.xml</code> is under <code>TOMCAT_HOME/conf/web.xml</code></p>
<p>Either way, the relevant lines of the web.xml are</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;welcome-file-list&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;welcome-file&gt;</span>index.html<span style="color:#f92672">&lt;/welcome-file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;welcome-file&gt;</span>index.htm<span style="color:#f92672">&lt;/welcome-file&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;welcome-file&gt;</span>index.jsp<span style="color:#f92672">&lt;/welcome-file&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/welcome-file-list&gt;</span>
</span></span></code></pre></div><p>so any file matching this pattern when found will be shown as the home page.</p>
<p>In Tomcat, a web.xml setting within your web app will override the default, if present.</p>
<p>Further Reading: <a href="http://wiki.apache.org/tomcat/HowTo#How_do_I_override_the_default_home_page_loaded_by_Tomcat.3F">How do I override the default home page loaded by Tomcat?</a></p>
<p>参考:</p>
<ul>
<li><a href="https://www.theserverside.com/video/Step-by-step-Maven-Tomcat-WAR-file-deploy-example">Step-by-step Maven Tomcat WAR file deploy example | TheServerSide</a></li>
<li><a href="https://juejin.cn/post/7133755807253921829">tomcat启动成功浏览器却无法访问 - 掘金</a></li>
<li><a href="https://stackoverflow.com/a/3976385/16317008">web applications - How does Tomcat find the HOME PAGE of my Web App? - Stack Overflow</a></li>
<li><a href="https://www.baeldung.com/maven-generate-war-file">Generate a WAR File in Maven | Baeldung</a></li>
</ul>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">查看其他文章</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.jiyi27.com/posts/java/backend/003-spring-embedded-tomcat/" class="button inline prev">
        Spring Boot 之何为内嵌 Tomcat
      </a>
    
    
      ::
    
    
      <a href="https://blog.jiyi27.com/posts/bugs/002-bug-domain-with-two-ip/" class="button inline next">
        Cloudflare 代理无法通过域名解析出 IP 问题
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/jiyi27/jiyi27.github.io" target="_blank">Theme</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
