<!DOCTYPE html>
<html lang="en">
<head>
  
    
    <title>左值和右值 :: 为霜的博客</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="经常看到左值右值, 刚好有讲到, 摘取一些记录在这, 原文: 9.2 — Value categories (lvalues and rvalues) – Learn C&#43;&#43;
1. Rvalue expression vs Lvalue expression 1.1. The properties of an expression To help determine how expressions should evaluate and where they can be used, all expressions in C&#43;&#43; have two properties: a type and a value category.
1.2. The type of an expression The type of an expression is equivalent to the type of the value, object, or function that results from the evaluated expression. For example:
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.jiyi27.com/posts/cpp/009-lvalue-rvalue/" />





  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/categories.min.3202f75cbb294747099af3850a68a09ee94b3ce505fc39e134692d90ff0a9b2a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/code.min.dd73d157e77e82a3dc1cb06ba424cf6cc6811af0bb604ad6c68e70faf2439c8a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/main.min.3fb8954e26342ad3afabb4525959bfec6f9fc0d6929f0dda738ddeee30211690.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/menu.min.8cee75f73b9f9b1e40bd0dd53e6e770156b08bbfe1c579cd256c3f6cd3b6d32b.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/post.min.014a50745fbdd41d5f420a3e288730d5af4b7d90344dc6211d0e50c368b5b303.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/prism.min.b958d3d7c6c67361b945f9062d07d403422604b3d2cd33f93b88d41ed0ba634d.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/term.min.94de320c1b850e126e6d2c88a7c90acf58bb1313f0ea14a14cda2a42f2a88db2.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.jiyi27.com/terminal.css">




<link rel="shortcut icon" href="https://blog.jiyi27.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.jiyi27.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="左值和右值">
<meta property="og:description" content="经常看到左值右值, 刚好有讲到, 摘取一些记录在这, 原文: 9.2 — Value categories (lvalues and rvalues) – Learn C&#43;&#43;
1. Rvalue expression vs Lvalue expression 1.1. The properties of an expression To help determine how expressions should evaluate and where they can be used, all expressions in C&#43;&#43; have two properties: a type and a value category.
1.2. The type of an expression The type of an expression is equivalent to the type of the value, object, or function that results from the evaluated expression. For example:
" />
<meta property="og:url" content="https://blog.jiyi27.com/posts/cpp/009-lvalue-rvalue/" />
<meta property="og:site_name" content="为霜的博客" />

  <meta property="og:image" content="https://blog.jiyi27.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="c&#43;&#43;" />


  <meta property="article:published_time" content="2023-05-17 11:27:07 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  
  
  

  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.jiyi27.com/posts/cpp/009-lvalue-rvalue/">左值和右值</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-05-17</time><span class="post-reading-time">5 分钟阅读 (944 字数)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.jiyi27.com/tags/c&#43;&#43;/">c&#43;&#43;</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <p>经常看到左值右值, 刚好有讲到, 摘取一些记录在这, 原文: <a href="https://www.learncpp.com/cpp-tutorial/value-categories-lvalues-and-rvalues/">9.2 — Value categories (lvalues and rvalues) – Learn C++</a></p>
<h2 id="1-rvalue-expression-vs-lvalue-expression">1. Rvalue expression vs Lvalue expression<a href="#1-rvalue-expression-vs-lvalue-expression" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="11-the-properties-of-an-expression">1.1. The properties of an expression<a href="#11-the-properties-of-an-expression" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>To help determine how expressions should evaluate and where they can be used, all expressions in C++ have two properties: a type and a value category.</p>
<h3 id="12-the-type-of-an-expression">1.2. The type of an expression<a href="#12-the-type-of-an-expression" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>The type of an expression is equivalent to the type of the value, object, or function that results from the evaluated expression. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">auto</span> v1 { <span style="color:#ae81ff">12</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span> }; <span style="color:#75715e">// int / int =&gt; int
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">auto</span> v2 { <span style="color:#ae81ff">12.0</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span> }; <span style="color:#75715e">// double / int =&gt; double
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><blockquote>
<p>Note that the type of an expression must be determinable at compile time (otherwise type checking and type deduction wouldn’t work) &ndash; however, the value of an expression may be determined at either compile time (if the expression is constexpr) or runtime (if the expression is not constexpr).</p>
</blockquote>
<h3 id="13-the-value-category-of-an-expression">1.3. The value category of an expression<a href="#13-the-value-category-of-an-expression" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Now consider the following program:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x{};
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>; <span style="color:#75715e">// valid: we can assign 5 to x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#ae81ff">5</span> <span style="color:#f92672">=</span> x; <span style="color:#75715e">// error: can not assign value of x to literal value 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>How does the compiler know which expressions can legally appear on either side of an assignment statement?</p>
<p>The answer lies in the second property of expressions: the <code>value category</code>. The <strong>value category</strong> of an expression (or subexpression) indicates whether an expression resolves to a value, a function, or an object of some kind.</p>
<p>Prior to C++11, there were only two possible value categories: <code>lvalue</code> and <code>rvalue</code>.</p>
<p>In C++11, three additional value categories (<code>glvalue</code>, <code>prvalue</code>, and <code>xvalue</code>) were added to support a new feature called <code>move semantics</code>.</p>
<h3 id="14-lvalue-and-rvalue-expressions">1.4. <strong>Lvalue and rvalue expressions</strong><a href="#14-lvalue-and-rvalue-expressions" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>An <strong>lvalue</strong> (pronounced “ell-value”) is an expression that evaluates to an identifiable object or function (or bit-field).</p>
<p>Entities (such as an object or function) with identities can be accessed via an identifier, reference, or pointer, and typically have a lifetime longer than a single expression or statement. 这里的identifier就是变量名和reference, pointer并列. 比如<code>int x = 3; </code>, <code>x</code>就是identifier, <code>3</code>就是object.</p>
<p>An <strong>rvalue</strong> (pronounced “arr-value”) is an expression that is not an l-value. Commonly seen rvalues include literals (except C-style string literals, which are lvalues) and the return value of functions and operators. Rvalues aren’t identifiable (meaning they have to be used immediately), and only exist within the scope of the expression in which they are used.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">return5</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x{ <span style="color:#ae81ff">5</span> }; <span style="color:#75715e">// 5 is an rvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">double</span> d{ <span style="color:#ae81ff">1.2</span> }; <span style="color:#75715e">// 1.2 is an rvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> y { x }; <span style="color:#75715e">// x is a modifiable lvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">double</span> e { d }; <span style="color:#75715e">// d is a non-modifiable lvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> z { return5() }; <span style="color:#75715e">// return5() is an rvalue expression (since the result is returned by value)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> w { x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> }; <span style="color:#75715e">// x + 1 is an rvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> q { <span style="color:#66d9ef">static_cast</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span>(d) }; <span style="color:#75715e">// the result of static casting d to an int is an rvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>You may be wondering why <code>return5()</code>, <code>x + 1</code>, and <code>static_cast&lt;int&gt;(d)</code> are rvalues: the answer is these expressions produce temporary values that are not identifiable objects.</p>
<p>Now we can answer the question about why <code>x = 5</code> is valid but <code>5 = x</code> is not: an assignment operation requires the <strong>left operand</strong> of the assignment to be a modifiable lvalue expression, and the <strong>right operand</strong> to be an rvalue expression. The latter assignment (<code>5 = x</code>) fails because the left operand expression <code>5</code> isn’t an lvalue. 这里说一下, 原文中提到lvalue expression又分为modifiable和non-modifiable, 后者就是加上<code>const</code>修饰的, 感兴趣可以去原文查看,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x{};
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Assignment requires the left operand to be a modifiable lvalue expression and the right operand to be an rvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    x <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>; <span style="color:#75715e">// valid: x is a modifiable lvalue expression and 5 is an rvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#ae81ff">5</span> <span style="color:#f92672">=</span> x; <span style="color:#75715e">// error: 5 is an rvalue expression and x is a modifiable lvalue expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="15-l-value-to-r-value-conversion">1.5. l-value to r-value conversion<a href="#15-l-value-to-r-value-conversion" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>We said above that the assignment operator expects the right operand to be an rvalue expression, so why does code like this work?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> x{ <span style="color:#ae81ff">1</span> };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> y{ <span style="color:#ae81ff">2</span> };
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> y; <span style="color:#75715e">// y is a modifiable lvalue, not an rvalue, but this is legal
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>The answer is because lvalues will implicitly convert to rvalues, so an lvalue can be used wherever an rvalue is required.</p>
<h2 id="2-lvalue-reference-variables">2. Lvalue reference variables<a href="#2-lvalue-reference-variables" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Modern C++ contains two types of references: <code>lvalue references</code>, and <code>rvalue references</code>. Rvalue references are covered in the chapter on <code>move semantics</code> (<a href="https://www.learncpp.com/#ChapterM">chapter M</a>).</p>
<p>An <strong>lvalue reference</strong> (commonly just called a <code>reference</code> since prior to C++11 there was only one type of reference) acts as an alias for an existing lvalue (such as a variable). 说白了我们平时使用的引用都是lvalue reference,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">int</span>      <span style="color:#75715e">// a normal int type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span><span style="color:#f92672">&amp;</span>     <span style="color:#75715e">// an lvalue reference to an int object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">double</span><span style="color:#f92672">&amp;</span>  <span style="color:#75715e">// an lvalue reference to a double object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x { <span style="color:#ae81ff">5</span> };    <span style="color:#75715e">// x is a normal integer variable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span><span style="color:#f92672">&amp;</span> ref { x }; <span style="color:#75715e">// ref is an lvalue reference variable that can now be used as an alias for variable x
</span></span></span></code></pre></div><h3 id="21-dangling-references">2.1. Dangling references<a href="#21-dangling-references" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>When an object being referenced is destroyed before a reference to it, the reference is left referencing an object that no longer exists. Such a reference is called a <strong>dangling reference</strong>. Accessing a dangling reference leads to undefined behavior.</p>
<h2 id="3-总结">3. 总结<a href="#3-总结" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<ul>
<li>assignment operation, left operand, right operand</li>
<li>rvalue expression, lvalue expression, modifiable lvalue expression, non-modifiable lvalue expression</li>
<li>value category of an expression,  type of an expression</li>
<li>lvalue references, and rvalue references</li>
<li>dangling reference</li>
</ul>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">查看其他文章</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.jiyi27.com/posts/golang/practice/001-snake-game/" class="button inline prev">
        用 Go 实现一个简单的贪吃蛇
      </a>
    
    
      ::
    
    
      <a href="https://blog.jiyi27.com/posts/cpp/003-class-definition/" class="button inline next">
        C&#43;&#43; Class Definition Rules
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/jiyi27/jiyi27.github.io" target="_blank">Theme</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
