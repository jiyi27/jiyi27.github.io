<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Mongodb on ä¸ºéœœçš„åšå®¢</title>
    <link>https://blog.jiyi27.com/tags/mongodb/</link>
    <description>Recent content in Mongodb on ä¸ºéœœçš„åšå®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <lastBuildDate>Sat, 19 Apr 2025 22:20:18 +0000</lastBuildDate><atom:link href="https://blog.jiyi27.com/tags/mongodb/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>MongoDB èšåˆç®¡é“</title>
      <link>https://blog.jiyi27.com/posts/database/mongodb/004-mongodb%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/</link>
      <pubDate>Sat, 19 Apr 2025 22:20:18 +0000</pubDate>
      
      <guid>https://blog.jiyi27.com/posts/database/mongodb/004-mongodb%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0/</guid>
      <description>&lt;h2 id=&#34;1-ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜&#34;&gt;1. ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜&lt;/h2&gt;
&lt;h3 id=&#34;11-æ™®é€šæŸ¥è¯¢&#34;&gt;1.1. æ™®é€šæŸ¥è¯¢&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; posts = &lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt; _postModel.Find(_ =&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;).ToListAsync();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;List&amp;lt;CommentModel&amp;gt; allComments = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; List&amp;lt;CommentModel&amp;gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;foreach&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; post &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; posts)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (post.CommentList != &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; post.CommentList.Any())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        allComments.AddRange(post.CommentList);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; allComments;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â—1. &lt;strong&gt;ä¼ è¾“çš„æ•°æ®ä½“ç§¯å¤§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ToListAsync()&lt;/code&gt; ä¼šæŠŠ&lt;strong&gt;æ•´æ¡æ–‡æ¡£åŠ è½½è¿›å†…å­˜&lt;/strong&gt;ï¼ŒåŒ…æ‹¬å¸–å­å†…å®¹ã€æ ‡é¢˜ã€æ ‡ç­¾ã€å›¾ç‰‡ç­‰ä¸€å †æ— å…³å­—æ®µ&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚æ¯ä¸ªå¸–å­ 1MBï¼Œ1000 ä¸ªå¸–å­å°±æ˜¯ 1GB ç½‘ç»œä¼ è¾“é‡ï¼Œå“ªæ€•ä½ åªè¦å…¶ä¸­çš„è¯„è®º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â—2. &lt;strong&gt;å†…å­˜å ç”¨é«˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰æ•°æ®éƒ½æ‹‰è¿›å†…å­˜ï¼Œå“ªæ€•ä½ åªå…³å¿ƒé‡Œé¢ä¸€å°å—æ•°æ®ï¼ˆæ¯”å¦‚ &lt;code&gt;CommentList&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¯¹äºå¤§é›†åˆã€é«˜å¹¶å‘æœåŠ¡ï¼Œè¿™ä¼šé€ æˆä¸¥é‡çš„èµ„æºæ¶ˆè€—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â—3. &lt;strong&gt;å¤„ç†é€»è¾‘å†™åœ¨ä»£ç å±‚ï¼Œæ•ˆç‡ä½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ è¦åœ¨ C# å±‚æ‰‹åŠ¨æ‹†è§£ã€éå†ã€ç»„åˆè¿™äº›æ•°æ®ï¼Œç›¸å½“äºè‡ªå·±åœ¨æ¨¡æ‹Ÿæ•°æ®åº“çš„å·¥ä½œï¼Œæ€§èƒ½è¿œä¸å¦‚æ•°æ®åº“åŸç”Ÿæ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;12-èšåˆæŸ¥è¯¢&#34;&gt;1.2. èšåˆæŸ¥è¯¢&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; pipeline = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument[]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬ä¸€æ­¥ï¼šå±•å¼€ CommentList æ•°ç»„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å¯¹æ¯ä¸ª Post æ–‡æ¡£ï¼Œå°† CommentList ä¸­çš„æ¯æ¡è¯„è®ºéƒ½â€œæ‹†å¼€â€ï¼Œæ¯æ¡è¯„è®ºå•ç‹¬å½¢æˆä¸€æ¡æ–‡æ¡£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$unwind&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;path&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .Add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;preserveNullAndEmptyArrays&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;)), &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœ CommentList æ˜¯ null æˆ–ç©ºæ•°ç»„ï¼Œåˆ™è·³è¿‡è¯¥æ–‡æ¡£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬äºŒæ­¥ï¼šæŠ•å½±å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—æ®µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æˆ‘ä»¬åªè¦è¯„è®ºå†…å®¹ï¼ŒæŠŠå®ƒåŒ…è£…æˆ &amp;#34;comment&amp;#34; å­—æ®µï¼ŒåŒæ—¶å»æ‰ _id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$project&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// ä¸è¦ MongoDB çš„ ObjectId å­—æ®µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .Add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;comment&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt;)), &lt;span style=&#34;color:#75715e&#34;&gt;// æŠŠ CommentList çš„å½“å‰é¡¹å‘½åä¸º comment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬ä¸‰æ­¥ï¼šæŠŠ comment ä½œä¸ºæ ¹èŠ‚ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æŠŠæ•´æ¡æ–‡æ¡£æ›¿æ¢ä¸º comment å­—æ®µçš„å†…å®¹ï¼Œç›¸å½“äºå»æ‰äº†å¤–å±‚åŒ…è£¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$replaceRoot&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;newRoot&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$comment&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// æ‰§è¡Œèšåˆç®¡é“ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ç»„ CommentModel ç±»å‹çš„åˆ—è¡¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; comments = &lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt; _postModel.Aggregate&amp;lt;CommentModel&amp;gt;(pipeline).ToListAsync();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; comments;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;âœ…1. &lt;strong&gt;åªå–éœ€è¦çš„æ•°æ®&lt;/strong&gt;&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;1-ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜&#34;&gt;1. ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜&lt;/h2&gt;
&lt;h3 id=&#34;11-æ™®é€šæŸ¥è¯¢&#34;&gt;1.1. æ™®é€šæŸ¥è¯¢&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; posts = &lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt; _postModel.Find(_ =&amp;gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;).ToListAsync();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;List&amp;lt;CommentModel&amp;gt; allComments = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; List&amp;lt;CommentModel&amp;gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;foreach&lt;/span&gt; (&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; post &lt;span style=&#34;color:#66d9ef&#34;&gt;in&lt;/span&gt; posts)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; (post.CommentList != &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; post.CommentList.Any())
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        allComments.AddRange(post.CommentList);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; allComments;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â—1. &lt;strong&gt;ä¼ è¾“çš„æ•°æ®ä½“ç§¯å¤§&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;ToListAsync()&lt;/code&gt; ä¼šæŠŠ&lt;strong&gt;æ•´æ¡æ–‡æ¡£åŠ è½½è¿›å†…å­˜&lt;/strong&gt;ï¼ŒåŒ…æ‹¬å¸–å­å†…å®¹ã€æ ‡é¢˜ã€æ ‡ç­¾ã€å›¾ç‰‡ç­‰ä¸€å †æ— å…³å­—æ®µ&lt;/li&gt;
&lt;li&gt;æ¯”å¦‚æ¯ä¸ªå¸–å­ 1MBï¼Œ1000 ä¸ªå¸–å­å°±æ˜¯ 1GB ç½‘ç»œä¼ è¾“é‡ï¼Œå“ªæ€•ä½ åªè¦å…¶ä¸­çš„è¯„è®º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â—2. &lt;strong&gt;å†…å­˜å ç”¨é«˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰æ•°æ®éƒ½æ‹‰è¿›å†…å­˜ï¼Œå“ªæ€•ä½ åªå…³å¿ƒé‡Œé¢ä¸€å°å—æ•°æ®ï¼ˆæ¯”å¦‚ &lt;code&gt;CommentList&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å¯¹äºå¤§é›†åˆã€é«˜å¹¶å‘æœåŠ¡ï¼Œè¿™ä¼šé€ æˆä¸¥é‡çš„èµ„æºæ¶ˆè€—&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â—3. &lt;strong&gt;å¤„ç†é€»è¾‘å†™åœ¨ä»£ç å±‚ï¼Œæ•ˆç‡ä½&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½ è¦åœ¨ C# å±‚æ‰‹åŠ¨æ‹†è§£ã€éå†ã€ç»„åˆè¿™äº›æ•°æ®ï¼Œç›¸å½“äºè‡ªå·±åœ¨æ¨¡æ‹Ÿæ•°æ®åº“çš„å·¥ä½œï¼Œæ€§èƒ½è¿œä¸å¦‚æ•°æ®åº“åŸç”Ÿæ“ä½œ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;12-èšåˆæŸ¥è¯¢&#34;&gt;1.2. èšåˆæŸ¥è¯¢&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; pipeline = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument[]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬ä¸€æ­¥ï¼šå±•å¼€ CommentList æ•°ç»„&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// å¯¹æ¯ä¸ª Post æ–‡æ¡£ï¼Œå°† CommentList ä¸­çš„æ¯æ¡è¯„è®ºéƒ½â€œæ‹†å¼€â€ï¼Œæ¯æ¡è¯„è®ºå•ç‹¬å½¢æˆä¸€æ¡æ–‡æ¡£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$unwind&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;path&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .Add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;preserveNullAndEmptyArrays&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;)), &lt;span style=&#34;color:#75715e&#34;&gt;// å¦‚æœ CommentList æ˜¯ null æˆ–ç©ºæ•°ç»„ï¼Œåˆ™è·³è¿‡è¯¥æ–‡æ¡£&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬äºŒæ­¥ï¼šæŠ•å½±å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—æ®µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æˆ‘ä»¬åªè¦è¯„è®ºå†…å®¹ï¼ŒæŠŠå®ƒåŒ…è£…æˆ &amp;#34;comment&amp;#34; å­—æ®µï¼ŒåŒæ—¶å»æ‰ _id&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$project&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;) &lt;span style=&#34;color:#75715e&#34;&gt;// ä¸è¦ MongoDB çš„ ObjectId å­—æ®µ&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            .Add(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;comment&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt;)), &lt;span style=&#34;color:#75715e&#34;&gt;// æŠŠ CommentList çš„å½“å‰é¡¹å‘½åä¸º comment&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// ç¬¬ä¸‰æ­¥ï¼šæŠŠ comment ä½œä¸ºæ ¹èŠ‚ç‚¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// æŠŠæ•´æ¡æ–‡æ¡£æ›¿æ¢ä¸º comment å­—æ®µçš„å†…å®¹ï¼Œç›¸å½“äºå»æ‰äº†å¤–å±‚åŒ…è£¹&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$replaceRoot&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; BsonDocument(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;newRoot&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$comment&amp;#34;&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;};
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// æ‰§è¡Œèšåˆç®¡é“ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ç»„ CommentModel ç±»å‹çš„åˆ—è¡¨&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; comments = &lt;span style=&#34;color:#66d9ef&#34;&gt;await&lt;/span&gt; _postModel.Aggregate&amp;lt;CommentModel&amp;gt;(pipeline).ToListAsync();
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; comments;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;âœ…1. &lt;strong&gt;åªå–éœ€è¦çš„æ•°æ®&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;èšåˆç®¡é“ä¸­ç”¨ &lt;code&gt;$project&lt;/code&gt; å’Œ &lt;code&gt;$replaceRoot&lt;/code&gt; ç²¾ç¡®è¿‡æ»¤å‡ºã€Œä½ æƒ³è¦çš„å­—æ®µã€ï¼Œå‡å°‘ç½‘ç»œè´Ÿæ‹…&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;âœ…2. &lt;strong&gt;ç”±æ•°æ®åº“é«˜æ•ˆå¤„ç†æ•°æ®ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MongoDB å†…éƒ¨åšå±•å¼€ã€æ˜ å°„ã€è¿‡æ»¤ï¼Œä½¿ç”¨åŸç”Ÿçš„ C++ å¼•æ“ï¼Œé€Ÿåº¦è¿œè¿œå¿«äº C# éå†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;âœ…3. &lt;strong&gt;èŠ‚çœå†…å­˜ä¸è®¡ç®—èµ„æº&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸éœ€è¦æŠŠæ•´æ¡å¤§æ–‡æ¡£æ‹‰è¿›æ¥ï¼Œåªéœ€è¦ä» MongoDB æ‹¿ä½ æƒ³è¦çš„éƒ¨åˆ†ï¼ŒC# å±‚ä»£ç ä¹Ÿå˜å¾—éå¸¸è½»é‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;âœ…4. &lt;strong&gt;å¯ä»¥åœ¨èšåˆä¸­åšæ›´å¤æ‚æ“ä½œ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æƒ³åšæ’åºã€è¿‡æ»¤ã€åˆ†é¡µç­‰æ“ä½œï¼Ÿèšåˆæ”¯æŒ &lt;code&gt;$match&lt;/code&gt;ã€&lt;code&gt;$sort&lt;/code&gt;ã€&lt;code&gt;$limit&lt;/code&gt;ï¼Œè®©æ•°æ®åº“å¸®ä½ å®Œæˆè¿™äº›é€»è¾‘&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;2-unwind-project-replaceroot&#34;&gt;2. &lt;code&gt;unwind&lt;/code&gt;, &lt;code&gt;project&lt;/code&gt;, &lt;code&gt;replaceRoot&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„èšåˆç®¡é“ä¸­, æˆ‘ä»¬ç”¨äº†:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;$unwind&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;$project&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;comment&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;$replaceRoot&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;newRoot&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$comment&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;MongoDB ä¼šæŠŠæ¯ä¸ªè¯„è®ºéƒ½&lt;strong&gt;å•ç‹¬å±•å¼€æˆä¸€æ¡ç»“æœæ–‡æ¡£&lt;/strong&gt;ï¼Œåƒè¿™æ ·ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;[
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  { &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å°æ˜&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å†™å¾—ä¸é”™&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CreatedAt&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  { &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;å°çº¢&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;é¡¶ä¸€ä¸ª&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;CreatedAt&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;...&amp;#34;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ...
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯æ¡ç»“æœå°±æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ &lt;code&gt;CommentModel&lt;/code&gt;ï¼Œæ‰€ä»¥ï¼šèšåˆåè¿”å›çš„æ¯ä¸€æ¡è®°å½•æ˜¯ä¸€ä¸ª &lt;code&gt;CommentModel&lt;/code&gt; å®ä¾‹ï¼Œç»„æˆçš„æ•´ä½“å°±æ˜¯ä¸€ä¸ª &lt;code&gt;List&amp;lt;CommentModel&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸€ä¸ªå¸–å­é›†åˆ &lt;code&gt;posts&lt;/code&gt;ï¼Œæ¯æ¡æ–‡æ¡£ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;post1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;MongoDB èšåˆç¤ºä¾‹&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;CommentList&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nice post!&amp;#34;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bob&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;I agree!&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ç›®æ ‡æ˜¯ï¼šä»æ•´ä¸ª posts é›†åˆä¸­ï¼Œ&lt;strong&gt;æå–å‡ºæ¯ä¸€æ¡ç‹¬ç«‹çš„è¯„è®ºï¼ˆCommentModelï¼‰&lt;/strong&gt;ï¼Œä¸å¸¦å…¶ä»–å­—æ®µ&lt;/p&gt;
&lt;h3 id=&#34;21-ç¬¬ä¸€æ­¥-unwind--å±•å¼€æ•°ç»„å­—æ®µ&#34;&gt;2.1. ç¬¬ä¸€æ­¥ &lt;code&gt;$unwind&lt;/code&gt; â€”â€” &lt;strong&gt;å±•å¼€æ•°ç»„å­—æ®µ&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;âœ… è¯­æ³•ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{ &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$unwind&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;path&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;preserveNullAndEmptyArrays&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt; } }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;âœ… å‚æ•°è§£é‡Šï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;path&lt;/code&gt;: è¦å±•å¼€çš„æ•°ç»„å­—æ®µï¼Œ&lt;strong&gt;å¿…é¡»æ˜¯æ•°ç»„&lt;/strong&gt;ï¼ˆè¿™é‡Œæ˜¯ &lt;code&gt;CommentList&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;preserveNullAndEmptyArrays&lt;/code&gt;: æ˜¯å¦ä¿ç•™ç©ºæ•°ç»„æˆ–ä¸å­˜åœ¨è¯¥å­—æ®µçš„æ–‡æ¡£
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;false&lt;/code&gt; è¡¨ç¤ºä¸ä¿ç•™ï¼ˆåªå¤„ç†æœ‰è¯„è®ºçš„æ–‡æ¡£ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;âœ… æ•ˆæœï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªæ–‡æ¡£ä¸­çš„ &lt;code&gt;CommentList&lt;/code&gt; æ˜¯ä¸€ä¸ªæ•°ç»„, å®ƒä¼š&lt;strong&gt;æŠŠæ•°ç»„é‡Œçš„æ¯ä¸ªå…ƒç´ æ‹†åˆ†ä¸ºä¸€æ¡æ–°çš„æ–‡æ¡£&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ğŸ” åŸå§‹æ•°æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;post1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;CommentList&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nice post!&amp;#34;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bob&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;I agree!&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ğŸ“¤ ç»è¿‡ &lt;code&gt;$unwind&lt;/code&gt; åå˜æˆä¸¤æ¡è®°å½•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;post1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;CommentList&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nice post!&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;post1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;CommentList&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Bob&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;I agree!&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯æ¡ç»“æœéƒ½åªåŒ…å«&lt;strong&gt;ä¸€ä¸ªè¯„è®ºå¯¹è±¡&lt;/strong&gt;åœ¨ &lt;code&gt;CommentList&lt;/code&gt; å­—æ®µä¸­ï¼ˆå·²ç»ä¸æ˜¯æ•°ç»„äº†ï¼‰&lt;/p&gt;
&lt;h3 id=&#34;22-ç¬¬äºŒæ­¥-project--ä¿ç•™æˆ‘ä»¬å…³å¿ƒçš„å­—æ®µå¹¶é‡æ–°å‘½å&#34;&gt;2.2. ç¬¬äºŒæ­¥ &lt;code&gt;$project&lt;/code&gt; â€”â€” &lt;strong&gt;ä¿ç•™æˆ‘ä»¬å…³å¿ƒçš„å­—æ®µï¼Œå¹¶é‡æ–°å‘½å&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;âœ… è¯­æ³•ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{ &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$project&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;comment&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$CommentList&amp;#34;&lt;/span&gt; } }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;âœ… å‚æ•°è§£é‡Šï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;_id: 0&lt;/code&gt;ï¼šä¸æ˜¾ç¤º MongoDB é»˜è®¤çš„ &lt;code&gt;_id&lt;/code&gt; å­—æ®µ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;&amp;quot;comment&amp;quot;: &amp;quot;$CommentList&amp;quot;&lt;/code&gt;ï¼šæŠŠ &lt;code&gt;CommentList&lt;/code&gt; å­—æ®µçš„å†…å®¹èµ‹å€¼ç»™ä¸€ä¸ªæ–°å­—æ®µ &lt;code&gt;comment&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ğŸ” ä¸Šä¸€æ­¥è¾“å‡ºï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;post1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;CommentList&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nice post!&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ğŸ“¤ å˜æˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;comment&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nice post!&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ğŸ’¡ æˆ‘ä»¬åªä¿ç•™äº†è¯„è®ºè¿™éƒ¨åˆ†æ•°æ®ï¼Œå­—æ®µåå˜æˆäº† &lt;code&gt;comment&lt;/code&gt;ï¼Œ&lt;strong&gt;æ›´å¥½å¤„ç†ä¸‹ä¸€æ­¥çš„ç»“æ„å˜æ¢&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;23-ç¬¬ä¸‰æ­¥-replaceroot--è®©-comment-æˆä¸ºæ–°æ–‡æ¡£çš„æ ¹éƒ¨&#34;&gt;2.3. ç¬¬ä¸‰æ­¥ &lt;code&gt;$replaceRoot&lt;/code&gt; â€”â€” &lt;strong&gt;è®© comment æˆä¸ºæ–°æ–‡æ¡£çš„æ ¹éƒ¨&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;âœ… è¯­æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{ &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;$replaceRoot&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;newRoot&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;$comment&amp;#34;&lt;/span&gt; } }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;âœ… å‚æ•°è§£é‡Š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;newRoot&lt;/code&gt;: ç”¨å“ªä¸ªå­—æ®µçš„å€¼&lt;strong&gt;æ›¿æ¢æ‰å½“å‰æ–‡æ¡£çš„æ ¹&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ğŸ” ä¸Šä¸€æ­¥è¾“å‡ºï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;comment&amp;#34;&lt;/span&gt;: { &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nice post!&amp;#34;&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ğŸ“¤ å˜æˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Author&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Content&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Nice post!&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ğŸ’¡ &lt;code&gt;comment&lt;/code&gt; å­—æ®µé‡Œçš„å†…å®¹è¢«&lt;strong&gt;æå–æˆäº†é¡¶å±‚å­—æ®µ&lt;/strong&gt;ï¼Œæ­£æ˜¯ä½ æœ€ç»ˆæƒ³è¦çš„ç»“æ„ï¼šä¸€ä¸ªå¹²å‡€çš„ &lt;code&gt;CommentModel&lt;/code&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>BSON JSON åºåˆ—åŒ– ååºåˆ—åŒ–</title>
      <link>https://blog.jiyi27.com/posts/database/mongodb/003-bson-json-%E5%BA%8F%E5%88%97%E5%8C%96/</link>
      <pubDate>Wed, 16 Apr 2025 21:32:19 +0000</pubDate>
      
      <guid>https://blog.jiyi27.com/posts/database/mongodb/003-bson-json-%E5%BA%8F%E5%88%97%E5%8C%96/</guid>
      <description>&lt;h2 id=&#34;1-jsonnet--newtonsoftjson&#34;&gt;1. Json.NET  (Newtonsoft.Json)&lt;/h2&gt;
&lt;p&gt;éå¸¸æµè¡Œçš„å¼€æº .NET åº“ï¼Œç”¨äºå¤„ç† JSON æ•°æ®ï¼Œå®ƒåœ¨ .NET ç¤¾åŒºä¸­å¹¿ä¸ºäººçŸ¥ï¼Œå› æ­¤å¾ˆå¤šäººç›´æ¥ç§°å®ƒä¸º Json.NETï¼Œè€Œä¸æ˜¯å®Œæ•´çš„å‘½åç©ºé—´ &lt;code&gt;Newtonsoft.Json&lt;/code&gt;ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç±»å’Œæ–¹æ³•ï¼Œç”¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–&lt;/strong&gt;ï¼šå°† C# å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ååºåˆ—åŒ–&lt;/strong&gt;ï¼šå°† JSON å­—ç¬¦ä¸²è½¬æ¢å› C# å¯¹è±¡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰åºåˆ—åŒ–&lt;/strong&gt;ï¼šé€šè¿‡ç‰¹æ€§ï¼ˆå¦‚ &lt;code&gt;[JsonConverter]&lt;/code&gt;ï¼‰æˆ–é…ç½®ï¼Œå…è®¸å¼€å‘è€…æ§åˆ¶ JSON çš„æ ¼å¼å’Œè¡Œä¸º&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; person = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; { Name = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, Age = &lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; json = JsonConvert.SerializeObject(person);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// è¾“å‡º: {&amp;#34;Name&amp;#34;:&amp;#34;Alice&amp;#34;,&amp;#34;Age&amp;#34;:30}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; json = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{\&amp;#34;Name\&amp;#34;:\&amp;#34;Alice\&amp;#34;,\&amp;#34;Age\&amp;#34;:30}&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; person = JsonConvert.DeserializeObject&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;dynamic&lt;/span&gt;&amp;gt;(json);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// person.Name == &amp;#34;Alice&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;JsonConvert&lt;/strong&gt; æ˜¯ &lt;strong&gt;Newtonsoft.Json&lt;/strong&gt; å‘½åç©ºé—´ä¸­çš„ä¸€ä¸ªé™æ€ç±»ï¼Œå±äº Json.NET åº“&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;2-mongodb-net-driver&#34;&gt;2. MongoDB .NET Driver&lt;/h2&gt;
&lt;p&gt;å½“ä½ é€šè¿‡ MongoDB .NET Driver æ’å…¥ä¸€ä¸ª C# å¯¹è±¡ï¼ˆå¦‚ CustomerManagerModel æˆ– MessageModelï¼‰åˆ° MongoDB æ—¶ï¼š&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;1-jsonnet--newtonsoftjson&#34;&gt;1. Json.NET  (Newtonsoft.Json)&lt;/h2&gt;
&lt;p&gt;éå¸¸æµè¡Œçš„å¼€æº .NET åº“ï¼Œç”¨äºå¤„ç† JSON æ•°æ®ï¼Œå®ƒåœ¨ .NET ç¤¾åŒºä¸­å¹¿ä¸ºäººçŸ¥ï¼Œå› æ­¤å¾ˆå¤šäººç›´æ¥ç§°å®ƒä¸º Json.NETï¼Œè€Œä¸æ˜¯å®Œæ•´çš„å‘½åç©ºé—´ &lt;code&gt;Newtonsoft.Json&lt;/code&gt;ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç±»å’Œæ–¹æ³•ï¼Œç”¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–&lt;/strong&gt;ï¼šå°† C# å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ååºåˆ—åŒ–&lt;/strong&gt;ï¼šå°† JSON å­—ç¬¦ä¸²è½¬æ¢å› C# å¯¹è±¡&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªå®šä¹‰åºåˆ—åŒ–&lt;/strong&gt;ï¼šé€šè¿‡ç‰¹æ€§ï¼ˆå¦‚ &lt;code&gt;[JsonConverter]&lt;/code&gt;ï¼‰æˆ–é…ç½®ï¼Œå…è®¸å¼€å‘è€…æ§åˆ¶ JSON çš„æ ¼å¼å’Œè¡Œä¸º&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; person = &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; { Name = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, Age = &lt;span style=&#34;color:#ae81ff&#34;&gt;30&lt;/span&gt; };
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; json = JsonConvert.SerializeObject(person);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// è¾“å‡º: {&amp;#34;Name&amp;#34;:&amp;#34;Alice&amp;#34;,&amp;#34;Age&amp;#34;:30}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; json = &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;{\&amp;#34;Name\&amp;#34;:\&amp;#34;Alice\&amp;#34;,\&amp;#34;Age\&amp;#34;:30}&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; person = JsonConvert.DeserializeObject&amp;lt;&lt;span style=&#34;color:#66d9ef&#34;&gt;dynamic&lt;/span&gt;&amp;gt;(json);
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// person.Name == &amp;#34;Alice&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;JsonConvert&lt;/strong&gt; æ˜¯ &lt;strong&gt;Newtonsoft.Json&lt;/strong&gt; å‘½åç©ºé—´ä¸­çš„ä¸€ä¸ªé™æ€ç±»ï¼Œå±äº Json.NET åº“&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;2-mongodb-net-driver&#34;&gt;2. MongoDB .NET Driver&lt;/h2&gt;
&lt;p&gt;å½“ä½ é€šè¿‡ MongoDB .NET Driver æ’å…¥ä¸€ä¸ª C# å¯¹è±¡ï¼ˆå¦‚ CustomerManagerModel æˆ– MessageModelï¼‰åˆ° MongoDB æ—¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é©±åŠ¨ä¼šæ ¹æ®ç±»çš„å±æ€§ï¼ˆå¦‚ &lt;code&gt;[BsonId]&lt;/code&gt;ã€&lt;code&gt;[BsonRepresentation]&lt;/code&gt;ï¼‰å°† C# å¯¹è±¡æ˜ å°„ä¸º BSON æ–‡æ¡£&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦æ˜¾å¼è½¬æ¢ä¸º JSONï¼Œè€Œæ˜¯ç›´æ¥ç”Ÿæˆ BSON äºŒè¿›åˆ¶æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;MongoDB ä½¿ç”¨ &lt;strong&gt;BSON&lt;/strong&gt; ä½œä¸ºå…¶åº•å±‚å­˜å‚¨æ ¼å¼ï¼ŒC# å¯¹è±¡å­˜å‚¨åˆ° MongoDB æ—¶, ç›´æ¥è¢« MongoDB .NET Driver è½¬æ¢ä¸º BSONï¼Œè€Œä¸æ˜¯ JSON,&lt;/p&gt;
&lt;p&gt;å¦‚æœé€šè¿‡ REST API ä»å‰ç«¯æ¥æ”¶ JSON æ•°æ®ï¼ŒJson.NET ä¼šå°† JSON ååºåˆ—åŒ–ä¸º C# å¯¹è±¡ï¼Œç„¶å MongoDB .NET Driver å†å°† C# å¯¹è±¡è½¬ä¸º BSON å­˜å‚¨&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;MongoDB .NET Driver ç”¨äº BSON, Json.NET ç”¨äº JSON&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;MongoDB çš„ .NET é©±åŠ¨ï¼ˆMongoDB.Driverï¼‰æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œç”¨äºå°† C# å¯¹è±¡ä¸ MongoDB çš„ BSONï¼ˆBinary JSONï¼‰æ ¼å¼ç›¸äº’è½¬æ¢&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Json.NET å°† C# å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸², æˆ–è€…å°† JSON å­—ç¬¦ä¸²è½¬ååºåˆ—åŒ–å› C# å¯¹è±¡,&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;3-bson-vs-json&#34;&gt;3. BSON vs JSON&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;BSON&lt;/strong&gt;ï¼ˆBinary JSONï¼‰ä¸ JSON ç±»ä¼¼ï¼Œä½†ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨, MongoDB ä½¿ç”¨ BSON å­˜å‚¨æ–‡æ¡£ï¼Œå› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é«˜æ•ˆæ€§&lt;/strong&gt;ï¼šäºŒè¿›åˆ¶æ ¼å¼å‡å°‘å­˜å‚¨ç©ºé—´å’Œè§£ææ—¶é—´, å¿«é€Ÿåºåˆ—åŒ–å’Œååºåˆ—åŒ–&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸°å¯Œçš„æ•°æ®ç±»å‹&lt;/strong&gt;ï¼šæ”¯æŒ MongoDB ç‰¹æœ‰çš„ç±»å‹ï¼ˆå¦‚ ObjectId ç”¨äºå”¯ä¸€æ ‡è¯†ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;31-åºåˆ—åŒ–å’Œååºåˆ—åŒ–&#34;&gt;3.1. åºåˆ—åŒ–å’Œååºåˆ—åŒ–&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–&lt;/strong&gt; æ˜¯å°†å†…å­˜ä¸­çš„æ•°æ®ï¼ˆå¦‚å¯¹è±¡ã€æ•°ç»„ï¼‰è½¬æ¢ä¸ºå¯å­˜å‚¨æˆ–ä¼ è¾“çš„æ ¼å¼, å¦‚äºŒè¿›åˆ¶æˆ–æ–‡æœ¬&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ååºåˆ—åŒ–&lt;/strong&gt; æ˜¯å°†å­˜å‚¨çš„æ ¼å¼è½¬æ¢å›å†…å­˜ä¸­çš„æ•°æ®ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;32-ä¸ºä»€ä¹ˆ-bson-åºåˆ—åŒ–ååºåˆ—åŒ–æ›´å¿«&#34;&gt;3.2. ä¸ºä»€ä¹ˆ BSON åºåˆ—åŒ–/ååºåˆ—åŒ–æ›´å¿«ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;JSON çš„é—®é¢˜&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;JSON æ˜¯çº¯æ–‡æœ¬æ ¼å¼&lt;/strong&gt;ï¼Œåºåˆ—åŒ–æ—¶éœ€è¦å°†æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚æ•°å­— 25 å˜æˆ &amp;ldquo;25&amp;rdquo;ï¼ŒåŠ ä¸Šå¼•å·ã€æ‹¬å·ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;ååºåˆ—åŒ–æ—¶ï¼Œç¨‹åºéœ€è¦é€å­—ç¬¦è§£ææ–‡æœ¬ï¼Œæ£€æŸ¥è¯­æ³•ï¼ˆæ¯”å¦‚ &lt;code&gt;{&lt;/code&gt;ã€&lt;code&gt;&amp;quot;&lt;/code&gt;ã€&lt;code&gt;,&lt;/code&gt;ï¼‰ï¼Œç„¶åå°†å­—ç¬¦ä¸²è½¬æ¢å›æ­£ç¡®çš„æ•°æ®ç±»å‹ï¼ˆ&lt;code&gt;&amp;quot;25&amp;quot;&lt;/code&gt; å˜å›æ•°å­— &lt;code&gt;25&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå¤§é‡å­—ç¬¦ä¸²æ“ä½œï¼Œæ¯”è¾ƒæ…¢ï¼Œå°¤å…¶åœ¨å¤„ç†å¤§æ•°æ®é‡æ—¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;BSON çš„ä¼˜åŠ¿&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BSON æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œæ•°æ®ç›´æ¥ä»¥å­—èŠ‚å½¢å¼å­˜å‚¨ï¼Œæ¥è¿‘è®¡ç®—æœºå†…å­˜ä¸­çš„è¡¨ç¤ºæ–¹å¼&lt;/li&gt;
&lt;li&gt;åºåˆ—åŒ–æ—¶ï¼ŒBSON ç›´æ¥å°†æ•°æ®ï¼ˆå¦‚æ•°å­—ã€æ—¥æœŸï¼‰æŒ‰å›ºå®šå­—èŠ‚æ ¼å¼å†™å…¥ï¼Œæ— éœ€è½¬æ¢ä¸ºæ–‡æœ¬&lt;/li&gt;
&lt;li&gt;ååºåˆ—åŒ–æ—¶ï¼Œç¨‹åºè¯»å–å›ºå®šé•¿åº¦çš„å­—èŠ‚ï¼Œç›´æ¥è¿˜åŸä¸ºå†…å­˜ä¸­çš„æ•°æ®ç±»å‹ï¼Œæ— éœ€å¤æ‚çš„æ–‡æœ¬è§£æ&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;33-bson-åºåˆ—åŒ–è¿‡ç¨‹&#34;&gt;3.3. BSON åºåˆ—åŒ–è¿‡ç¨‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;age&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;1. ç¡®å®šæ–‡æ¡£ç»“æ„&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MongoDB å®¢æˆ·ç«¯åˆ†æå¯¹è±¡ï¼Œè¯†åˆ«å­—æ®µåï¼ˆname, ageï¼‰å’Œå€¼ï¼ˆ&amp;ldquo;Alice&amp;rdquo;, 25ï¼‰ä»¥åŠç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•´æ•°ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;2. åˆ†é…äºŒè¿›åˆ¶ç©ºé—´&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;BSON ä¸ºæ•´ä¸ªæ–‡æ¡£åˆ†é…ä¸€ä¸ªå›ºå®šé•¿åº¦çš„äºŒè¿›åˆ¶ç¼“å†²åŒº&lt;/li&gt;
&lt;li&gt;æ–‡æ¡£å¼€å¤´è®°å½•æ€»é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼Œæ–¹ä¾¿å¿«é€Ÿè¯»å–&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;3. ç¼–ç å­—æ®µ, æ¯ä¸ªå­—æ®µæŒ‰ä»¥ä¸‹ç»“æ„ç¼–ç &lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç±»å‹æ ‡è¯†&lt;/strong&gt;ï¼š1 å­—èŠ‚ï¼Œè¡¨ç¤ºæ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚ \x02 è¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œ\x10 è¡¨ç¤º 32 ä½æ•´æ•°ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å­—æ®µå&lt;/strong&gt;ï¼šä»¥ç©ºå­—èŠ‚ï¼ˆ\x00ï¼‰ç»ˆæ­¢çš„å­—ç¬¦ä¸²&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å€¼&lt;/strong&gt;ï¼šæ ¹æ®ç±»å‹ç¼–ç ï¼ˆå­—ç¬¦ä¸²å¸¦é•¿åº¦å‰ç¼€ï¼Œæ•´æ•°ç›´æ¥å†™å­—èŠ‚ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¤ºä¾‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;name: &amp;ldquo;Alice&amp;rdquo;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç±»å‹ï¼š\x02ï¼ˆå­—ç¬¦ä¸²ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­—æ®µåï¼š&amp;ldquo;name\x00&amp;rdquo;ï¼ˆ5 å­—èŠ‚ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å€¼ï¼š&amp;quot;\x06\x00\x00\x00Alice\x00&amp;quot;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;age: 25&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç±»å‹ï¼š\x10ï¼ˆ32 ä½æ•´æ•°ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å­—æ®µåï¼š&amp;ldquo;age\x00&amp;rdquo;ï¼ˆ4 å­—èŠ‚ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å€¼ï¼š&amp;quot;\x19\x00\x00\x00&amp;quot;ï¼ˆ4 å­—èŠ‚ï¼Œ25 çš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;4. å†™å…¥æ–‡æ¡£&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰å­—æ®µæŒ‰é¡ºåºå†™å…¥ç¼“å†²åŒºï¼Œæ–‡æ¡£ä»¥ \x00 ç»“å°¾, æœ€ç»ˆ BSON æ•°æ®ï¼ˆç®€åŒ–è¡¨ç¤ºï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;16&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;00&lt;/span&gt;               // æ–‡æ¡£æ€»é•¿åº¦ï¼ˆ22 å­—èŠ‚ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;02name&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;06&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00Alice&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;00&lt;/span&gt;  // name&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;10age&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;19&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;00&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;00&lt;/span&gt;           // age&lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;25&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;\x&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;00&lt;/span&gt;                           // æ–‡æ¡£ç»“æŸ
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;34-ååºåˆ—åŒ–æ­¥éª¤&#34;&gt;3.4. ååºåˆ—åŒ–æ­¥éª¤&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;è¯»å–æ–‡æ¡£æ€»é•¿åº¦&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–å¼€å¤´ 4 å­—èŠ‚ï¼ˆ\x16\x00\x00\x00ï¼‰ï¼ŒçŸ¥é“æ–‡æ¡£æœ‰ 22 å­—èŠ‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é€å­—æ®µè§£æ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–ç±»å‹æ ‡è¯†ï¼ˆ\x02ï¼‰ï¼ŒçŸ¥é“æ˜¯å­—ç¬¦ä¸²&lt;/li&gt;
&lt;li&gt;è¯»å–å­—æ®µåï¼ˆ&amp;ldquo;name\x00&amp;rdquo;ï¼‰ï¼ŒçŸ¥é“å­—æ®µæ˜¯ name&lt;/li&gt;
&lt;li&gt;è¯»å–å€¼ï¼ˆ&amp;quot;\x06\x00\x00\x00Alice\x00&amp;quot;ï¼‰ï¼Œè§£æä¸ºå­—ç¬¦ä¸² &amp;ldquo;Alice&amp;rdquo;&lt;/li&gt;
&lt;li&gt;ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—æ®µï¼Œç±»å‹æ˜¯ \x10ï¼ˆæ•´æ•°ï¼‰ï¼Œå­—æ®µåæ˜¯ ageï¼Œå€¼æ˜¯ 25&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è¯»å–æ–‡æ¡£æ€»é•¿åº¦&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–å¼€å¤´ 4 å­—èŠ‚ï¼ˆ\x16\x00\x00\x00ï¼‰ï¼ŒçŸ¥é“æ–‡æ¡£æœ‰ 22 å­—èŠ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;é€å­—æ®µè§£æ&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»å–ç±»å‹æ ‡è¯†ï¼ˆ\x02ï¼‰ï¼ŒçŸ¥é“æ˜¯å­—ç¬¦ä¸²ã€‚&lt;/li&gt;
&lt;li&gt;è¯»å–å­—æ®µåï¼ˆ&amp;ldquo;name\x00&amp;rdquo;ï¼‰ï¼ŒçŸ¥é“å­—æ®µæ˜¯ nameã€‚&lt;/li&gt;
&lt;li&gt;è¯»å–å€¼ï¼ˆ&amp;quot;\x06\x00\x00\x00Alice\x00&amp;quot;ï¼‰ï¼Œè§£æä¸ºå­—ç¬¦ä¸² &amp;ldquo;Alice&amp;rdquo;ã€‚&lt;/li&gt;
&lt;li&gt;ç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—æ®µï¼Œç±»å‹æ˜¯ \x10ï¼ˆæ•´æ•°ï¼‰ï¼Œå­—æ®µåæ˜¯ ageï¼Œå€¼æ˜¯ 25&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è¿˜åŸå¯¹è±¡&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{ &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;name:&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;age:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;25&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;MongoDB å¦‚ä½•åˆ©ç”¨ BSON å…ƒæ•°æ®æŸ¥è¯¢å•ä¸ªå­—æ®µ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒBSON æ•°æ®æ˜¯ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;\x16\x00\x00\x00               // æ–‡æ¡£æ€»é•¿åº¦ï¼ˆ22 å­—èŠ‚ï¼‰
\x02name\x00\x06\x00\x00\x00Alice\x00  // name=&amp;#34;Alice&amp;#34;
\x10age\x00\x19\x00\x00\x00           // age=25
\x00                           // æ–‡æ¡£ç»“æŸ
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…³é”®å…ƒæ•°æ®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡æ¡£æ€»é•¿åº¦ï¼ˆå¼€å¤´ 4 å­—èŠ‚ï¼‰ï¼šå‘Šè¯‰ MongoDB æ•´ä¸ªæ–‡æ¡£æœ‰å¤šå¤§&lt;/li&gt;
&lt;li&gt;å­—æ®µç±»å‹ï¼ˆå¦‚ \x02, \x10ï¼‰ï¼šè¡¨ç¤ºå­—æ®µæ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°ç­‰&lt;/li&gt;
&lt;li&gt;å­—æ®µåï¼ˆå¦‚ &amp;ldquo;name\x00&amp;rdquo;ï¼‰ï¼šæ ‡è¯†å­—æ®µ&lt;/li&gt;
&lt;li&gt;å€¼é•¿åº¦ï¼ˆå¦‚ \x06\x00\x00\x00ï¼‰ï¼šå¯¹äºå­—ç¬¦ä¸²ç­‰å˜é•¿æ•°æ®ï¼Œæ ‡æ˜å€¼çš„å­—èŠ‚æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›å…ƒæ•°æ®è®© MongoDB å¯ä»¥å¿«é€Ÿå®šä½å­—æ®µï¼Œè€Œæ— éœ€è¯»å–æ— å…³éƒ¨åˆ†&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;4-æ³¨è§£å¦‚ä½•å·¥ä½œçš„&#34;&gt;4. æ³¨è§£å¦‚ä½•å·¥ä½œçš„&lt;/h2&gt;
&lt;p&gt;ä¸ç¦å¥½å¥‡ä¸ºä»€ä¹ˆå½“å­˜å‚¨å¯¹è±¡åˆ° mongodb åºåˆ—åŒ–ä¸º BSON æˆ–è€… åºåˆ—åŒ–ä¸º json æ—¶, å°±ä¼šè‡ªåŠ¨æ‰§è¡Œè¿™äº›æ³¨è§£ è¿™æ˜¯æ€ä¹ˆå®ç°çš„ æ˜¯æ¡†æ¶è‡ªåŠ¨å¤„ç†å—?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-c#&#34; data-lang=&#34;c#&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; MongoDB.Bson;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;using&lt;/span&gt; Newtonsoft.Json;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MessageModel&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;    [BsonId]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;    [BsonRepresentation(BsonType.ObjectId)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;string&lt;/span&gt; Id { &lt;span style=&#34;color:#66d9ef&#34;&gt;get&lt;/span&gt;; &lt;span style=&#34;color:#66d9ef&#34;&gt;set&lt;/span&gt;; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;    [JsonConverter(typeof(CustomDateTimeConverter))]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; DateTime CreateTime { &lt;span style=&#34;color:#66d9ef&#34;&gt;get&lt;/span&gt;; &lt;span style=&#34;color:#66d9ef&#34;&gt;set&lt;/span&gt;; } = DateTime.Now;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;41-mongodb-æ³¨è§£mongodbbsonserializationattributes&#34;&gt;4.1. MongoDB æ³¨è§£ï¼ˆMongoDB.Bson.Serialization.Attributesï¼‰&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åå°„ï¼ˆReflectionï¼‰&lt;/strong&gt;ï¼šMongoDB é©±åŠ¨åœ¨åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œä¼šé€šè¿‡åå°„æ£€æŸ¥ç±»çš„ç»“æ„ï¼Œè¯†åˆ«æ˜¯å¦æœ‰ç‰¹å®šçš„å±æ€§ï¼ˆå¦‚ &lt;code&gt;[BsonId]&lt;/code&gt;ã€&lt;code&gt;[BsonRepresentation]&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åºåˆ—åŒ–å™¨ï¼ˆSerializerï¼‰&lt;/strong&gt;ï¼šMongoDB é©±åŠ¨å†…ç½®äº†ä¸€å¥—åºåˆ—åŒ–å™¨ï¼ˆ&lt;code&gt;IBsonSerializer&lt;/code&gt;ï¼‰ï¼Œå®ƒä»¬ä¼šæ ¹æ®æ³¨è§£åŠ¨æ€è°ƒæ•´åºåˆ—åŒ–è¡Œä¸º
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;[BsonId]&lt;/code&gt;ï¼šæ ‡è®°æŸä¸ªå­—æ®µä¸ºä¸»é”®ï¼ˆMongoDB ä¸­çš„ &lt;code&gt;_id&lt;/code&gt; å­—æ®µï¼‰ï¼Œé©±åŠ¨ä¼šç¡®ä¿è¿™ä¸ªå­—æ®µè¢«æ­£ç¡®æ˜ å°„åˆ° &lt;code&gt;_id&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;[BsonRepresentation(BsonType.ObjectId)]&lt;/code&gt;ï¼šæŒ‡å®šå­—æ®µåœ¨ MongoDB ä¸­å­˜å‚¨ä¸º ObjectId ç±»å‹ï¼Œè€Œä¸æ˜¯æ™®é€šçš„å­—ç¬¦ä¸²&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å…·ä½“æµç¨‹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ª MessageModel å®ä¾‹&lt;/li&gt;
&lt;li&gt;å½“ä½ è°ƒç”¨ MongoDB é©±åŠ¨çš„æ’å…¥æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;collection.InsertOneAsync(model)&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;é©±åŠ¨é€šè¿‡åå°„è¯»å– &lt;code&gt;MessageModel&lt;/code&gt; ç±»çš„å…ƒæ•°æ®ï¼Œå‘ç° &lt;code&gt;Id&lt;/code&gt; å­—æ®µæœ‰ &lt;code&gt;[BsonId]&lt;/code&gt; å’Œ &lt;code&gt;[BsonRepresentation(BsonType.ObjectId)]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é©±åŠ¨å°† &lt;code&gt;Id&lt;/code&gt; å­—æ®µæ˜ å°„ä¸º MongoDB æ–‡æ¡£çš„ &lt;code&gt;_id&lt;/code&gt; å­—æ®µï¼Œå¹¶ç¡®ä¿å…¶å€¼ç¬¦åˆ ObjectId æ ¼å¼&lt;/li&gt;
&lt;li&gt;å…¶ä»–å­—æ®µï¼ˆå¦‚ &lt;code&gt;CreateTime&lt;/code&gt;ï¼‰ä¹Ÿä¼šæ ¹æ®é»˜è®¤æˆ–è‡ªå®šä¹‰çš„åºåˆ—åŒ–è§„åˆ™è½¬æ¢ä¸º BSON æ ¼å¼&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;42-json-æ³¨è§£newtonsoftjson&#34;&gt;4.2. JSON æ³¨è§£ï¼ˆNewtonsoft.Jsonï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;åå°„ï¼ˆReflectionï¼‰&lt;/strong&gt;ï¼šJson.NET åœ¨åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œä¹Ÿä¼šé€šè¿‡åå°„æ£€æŸ¥ç±»çš„å±æ€§ï¼ŒæŸ¥æ‰¾æ˜¯å¦æœ‰ &lt;code&gt;[JsonConverter]&lt;/code&gt; ç­‰æ³¨è§£&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è‡ªå®šä¹‰è½¬æ¢å™¨ï¼ˆJsonConverterï¼‰&lt;/strong&gt;ï¼š&lt;code&gt;[JsonConverter(typeof(CustomDateTimeConverter))]&lt;/code&gt; å‘Šè¯‰ Json.NET åœ¨åºåˆ—åŒ– CreateTime å­—æ®µæ—¶ï¼Œä½¿ç”¨ &lt;code&gt;CustomDateTimeConverter&lt;/code&gt; ç±»æ¥æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼ˆä¾‹å¦‚ï¼Œæ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ä¸ºç‰¹å®šçš„å­—ç¬¦ä¸²æ ¼å¼ï¼‰&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åºåˆ—åŒ–ç®¡é“&lt;/strong&gt;ï¼šå½“ä½ è°ƒç”¨ Json.NET çš„åºåˆ—åŒ–æ–¹æ³•ï¼ˆå¦‚ &lt;code&gt;JsonConvert.SerializeObject(model)&lt;/code&gt;ï¼‰ï¼ŒJson.NET ä¼šæ ¹æ®æ³¨è§£è°ƒç”¨å¯¹åº”çš„è½¬æ¢å™¨æ¥å¤„ç†å­—æ®µ&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>MongoDB in Action Reading Note</title>
      <link>https://blog.jiyi27.com/posts/database/mongodb/002-mongodb-in-action/</link>
      <pubDate>Wed, 24 Apr 2024 18:29:30 +0000</pubDate>
      
      <guid>https://blog.jiyi27.com/posts/database/mongodb/002-mongodb-in-action/</guid>
      <description>&lt;h2 id=&#34;1-basic-theory&#34;&gt;1. Basic Theory&lt;/h2&gt;
&lt;p&gt;MongoDB stores its information in &lt;strong&gt;documents&lt;/strong&gt; rather than &lt;strong&gt;rows&lt;/strong&gt;. Where relational databases have &lt;strong&gt;tables&lt;/strong&gt;, MongoDB has &lt;em&gt;&lt;strong&gt;collections&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Every MongoDB document requires an &lt;code&gt;_id&lt;/code&gt;, and if one isnâ€™t present when the document is created, a special MongoDB ObjectID will be generated and added to the document at that time. You can set your own &lt;code&gt;_id&lt;/code&gt; by setting it in the document you insert, the ObjectID is just MongoDBâ€™s default.&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;1-basic-theory&#34;&gt;1. Basic Theory&lt;/h2&gt;
&lt;p&gt;MongoDB stores its information in &lt;strong&gt;documents&lt;/strong&gt; rather than &lt;strong&gt;rows&lt;/strong&gt;. Where relational databases have &lt;strong&gt;tables&lt;/strong&gt;, MongoDB has &lt;em&gt;&lt;strong&gt;collections&lt;/strong&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Every MongoDB document requires an &lt;code&gt;_id&lt;/code&gt;, and if one isnâ€™t present when the document is created, a special MongoDB ObjectID will be generated and added to the document at that time. You can set your own &lt;code&gt;_id&lt;/code&gt; by setting it in the document you insert, the ObjectID is just MongoDBâ€™s default.&lt;/p&gt;
&lt;p&gt;Indexes donâ€™t come for free; they take up some space and can make your inserts slightly more expensive, but they are an essential tool for query optimization.&lt;/p&gt;
&lt;p&gt;MongoDB store documents in a collection in no particular order. To get documents in a particular order, you must can use the &lt;code&gt;sort()&lt;/code&gt; method or the &lt;code&gt;$sort&lt;/code&gt; aggregation pipeline stage. Learn more: &lt;a href=&#34;https://www.mongodb.com/docs/manual/reference/glossary/#std-term-natural-order&#34;&gt;natural order â€” MongoDB Manual&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…³äº foreign key çš„æ¦‚å¿µå¸¸å‡ºç°åœ¨ one to many å…³ç³»ä¸­, æ¯”å¦‚è¯„è®ºè¡¨å’Œç”¨æˆ·, ä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªè¯„è®º, ä½†ä¸€ä¸ªè¯„è®ºåªèƒ½æœ‰ä¸€ä¸ªç”¨æˆ·. åœ¨ä¼ ç»Ÿæ•°æ®åº“ä¸­, è¯„è®ºè¡¨ä¸­ä¼šæœ‰ä¸€ä¸ª &lt;code&gt;user_id&lt;/code&gt; å­—æ®µ, æˆ‘ä»¬å«å®ƒå¤–é”®, æ¯æ¬¡æŸ¥è¯¢æ—¶å¯ä»¥é€šè¿‡ join æ“ä½œå°†ç”¨æˆ·ä¿¡æ¯å’Œè¯„è®ºä¿¡æ¯å…³è”èµ·æ¥ (å³è·å–å†™äº†è¿™ä¸ªè¯„è®ºçš„ç”¨æˆ·å…·ä½“ä¿¡æ¯å’Œè¯„è®ºçš„å…·ä½“å†…å®¹).&lt;/p&gt;
&lt;p&gt;MongoDB æ²¡æœ‰ä¼ ç»Ÿæ•°æ®åº“ä¸­ join æ“ä½œå’Œ foreign key, ä½†å¯ä»¥é€šè¿‡ &lt;a href=&#34;https://www.mongodb.com/docs/manual/data-modeling/concepts/embedding-vs-references/#embedded-data-models&#34;&gt;embedded documents&lt;/a&gt; æˆ–è€… &lt;a href=&#34;https://www.mongodb.com/docs/manual/data-modeling/concepts/embedding-vs-references/#std-label-data-modeling-referencing&#34;&gt;reference&lt;/a&gt; æ¥è¡¨ç¤ºä¸€å¯¹å¤šå…³ç³», ä¹Ÿå¯ä½¿ç”¨èšåˆæ¥å®ç°ç±»ä¼¼ Join çš„åŠŸèƒ½. å…·ä½“å®˜æ–¹æ–‡æ¡£æœ‰è§£é‡Š: &lt;a href=&#34;https://www.mongodb.com/docs/manual/tutorial/model-embedded-one-to-many-relationships-between-documents/&#34;&gt;Model One-to-Many Relationships with Embedded Documents&lt;/a&gt;, &lt;a href=&#34;https://www.mongodb.com/docs/manual/tutorial/model-referenced-one-to-many-relationships-between-documents/&#34;&gt;Model One-to-Many Relationships with Document References&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…³äºä¸€å¯¹å¤š, å¤šå¯¹å¤šå…³ç³»å‚è€ƒ: &lt;a href=&#34;https://www.youtube.com/watch?v=4q-keGvUnag&#34;&gt;SQL Server Tutorial - One-to-many and many-to-many table relationships&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…³äºå¤–é”®è¯·å‚è€ƒ: &lt;a href=&#34;https://www.youtube.com/watch?v=UQK9_gKQHZg&#34;&gt;Learning MySQL - FOREIGN KEY CONSTRAINTS&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…³äº join æ“ä½œè¯·å‚è€ƒ: &lt;a href=&#34;https://www.youtube.com/watch?v=9yeOJ0ZMUYw&#34;&gt;SQL Joins Explained&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;2-examples-in-the-book&#34;&gt;2. Examples in the Book&lt;/h2&gt;
&lt;h3 id=&#34;21-reviews---one-to-many-relationship&#34;&gt;2.1. Reviews - One to Many Relationship&lt;/h3&gt;
&lt;p&gt;Each &lt;em&gt;product&lt;/em&gt; can have many &lt;em&gt;reviews&lt;/em&gt;, and you create this relationship by storing a &lt;code&gt;product_id&lt;/code&gt; in each &lt;em&gt;review&lt;/em&gt;, as shown in the sample document:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{ Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;_id:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectId(&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;4c4b1476238d3b4dd5000041&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt;, Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;product_id:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectId(&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;4c4b1476238d3b4dd5003981&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt;, Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;date:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;new&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;Date(2010,&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;5,&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;7),&lt;/span&gt; Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;title:&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Amazing&amp;#34;&lt;/span&gt;, Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;text:&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;Has a squeaky wheel, but still a darn good wheelbarrow.&amp;#34;&lt;/span&gt;, Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;rating:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;4,&lt;/span&gt; Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;user_id:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectId(&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;4c4b1476238d3b4dd5000042&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt;, Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;username:&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;dgreenthumb&amp;#34;&lt;/span&gt;, Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;helpful_votes:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;3,&lt;/span&gt; Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;voter_ids:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectId(&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;4c4b1476238d3b4dd5000033&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt;, Â Â Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectId(&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;7a4f0376238d3b4dd5000003&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt;, Â Â Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectId(&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;92c21476238d3b4dd5000032&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt; Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;But it may come as a surprise that you store the username as well. If this were an RDBMS, youâ€™d be able to pull in the username with a join on the users table. Because you donâ€™t have the join option with MongoDB, you can proceed in one of two ways: either query against the user collection for each review or accept some &lt;strong&gt;denormalization&lt;/strong&gt;. Issuing a query for every review might be unnecessarily costly when username is extremely unlikely to change, so here weâ€™ve chosen to optimize for query speed rather than &lt;strong&gt;normalization&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Also noteworthy is the decision to store votes in the review document itself. Itâ€™s common for users to be able to vote on reviews. Here, you store the object ID of each voting user in an array of voter IDs. This allows you to prevent users from voting on a review more than once, and it also gives you the ability to query for all the reviews a user has voted on. You &lt;strong&gt;cache&lt;/strong&gt; the total number of helpful votes, which among other things allows you to sort reviews based on helpfulness. Caching is useful, a query to sort reviews by helpful votes, for example, is much easier if the size of the voting array is cached in the helpful_votes field.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç”¨æˆ·åä¿¡æ¯åŸæœ¬å¯ä»¥é€šè¿‡ç”¨æˆ·ID (&lt;code&gt;user_id&lt;/code&gt;) åœ¨ç”¨æˆ·é›†åˆ(users collection)ä¸­æŸ¥åˆ°, ä½†è¿™æ ·æ¯æ¬¡åˆ·æ–°è¯„è®ºéƒ½è¦é‡æ–°æŸ¥ä¸€æ¬¡ç”¨æˆ·å.&lt;/p&gt;
&lt;p&gt;è¿™æ®µæåˆ°äº†ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼šç¼“å­˜ï¼ˆCachingï¼‰, è¿™é‡Œçš„ â€œç¼“å­˜â€ æ˜¯æŒ‡åœ¨æ–‡æ¡£ä¸­ç›´æ¥å­˜å‚¨ä¸€ä¸ªé¢å¤–çš„æ•°æ®é¡¹ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯â€œæœ‰å¸®åŠ©çš„æŠ•ç¥¨æ•°â€ï¼‰ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æŸ¥è¯¢æ—¶è®¡ç®—è¿™ä¸ªæ•°å€¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;22-student--courses---many-to-many-relationship&#34;&gt;2.2. Student &amp;amp; Courses - Many to Many Relationship&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;student:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;_id:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;number&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;name:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;string&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;otherDetails:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;...&lt;/span&gt; }&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;courses:&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      { &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;courseId:&lt;/span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;number&amp;gt;,&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;courseName:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;string&amp;gt;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      { &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;courseId:&lt;/span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;number&amp;gt;,&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;courseName:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;string&amp;gt;&lt;/span&gt; },
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;course:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;_id:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;number&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;name:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;string&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;description:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;&amp;lt;string&amp;gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;otherDetails:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;...&lt;/span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now, your application has some queries. To start with some queries I can think about is, get all students in a particular course and get all courses for a particular student. These are simple queries.&lt;/p&gt;
&lt;p&gt;To get all courses for a specific student, the query would be:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;students&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;( { &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;John Doe&amp;#34;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;courses&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; } )
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To get all students enrolled for a specific course, your query can be like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;students&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;( { &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;courses.courseName&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Database Design&amp;#34;&lt;/span&gt; } )
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This example is from &lt;a href=&#34;https://www.mongodb.com/community/forums/t/many-to-many-relationship-and-linked-table-collection/130305/2&#34;&gt;Many to many relationship and linked table/collection - Working with Data - MongoDB Developer Community Forums&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-query-operators&#34;&gt;3. Query Operators&lt;/h2&gt;
&lt;p&gt;å‰é¢ä»‹ç»äº†findå‡½æ•°çš„åŸºæœ¬ç”¨æ³•å’Œprojectionå‚æ•°, åœ¨å®é™…æŸ¥è¯¢ä¸­, æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ä¸€äº›æ“ä½œç¬¦æ¥æ„å»ºæ›´å¤æ‚çš„æŸ¥è¯¢æ¡ä»¶, æ¥ä¸‹æ¥ä¸€ä¸€ä»‹ç».&lt;/p&gt;
&lt;p&gt;Learn more: &lt;a href=&#34;https://www.mongodb.com/docs/manual/reference/operator/query/&#34;&gt;Query and Projection Operators â€” MongoDB Manual&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;31-set-operators&#34;&gt;3.1. Set operators&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;$in&lt;/code&gt;, &lt;code&gt;$nin&lt;/code&gt;, &lt;code&gt;$all&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// $in: Matches any of the values specified in an array.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;products&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;main_cat_id&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;$in&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;ObjectId&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;6a5b1476238d3b4dd5000048&amp;#34;&lt;/span&gt;), Â Â Â Â Â Â Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;ObjectId&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;6a5b1476238d3b4dd5000051&amp;#34;&lt;/span&gt;), Â Â Â Â Â Â Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;ObjectId&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;6a5b1476238d3b4dd5000057&amp;#34;&lt;/span&gt;) Â Â Â Â Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}, &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;null&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Query nested documents
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;products&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;({&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;details.color&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {&lt;span style=&#34;color:#a6e22e&#34;&gt;$in&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Green&amp;#39;&lt;/span&gt;]}})
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;32-boolean-operators&#34;&gt;3.2. Boolean operators&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;$or&lt;/code&gt;, &lt;code&gt;$and&lt;/code&gt;, &lt;code&gt;$not&lt;/code&gt;, &lt;code&gt;$nor&lt;/code&gt;, &lt;code&gt;$exists&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// $or: matches if any of the supplied set of query terms is true
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Finding all products that are either blue or made by Acme requires:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;products&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;({
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;$or&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;details.color&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;blue&amp;#39;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        {&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;manufacturer&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Acme&amp;#39;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;})
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;4-update-atomic-operations-and-delete---action-in-mongodb-chapter-7&#34;&gt;4. Update, atomic operations, and delete - Action in MongoDB chapter 7&lt;/h2&gt;
&lt;h3 id=&#34;41-update&#34;&gt;4.1. Update&lt;/h3&gt;
&lt;p&gt;You can either replace the document altogether, or you can use update operators to modify specific fields within the document.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;modify by replacement:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;user_id&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ObjectId&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;4c4b1476238d3b4dd5003981&amp;#34;&lt;/span&gt;) 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;doc&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;findOne&lt;/span&gt;({&lt;span style=&#34;color:#a6e22e&#34;&gt;_id&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;user_id&lt;/span&gt;}) 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;doc&lt;/span&gt;[&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;email&amp;#39;&lt;/span&gt;] &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mongodb-user@mongodb.com&amp;#39;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;print&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;updating &amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;user_id&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({&lt;span style=&#34;color:#a6e22e&#34;&gt;_id&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;user_id&lt;/span&gt;}, &lt;span style=&#34;color:#a6e22e&#34;&gt;doc&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The final line says, â€œFind the document in the users collection with the given _id, and replace that document with the one weâ€™ve provided.â€&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;modify by operator:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-js&#34; data-lang=&#34;js&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;user_id&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;ObjectId&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;4c4b1476238d3b4dd5000001&amp;#34;&lt;/span&gt;) 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({&lt;span style=&#34;color:#a6e22e&#34;&gt;_id&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;user_id&lt;/span&gt;},Â  {&lt;span style=&#34;color:#a6e22e&#34;&gt;$set&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; {&lt;span style=&#34;color:#a6e22e&#34;&gt;email&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mongodb-user2@mongodb.com&amp;#39;&lt;/span&gt;}})
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;blockquote&gt;
&lt;p&gt;Performance-conscious users may balk at the idea of re-aggregating all product reviews for each update. &lt;strong&gt;Much of this depends on the ratio of reads to writes&lt;/strong&gt;; itâ€™s likely that more users will see product reviews than write their own, so it makes sense to re-aggregate on a write.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;42-standard-update-operators&#34;&gt;4.2. Standard update operators&lt;/h3&gt;
&lt;p&gt;Certainly! Let&amp;rsquo;s go through each MongoDB update operator with an explanation followed by a real-world example:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$set&lt;/code&gt;&lt;/strong&gt;: Used to set the value of a field in a document. If the field does not exist, &lt;code&gt;$set&lt;/code&gt; will add a new field with the specified value.&lt;/p&gt;
&lt;p&gt;Example: Updating a user&amp;rsquo;s email address.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;username&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;johndoe&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$set&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;email&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;johndoe@example.com&amp;#39;&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$unset&lt;/code&gt;&lt;/strong&gt;: Removes the specified field from a document.&lt;/p&gt;
&lt;p&gt;Example: Removing a phone number field from a user&amp;rsquo;s profile.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;username&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;johndoe&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$unset&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;phoneNumber&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$inc&lt;/code&gt;&lt;/strong&gt;: Increments the value of a field by the specified amount. If the field does not exist, it is set to the increment amount.&lt;/p&gt;
&lt;p&gt;Example: Incrementing a user&amp;rsquo;s reward points.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;username&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;johndoe&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$inc&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;rewardPoints&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;100&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$push&lt;/code&gt;&lt;/strong&gt;: Adds an element to an array. If the field is not an array, this operator will create an array with one element.&lt;/p&gt;
&lt;p&gt;Example: Adding a new product to a user&amp;rsquo;s wishlist.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;username&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;johndoe&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$push&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;wishlist&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;productId1234&amp;#39;&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$pull&lt;/code&gt;&lt;/strong&gt;: Removes all instances of a value from an existing array.&lt;/p&gt;
&lt;p&gt;Example: Removing an item from a user&amp;rsquo;s shopping cart.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;users&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;username&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;johndoe&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$pull&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;shoppingCart&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;itemId5678&amp;#39;&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$addToSet&lt;/code&gt;&lt;/strong&gt;: Adds a value to an array unless the value is already present, in which case &lt;code&gt;$addToSet&lt;/code&gt; does nothing to ensure uniqueness.&lt;/p&gt;
&lt;p&gt;Example: Adding a tag to a blog post without creating duplicates.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;blogPosts&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;title&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;MongoDB Tips&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$addToSet&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;tags&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;NoSQL&amp;#39;&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$rename&lt;/code&gt;&lt;/strong&gt;: Renames a field.&lt;/p&gt;
&lt;p&gt;Example: Changing a field name in a contact document.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;contacts&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;Jane Doe&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$rename&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;cellphone&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;mobileNumber&amp;#39;&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;$mul&lt;/code&gt;&lt;/strong&gt;: Multiplies the value of the field by the specified amount. If the field does not exist, the operation sets the field to zero.&lt;/p&gt;
&lt;p&gt;Example: Updating the price of a product in inventory.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;products&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;productId&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#39;A123&amp;#39;&lt;/span&gt; }, { &lt;span style=&#34;color:#a6e22e&#34;&gt;$mul&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;price&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;2&lt;/span&gt; } });
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;5-slow-queries---chapter-8-å€¼å¾—åå¤é˜…è¯»&#34;&gt;5. Slow queries - Chapter 8 å€¼å¾—åå¤é˜…è¯»&lt;/h2&gt;
&lt;p&gt;Finding slow queries is easy with MongoDBâ€™s profiler. Discovering why these queries are slow is trickier and may require some detective work. As mentioned, the causes of slow queries are manifold. If youâ€™re lucky, resolving a slow query may be as easy as adding an index. In more difficult cases, you might have to rearrange indexes, restructure the data model, or upgrade hardware.&lt;/p&gt;
&lt;p&gt;MongoDBâ€™s explain command provides detailed information about a given queryâ€™s path.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;db.values.find(&lt;/span&gt;{}&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;).sort(&lt;/span&gt;{&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;close:&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;-1&lt;/span&gt;}&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;).limit(&lt;/span&gt;&lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;).explain()&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;cursor&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;BasicCursor&amp;#34;&lt;/span&gt;,Â Â Â Â Â Â Â Â Â Â Â  Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;isMultiKey&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;,Â Â Â Â Â Â Â Â Â Â Â Â Â 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;â€œ&lt;/span&gt;Â  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;n&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt;,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#A&lt;/span&gt; Â  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;Number&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;returned&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;nscannedObjects&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#ae81ff&#34;&gt;4308303&lt;/span&gt;,Â Â Â Â Â Â Â Â  Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;nscanned&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#ae81ff&#34;&gt;4308303&lt;/span&gt;,Â Â Â Â Â Â Â Â Â Â &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#B&lt;/span&gt; Â  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;Number&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;scanned&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;nscannedObjectsAllPlans&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#ae81ff&#34;&gt;4308303&lt;/span&gt;, Â  Â 
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;scanAndOrder&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;,Â Â Â Â Â Â Â Â Â Â Â Â Â  Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;millis&amp;#34;&lt;/span&gt; : &lt;span style=&#34;color:#ae81ff&#34;&gt;10927&lt;/span&gt;,Â Â Â Â  Â         &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;#C&lt;/span&gt; Â  &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;Time&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;milliseconds,&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;11&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;seconds&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;this&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;query&lt;/span&gt; &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;took&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;...&lt;/span&gt;Â Â Â Â Â Â Â Â Â Â Â Â Â Â  Â  
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}Â 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;cursor&lt;/code&gt; field tells you that youâ€™ve been using a &lt;code&gt;BasicCursor&lt;/code&gt;, which only confirms that youâ€™re scanning the collection itself and not an index. If you had used an index, the value wouldâ€™ve been &lt;code&gt;BTreeCursor&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A second datum here further explains the slowness of the query: the &lt;code&gt;scanAndOrder&lt;/code&gt; field. This indicator appears when the query optimizer canâ€™t use an index to return a sorted result set. Therefore, in this case, not only does the query engine have to scan the collection, it also has to sort the result set manually.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Avoid &lt;code&gt;scanAndOrder&lt;/code&gt;. If the query includes a sort, attempt to sort using an index.&lt;/li&gt;
&lt;li&gt;Satisfy all fields with useful indexing constraintsâ€”attempt to use indexes for the fields in the query selector.&lt;/li&gt;
&lt;li&gt;If the query implies a range or includes a sort, choose an index where that last key used can help satisfy the range or sort.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å½“æåˆ°â€œlast key usedâ€è¿™ä¸ªæœ¯è¯­ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­å…³äºé€‰æ‹©ç´¢å¼•ä»¥ä¼˜åŒ–èŒƒå›´æŸ¥è¯¢æˆ–æ’åºæ“ä½œçš„è®¨è®ºä¸­ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨å¤åˆç´¢å¼•ä¸­çš„æœ€åä¸€ä¸ªå­—æ®µã€‚åœ¨å¤åˆç´¢å¼•ä¸­ï¼Œå­—æ®µçš„é¡ºåºæ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºå®ƒå†³å®šäº†æ•°æ®åº“å¦‚ä½•ç»„ç»‡å’Œè®¿é—®ç´¢å¼•æ•°æ®ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸ªæ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾ä½ æœ‰ä¸€ä¸ªMongoDBé›†åˆï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å­—æ®µï¼š&lt;code&gt;a&lt;/code&gt;, &lt;code&gt;b&lt;/code&gt;, å’Œ &lt;code&gt;c&lt;/code&gt;ã€‚ç°åœ¨ï¼Œå‡è®¾ä½ åˆ›å»ºäº†ä¸€ä¸ªå¤åˆç´¢å¼• &lt;code&gt;{ a: 1, b: 1, c: 1 }&lt;/code&gt;ã€‚åœ¨è¿™ä¸ªç´¢å¼•ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;a&lt;/code&gt; æ˜¯ç¬¬ä¸€ä¸ªé”®ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;b&lt;/code&gt; æ˜¯ç¬¬äºŒä¸ªé”®ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c&lt;/code&gt; æ˜¯â€œlast keyâ€æˆ–æœ€åä¸€ä¸ªé”®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨å¤„ç†æŸ¥è¯¢æ—¶ï¼Œå¦‚æœæŸ¥è¯¢æ¶‰åŠåˆ°è¿™ä¸‰ä¸ªå­—æ®µä¸­çš„ä»»æ„ä¸€ä¸ªçš„èŒƒå›´æ¡ä»¶æˆ–æ’åºè¦æ±‚ï¼Œç´¢å¼•çš„æ•ˆç‡å°†å–å†³äºè¿™äº›æ¡ä»¶æ˜¯å¦‚ä½•ä¸ç´¢å¼•ä¸­çš„é”®åŒ¹é…çš„ã€‚åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ å¸Œæœ›æŸ¥è¯¢ä¸­çš„èŒƒå›´æˆ–æ’åºæ“ä½œç›´æ¥å¯¹åº”äºå¤åˆç´¢å¼•ä¸­çš„æœ€åä¸€ä¸ªé”®ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥æœ€å¤§åŒ–ç´¢å¼•çš„æ•ˆç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-javascript&#34; data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;collection&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;find&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;a&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;10&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;b&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; { &lt;span style=&#34;color:#a6e22e&#34;&gt;$gt&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;5&lt;/span&gt; } }).&lt;span style=&#34;color:#a6e22e&#34;&gt;sort&lt;/span&gt;({ &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;1&lt;/span&gt; })
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;a&lt;/code&gt; æ˜¯ä¸€ä¸ªç²¾ç¡®åŒ¹é…æ¡ä»¶ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;b&lt;/code&gt; æ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢æ¡ä»¶ï¼Œ&lt;/li&gt;
&lt;li&gt;&lt;code&gt;c&lt;/code&gt; æ˜¯ä¸€ä¸ªæ’åºæ¡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç´¢å¼• &lt;code&gt;{ a: 1, b: 1, c: 1 }&lt;/code&gt; åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯é«˜æ•ˆçš„ï¼Œå› ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒé¦–å…ˆä½¿ç”¨ &lt;code&gt;a&lt;/code&gt; æ¥å¿«é€Ÿå®šä½æ•°æ®ï¼ˆç¬¬ä¸€ä¸ªé”®ï¼‰ï¼Œ&lt;/li&gt;
&lt;li&gt;æ¥ç€ï¼Œåˆ©ç”¨ &lt;code&gt;b&lt;/code&gt; æ¥è¿›ä¸€æ­¥è¿‡æ»¤èŒƒå›´å†…çš„è®°å½•ï¼ˆç¬¬äºŒä¸ªé”®ï¼‰ï¼Œ&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œä½¿ç”¨ &lt;code&gt;c&lt;/code&gt; è¿›è¡Œæ’åºï¼ˆâ€œlast keyâ€æˆ–æœ€åä¸€ä¸ªé”®ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿™é‡Œï¼Œâ€œlast keyâ€ (&lt;code&gt;c&lt;/code&gt;) ä½¿å¾—æŸ¥è¯¢å¯ä»¥åœ¨ä½¿ç”¨ç´¢å¼•çš„åŒæ—¶å®Œæˆæ’åºï¼Œä»è€Œé¿å…äº†é¢å¤–çš„æ’åºæ­¥éª¤ï¼Œæé«˜äº†æŸ¥è¯¢æ•ˆç‡ã€‚æ‰€ä»¥ï¼Œâ€œlast keyâ€åœ¨å¤åˆç´¢å¼•ä¸­æŒ‡çš„æ˜¯æœ€åä¸€ä¸ªè¢«ç”¨æ¥æ”¯æŒæŸ¥è¯¢ä¸­çš„èŒƒå›´æˆ–æ’åºæ¡ä»¶çš„å­—æ®µã€‚&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>MongoDB Docs - Golang Basics</title>
      <link>https://blog.jiyi27.com/posts/database/mongodb/000-basics-golang/</link>
      <pubDate>Tue, 23 Apr 2024 08:38:35 +0000</pubDate>
      
      <guid>https://blog.jiyi27.com/posts/database/mongodb/000-basics-golang/</guid>
      <description>&lt;h2 id=&#34;1-bson--marshalling--unmarshalling&#34;&gt;1. Bson &amp;amp; Marshalling &amp;amp; Unmarshalling&lt;/h2&gt;
&lt;p&gt;The process of converting a Go type to BSON is called &lt;strong&gt;marshalling&lt;/strong&gt;, while the reverse process is called &lt;strong&gt;unmarshalling&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Why need convert Go type to BSON?&lt;/strong&gt; MongoDB stores documents in &lt;a href=&#34;https://www.mongodb.com/docs/manual/reference/bson-types/&#34;&gt;BSON&lt;/a&gt;, when we store data (our struct) into MongoDB,  MongoDB Go-driver convert our struct value into bson automatically.&lt;/p&gt;
&lt;p&gt;The Go driver provides four main types for working with BSON data:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;D&lt;/code&gt;: An ordered representation of a BSON document (slice)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;: An unordered representation of a BSON document (map)&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;D is an ordered representation of a BSON document. This type should be used when the order of the elements matters, such as MongoDB command documents. If the order of the elements does not matter, an M should be used instead. This usually used as filter in a query operation.&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;1-bson--marshalling--unmarshalling&#34;&gt;1. Bson &amp;amp; Marshalling &amp;amp; Unmarshalling&lt;/h2&gt;
&lt;p&gt;The process of converting a Go type to BSON is called &lt;strong&gt;marshalling&lt;/strong&gt;, while the reverse process is called &lt;strong&gt;unmarshalling&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Why need convert Go type to BSON?&lt;/strong&gt; MongoDB stores documents in &lt;a href=&#34;https://www.mongodb.com/docs/manual/reference/bson-types/&#34;&gt;BSON&lt;/a&gt;, when we store data (our struct) into MongoDB,  MongoDB Go-driver convert our struct value into bson automatically.&lt;/p&gt;
&lt;p&gt;The Go driver provides four main types for working with BSON data:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;D&lt;/code&gt;: An ordered representation of a BSON document (slice)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;M&lt;/code&gt;: An unordered representation of a BSON document (map)&lt;/li&gt;
&lt;li&gt;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;D is an ordered representation of a BSON document. This type should be used when the order of the elements matters, such as MongoDB command documents. If the order of the elements does not matter, an M should be used instead. This usually used as filter in a query operation.&lt;/p&gt;
&lt;p&gt;Like what we said before, our Go struct value needs to be converted to bson, there are &lt;strong&gt;Struct Tags&lt;/strong&gt;, which is used to modify the default marshalling and unmarshalling behavior of a struct field.&lt;/p&gt;
&lt;p&gt;After we read data from MongoDB, we need to convert bson to Go struct, this is called &lt;strong&gt;unmarshalling&lt;/strong&gt;. You can unmarshal BSON documents by using the &lt;code&gt;Decode()&lt;/code&gt; method on the result of the &lt;code&gt;FindOne&lt;/code&gt; method or any &lt;code&gt;*mongo.Cursor&lt;/code&gt; instance.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Note that when using &lt;code&gt;FindOne()&lt;/code&gt; it returns a bson document, so you need decode it back to a Go struct value.&lt;/p&gt;
&lt;p&gt;Method &lt;code&gt;Find()&lt;/code&gt; returns a &lt;code&gt;*mongo.Cursor&lt;/code&gt;, we usually iterate through it so get more than one (probably) result. And &lt;code&gt;*mongo.Cursor&lt;/code&gt; needs to be closed usually to free resources.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Learn more:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/64281675/bson-d-vs-bson-m-for-find-queries&#34;&gt;mongodb - bson.D vs bson.M for find queries - Stack Overflow&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.mongodb.com/docs/drivers/go/current/fundamentals/bson/&#34;&gt;Work with BSON - Go Driver v1.15&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;2-read-operation---cursor&#34;&gt;2. Read Operation - Cursor&lt;/h2&gt;
&lt;p&gt;To match a subset of documents, specify a &lt;strong&gt;query filter&lt;/strong&gt;. In a query filter, you can match fields with &lt;a href=&#34;https://www.mongodb.com/docs/drivers/go/current/fundamentals/crud/read-operations/query-document/#std-label-golang-literal-values&#34;&gt;literal values&lt;/a&gt; or with &lt;a href=&#34;https://www.mongodb.com/docs/drivers/go/current/fundamentals/crud/read-operations/query-document/#std-label-golang-query-operators&#34;&gt;query operators&lt;/a&gt;. When you don&amp;rsquo;t know which method you should use, you can go to the &lt;a href=&#34;https://pkg.go.dev/go.mongodb.org/mongo-driver/mongo@v1.15.0#Collection&#34;&gt;mongo driver go API&lt;/a&gt; to check how to use them.&lt;/p&gt;
&lt;h3 id=&#34;mongocursor&#34;&gt;&lt;code&gt;*mongo.Cursor&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;A cursor is used to iterate over database results from read operations. &lt;strong&gt;A cursor is not goroutine safe&lt;/strong&gt;. Do not use the same cursor in multiple goroutines at the same time. Method &lt;code&gt;Find()&lt;/code&gt; returns a cursor.&lt;/p&gt;
&lt;p&gt;You can retrieve results individually or get all results at a time, it depends on if the number of the result is very large.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;cursor&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;coll&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Find&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TODO&lt;/span&gt;(), &lt;span style=&#34;color:#a6e22e&#34;&gt;bson&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;D&lt;/span&gt;{})
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// retrieve results individually&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cursor&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Next&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TODO&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;MyStruct&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cursor&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Decode&lt;/span&gt;(&lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;log&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Fatal&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;fmt&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Printf&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;%+v\n&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// get all results at a time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;results&lt;/span&gt; []&lt;span style=&#34;color:#a6e22e&#34;&gt;MyStruct&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;cursor&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;All&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TODO&lt;/span&gt;(), &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;results&lt;/span&gt;); &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	panic(&lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If the number and size of documents returned by your query exceeds available application memory, your program will crash. If you except a large result set, you should &lt;a href=&#34;https://www.mongodb.com/docs/drivers/go/current/fundamentals/crud/read-operations/cursor/#std-label-golang-individual-documents&#34;&gt;consume your cursor iteratively.&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;When your application no longer requires a cursor, close the cursor with the &lt;code&gt;Close()&lt;/code&gt; method. This method frees the resources your cursor consumes in both the client application and the MongoDB server.  Close the cursor when you &lt;a href=&#34;https://www.mongodb.com/docs/drivers/go/current/fundamentals/crud/read-operations/cursor/#std-label-golang-individual-documents&#34;&gt;retrieve documents individually&lt;/a&gt; because those methods make a cursor &lt;a href=&#34;https://www.mongodb.com/docs/manual/core/tailable-cursors/&#34;&gt;tailable.&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;3-others&#34;&gt;3. Others&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;If the necessary database and collection don&amp;rsquo;t exist when you perform a write operation, the server implicitly creates them. So you don&amp;rsquo;t need to create database explicitly when use MongoDB.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;collection: you can use it concurrentlly&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Repository&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mongo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Client&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#75715e&#34;&gt;//Collection is safe for concurrent use by multiple goroutines.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;PokemonColl&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mongo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Collection&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;NewRepository&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;mongo&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Client&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Repository&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Repository&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;:          &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;		&lt;span style=&#34;color:#a6e22e&#34;&gt;PokemonColl&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;db&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Database&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pokemon&amp;#34;&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;Collection&lt;/span&gt;(&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;pokemons&amp;#34;&lt;/span&gt;),
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;modify behvavior when query: opts third parameter&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Note that there is three parameters, last is optional. &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;coll&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Collection&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Find&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;ctx&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Context&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;interface&lt;/span&gt;{},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;	&lt;span style=&#34;color:#a6e22e&#34;&gt;opts&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;...*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;options&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;FindOptions&lt;/span&gt;) (&lt;span style=&#34;color:#a6e22e&#34;&gt;cur&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Cursor&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;err&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;error&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;findByIdAndUpdate()&lt;/code&gt;: &lt;code&gt;FindOneAndUpdate&lt;/code&gt; returns the original document &lt;strong&gt;before updating&lt;/strong&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;opts&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;options&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;FindOneAndUpdate&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;SetReturnDocument&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;options&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;After&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;coll&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;FindOneAndUpdate&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TODO&lt;/span&gt;(), &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;opts&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You may wonder how do I know &lt;code&gt;opts := options.FindOneAndUpdate().SetReturnDocument(options.After)&lt;/code&gt; this to create an operation? And how can I know the behavior of a method? The answer is the &lt;a href=&#34;https://pkg.go.dev/go.mongodb.org/mongo-driver@v1.15.0/mongo#Collection.FindOneAndUpdate&#34;&gt;mongo-api&lt;/a&gt;, you can see there is the behavor and example and all the thing you need to know before you use it.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pub-2a6758f3b2d64ef5bb71ba1601101d35.r2.dev/blogs/2024/04/d835acb545649837f06bbc2ce323cb3f.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;And you can check the &lt;code&gt;FindOneAndUpdateOptions&lt;/code&gt; just click, to check what is it:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://pub-2a6758f3b2d64ef5bb71ba1601101d35.r2.dev/blogs/2024/04/e8455c6379df455fee9182e24b45305e.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;You can see this option is in the &lt;code&gt;options&lt;/code&gt; package, and you can create it with &lt;code&gt;FindOneAndUpdate()&lt;/code&gt;, so it&amp;rsquo;s not difficult to write the codes like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;opts&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;options&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;FindOneAndUpdate&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;SetReturnDocument&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;options&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;After&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;coll&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;FindOneAndUpdate&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;context&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;TODO&lt;/span&gt;(), &lt;span style=&#34;color:#a6e22e&#34;&gt;filter&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;update&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;opts&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;references&#34;&gt;References&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://pkg.go.dev/go.mongodb.org/mongo-driver/mongo@v1.15.0#pkg-overview&#34;&gt;mongo package - go.mongodb.org/mongo-driver/mongo - Go Packages&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.mongodb.com/docs/drivers/go/current/fundamentals/crud/&#34;&gt;CRUD Operations - Go Driver v1.15&lt;/a&gt;&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>ä¸€å¯¹å¤š, å¤šå¯¹å¤šå»ºè¡¨ MySQL MongoDB</title>
      <link>https://blog.jiyi27.com/posts/database/mysql/003-normalization-join/</link>
      <pubDate>Wed, 10 Jan 2024 11:51:35 +0000</pubDate>
      
      <guid>https://blog.jiyi27.com/posts/database/mysql/003-normalization-join/</guid>
      <description>&lt;h2 id=&#34;1-è§„èŒƒåŒ–&#34;&gt;1. è§„èŒƒåŒ–&lt;/h2&gt;
&lt;h3 id=&#34;11-normalization&#34;&gt;1.1. Normalization&lt;/h3&gt;
&lt;p&gt;è§„èŒƒåŒ–æ˜¯ä¸€ç§å°†æ•°æ®åº“è¡¨ç»“æ„åˆ†è§£ä¸ºæ›´å°çš„ã€æ›´ç¬¦åˆèŒƒå¼çš„è¡¨ï¼Œä»¥å‡å°‘æ•°æ®å†—ä½™ï¼Œæé«˜æ•°æ®ä¸€è‡´æ€§çš„æ–¹æ³•ã€‚å®ƒæ¶‰åŠå°†æ•°æ®åˆ†è§£æˆå¤šä¸ªç›¸äº’å…³è”çš„è¡¨ã€‚è¿™ç§è®¾è®¡å‡å°‘äº†æ•°æ®çš„é‡å¤ï¼Œä½†&lt;strong&gt;é€šå¸¸ä¼šå¯¼è‡´æ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œå› ä¸ºéœ€è¦å¤šä¸ªJOINæ“ä½œæ¥é‡å»ºåŸå§‹ä¿¡æ¯&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;12-denormalization&#34;&gt;1.2. Denormalization&lt;/h3&gt;
&lt;p&gt;Denormalization æ˜¯ Normalization çš„å¯¹ç«‹é¢ã€‚å®ƒæ¶‰åŠå°†æ•°æ®ä»å¤šä¸ªè¡¨åˆå¹¶åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œæœ‰æ—¶é€šè¿‡æ·»åŠ å†—ä½™æ•°æ®æ¥å®ç°ã€‚åœ¨éå…³ç³»å‹æ•°æ®åº“ï¼Œå¦‚MongoDBä¸­ï¼ŒDenormalization é€šå¸¸è¡¨ç°ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åµŒå…¥å­æ–‡æ¡£&lt;/strong&gt;ï¼šå°†ç›¸å…³çš„æ•°æ®ç›´æ¥åµŒå…¥åˆ°ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬åˆ†æ•£åˆ°å¤šä¸ªé›†åˆï¼ˆè¡¨ï¼‰ä¸­ã€‚ä¾‹å¦‚ï¼Œè€Œä¸æ˜¯åœ¨å•ç‹¬çš„é›†åˆä¸­ç»´æŠ¤ç”¨æˆ·åœ°å€ï¼Œå¯ä»¥å°†åœ°å€ä½œä¸ºå­æ–‡æ¡£ç›´æ¥åµŒå…¥åˆ°ç”¨æˆ·æ–‡æ¡£ä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨æ•°ç»„&lt;/strong&gt;ï¼šåœ¨æ–‡æ¡£ä¸­ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨ç›¸å…³é¡¹çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªäº§å“æ–‡æ¡£å¯èƒ½åŒ…å«ä¸€ä¸ªè¯„è®ºçš„æ•°ç»„ï¼Œè€Œä¸æ˜¯å°†è¯„è®ºå­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„é›†åˆä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;13-ç»“è®º&#34;&gt;1.3. ç»“è®º&lt;/h3&gt;
&lt;p&gt;åœ¨MongoDBè¿™æ ·çš„éå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œåè§„èŒƒåŒ–æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®å»ºæ¨¡æŠ€æœ¯ï¼Œç‰¹åˆ«&lt;strong&gt;é€‚ç”¨äºè¯»å–æ“ä½œè¿œå¤šäºå†™å…¥æ“ä½œçš„åœºæ™¯&lt;/strong&gt;ã€‚å®ƒé€šè¿‡ç‰ºç‰²ä¸€å®šç¨‹åº¦çš„æ•°æ®å†—ä½™æ¥æ¢å–è¯»å–æ€§èƒ½çš„æå‡å’ŒæŸ¥è¯¢é€»è¾‘çš„ç®€åŒ–ã€‚ç„¶è€Œï¼Œè®¾è®¡æ—¶éœ€è¦å¹³è¡¡å†—ä½™å¸¦æ¥çš„ç®¡ç†å¤æ‚æ€§å’Œæ€§èƒ½ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-join--foreign-key&#34;&gt;2. Join &amp;amp; Foreign Key&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Join: &lt;a href=&#34;https://www.youtube.com/watch?v=G3lJAxg1cy8&#34;&gt;MySQL: JOINS are easy (INNER, LEFT, RIGHT)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Foreign Key is used to ensure the consistency and integrity of data.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;MongoDB æ²¡æœ‰ join å’Œ foreign key çš„çš„æ¦‚å¿µ, ä½†æ˜¯å¯ä»¥é€šè¿‡åµŒå¥—æ–‡æ¡£æ¥å®ç°ç±»ä¼¼ Join çš„åŠŸèƒ½, ä»¥åŠä½¿ç”¨ Reference æ¥å®ç°ç±»ä¼¼ Foreign Key çš„åŠŸèƒ½.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;JOINæ“ä½œç»å¸¸åˆ©ç”¨å¤–é”®æ¥è¿æ¥ä¸¤ä¸ªè¡¨, è™½ç„¶ JOIN æ“ä½œä¸ä¸€å®šè¦æ±‚å­˜åœ¨å¤–é”®çº¦æŸ, ä½†å¤–é”®ä¸º JOIN æä¾›äº†è‡ªç„¶çš„è¿æ¥ç‚¹, å¦‚ä¸‹ä¾‹å­:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Usersè¡¨&lt;/strong&gt; å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼šUserID (ç”¨æˆ·IDï¼Œä¸»é”®), UserName (ç”¨æˆ·å)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ordersè¡¨&lt;/strong&gt; å­˜å‚¨è®¢å•ä¿¡æ¯ï¼šOrderID (è®¢å•IDï¼Œä¸»é”®) OrderDate (è®¢å•æ—¥æœŸ) UserID (ç”¨æˆ·IDï¼Œå¤–é”®)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ&lt;code&gt;Orders.UserID&lt;/code&gt; æ˜¯ä¸€ä¸ªå¤–é”®, å®ƒæŒ‡å‘&lt;code&gt;Users.UserID&lt;/code&gt;, è¿™æ„å‘³ç€æ¯ä¸ªè®¢å•éƒ½ä¸ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·ç›¸å…³è”ï¼Œå¤–é”®ä¿è¯äº†æ¯ä¸ªè®¢å•ä¸­çš„UserIDéƒ½å¯¹åº”äºä¸€ä¸ªæœ‰æ•ˆçš„ç”¨æˆ·, å‡è®¾æˆ‘ä»¬æƒ³è·å–è®¢å•ä¿¡æ¯ä»¥åŠä¸‹å•çš„ç”¨æˆ·çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLæŸ¥è¯¢ï¼š&lt;/p&gt;</description>
      <content>&lt;h2 id=&#34;1-è§„èŒƒåŒ–&#34;&gt;1. è§„èŒƒåŒ–&lt;/h2&gt;
&lt;h3 id=&#34;11-normalization&#34;&gt;1.1. Normalization&lt;/h3&gt;
&lt;p&gt;è§„èŒƒåŒ–æ˜¯ä¸€ç§å°†æ•°æ®åº“è¡¨ç»“æ„åˆ†è§£ä¸ºæ›´å°çš„ã€æ›´ç¬¦åˆèŒƒå¼çš„è¡¨ï¼Œä»¥å‡å°‘æ•°æ®å†—ä½™ï¼Œæé«˜æ•°æ®ä¸€è‡´æ€§çš„æ–¹æ³•ã€‚å®ƒæ¶‰åŠå°†æ•°æ®åˆ†è§£æˆå¤šä¸ªç›¸äº’å…³è”çš„è¡¨ã€‚è¿™ç§è®¾è®¡å‡å°‘äº†æ•°æ®çš„é‡å¤ï¼Œä½†&lt;strong&gt;é€šå¸¸ä¼šå¯¼è‡´æ›´å¤æ‚çš„æŸ¥è¯¢ï¼Œå› ä¸ºéœ€è¦å¤šä¸ªJOINæ“ä½œæ¥é‡å»ºåŸå§‹ä¿¡æ¯&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;12-denormalization&#34;&gt;1.2. Denormalization&lt;/h3&gt;
&lt;p&gt;Denormalization æ˜¯ Normalization çš„å¯¹ç«‹é¢ã€‚å®ƒæ¶‰åŠå°†æ•°æ®ä»å¤šä¸ªè¡¨åˆå¹¶åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œæœ‰æ—¶é€šè¿‡æ·»åŠ å†—ä½™æ•°æ®æ¥å®ç°ã€‚åœ¨éå…³ç³»å‹æ•°æ®åº“ï¼Œå¦‚MongoDBä¸­ï¼ŒDenormalization é€šå¸¸è¡¨ç°ä¸ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åµŒå…¥å­æ–‡æ¡£&lt;/strong&gt;ï¼šå°†ç›¸å…³çš„æ•°æ®ç›´æ¥åµŒå…¥åˆ°ä¸€ä¸ªæ–‡æ¡£ä¸­ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬åˆ†æ•£åˆ°å¤šä¸ªé›†åˆï¼ˆè¡¨ï¼‰ä¸­ã€‚ä¾‹å¦‚ï¼Œè€Œä¸æ˜¯åœ¨å•ç‹¬çš„é›†åˆä¸­ç»´æŠ¤ç”¨æˆ·åœ°å€ï¼Œå¯ä»¥å°†åœ°å€ä½œä¸ºå­æ–‡æ¡£ç›´æ¥åµŒå…¥åˆ°ç”¨æˆ·æ–‡æ¡£ä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨æ•°ç»„&lt;/strong&gt;ï¼šåœ¨æ–‡æ¡£ä¸­ä½¿ç”¨æ•°ç»„æ¥å­˜å‚¨ç›¸å…³é¡¹çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªäº§å“æ–‡æ¡£å¯èƒ½åŒ…å«ä¸€ä¸ªè¯„è®ºçš„æ•°ç»„ï¼Œè€Œä¸æ˜¯å°†è¯„è®ºå­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„é›†åˆä¸­&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;13-ç»“è®º&#34;&gt;1.3. ç»“è®º&lt;/h3&gt;
&lt;p&gt;åœ¨MongoDBè¿™æ ·çš„éå…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œåè§„èŒƒåŒ–æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®å»ºæ¨¡æŠ€æœ¯ï¼Œç‰¹åˆ«&lt;strong&gt;é€‚ç”¨äºè¯»å–æ“ä½œè¿œå¤šäºå†™å…¥æ“ä½œçš„åœºæ™¯&lt;/strong&gt;ã€‚å®ƒé€šè¿‡ç‰ºç‰²ä¸€å®šç¨‹åº¦çš„æ•°æ®å†—ä½™æ¥æ¢å–è¯»å–æ€§èƒ½çš„æå‡å’ŒæŸ¥è¯¢é€»è¾‘çš„ç®€åŒ–ã€‚ç„¶è€Œï¼Œè®¾è®¡æ—¶éœ€è¦å¹³è¡¡å†—ä½™å¸¦æ¥çš„ç®¡ç†å¤æ‚æ€§å’Œæ€§èƒ½ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-join--foreign-key&#34;&gt;2. Join &amp;amp; Foreign Key&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Join: &lt;a href=&#34;https://www.youtube.com/watch?v=G3lJAxg1cy8&#34;&gt;MySQL: JOINS are easy (INNER, LEFT, RIGHT)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Foreign Key is used to ensure the consistency and integrity of data.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;MongoDB æ²¡æœ‰ join å’Œ foreign key çš„çš„æ¦‚å¿µ, ä½†æ˜¯å¯ä»¥é€šè¿‡åµŒå¥—æ–‡æ¡£æ¥å®ç°ç±»ä¼¼ Join çš„åŠŸèƒ½, ä»¥åŠä½¿ç”¨ Reference æ¥å®ç°ç±»ä¼¼ Foreign Key çš„åŠŸèƒ½.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;JOINæ“ä½œç»å¸¸åˆ©ç”¨å¤–é”®æ¥è¿æ¥ä¸¤ä¸ªè¡¨, è™½ç„¶ JOIN æ“ä½œä¸ä¸€å®šè¦æ±‚å­˜åœ¨å¤–é”®çº¦æŸ, ä½†å¤–é”®ä¸º JOIN æä¾›äº†è‡ªç„¶çš„è¿æ¥ç‚¹, å¦‚ä¸‹ä¾‹å­:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Usersè¡¨&lt;/strong&gt; å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼šUserID (ç”¨æˆ·IDï¼Œä¸»é”®), UserName (ç”¨æˆ·å)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Ordersè¡¨&lt;/strong&gt; å­˜å‚¨è®¢å•ä¿¡æ¯ï¼šOrderID (è®¢å•IDï¼Œä¸»é”®) OrderDate (è®¢å•æ—¥æœŸ) UserID (ç”¨æˆ·IDï¼Œå¤–é”®)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œ&lt;code&gt;Orders.UserID&lt;/code&gt; æ˜¯ä¸€ä¸ªå¤–é”®, å®ƒæŒ‡å‘&lt;code&gt;Users.UserID&lt;/code&gt;, è¿™æ„å‘³ç€æ¯ä¸ªè®¢å•éƒ½ä¸ä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·ç›¸å…³è”ï¼Œå¤–é”®ä¿è¯äº†æ¯ä¸ªè®¢å•ä¸­çš„UserIDéƒ½å¯¹åº”äºä¸€ä¸ªæœ‰æ•ˆçš„ç”¨æˆ·, å‡è®¾æˆ‘ä»¬æƒ³è·å–è®¢å•ä¿¡æ¯ä»¥åŠä¸‹å•çš„ç”¨æˆ·çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLæŸ¥è¯¢ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;SELECT&lt;/span&gt; Users.UserName, Orders.OrderID, Orders.OrderDate
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;FROM&lt;/span&gt; Orders
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;JOIN&lt;/span&gt; Users &lt;span style=&#34;color:#66d9ef&#34;&gt;ON&lt;/span&gt; Orders.UserID &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; Users.UserID;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;JOIN Users ON Orders.UserID = Users.UserID&lt;/code&gt;è¿™ä¸€å¥æ˜¯JOINçš„æ ¸å¿ƒï¼Œå®ƒè¯´æ˜äº†å¦‚ä½•è¿æ¥è¿™ä¸¤ä¸ªè¡¨ã€‚æˆ‘ä»¬é€šè¿‡&lt;code&gt;Orders&lt;/code&gt;è¡¨ä¸­çš„&lt;code&gt;UserID&lt;/code&gt;ï¼ˆå¤–é”®ï¼‰ä¸&lt;code&gt;Users&lt;/code&gt;è¡¨ä¸­çš„&lt;code&gt;UserID&lt;/code&gt;ï¼ˆä¸»é”®ï¼‰è¿›è¡ŒåŒ¹é…ã€‚&lt;/li&gt;
&lt;li&gt;ç”±äºä½¿ç”¨äº†JOINï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶ä»&lt;code&gt;Orders&lt;/code&gt;è¡¨å’Œ&lt;code&gt;Users&lt;/code&gt;è¡¨ä¸­é€‰æ‹©æ•°æ®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªæŸ¥è¯¢ç»“æœä¸­åŒæ—¶çœ‹åˆ°ç”¨æˆ·çš„åå­—å’Œä»–ä»¬çš„è®¢å•ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;3-one-to-many--many-to-many&#34;&gt;3. One to Many &amp;amp; Many to Many&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸€å¯¹å¤šå…³ç³»&lt;/strong&gt;ï¼šå¦‚è®¢å•å’Œç”¨æˆ·è¡¨, é€šè¿‡åœ¨è®¢å•è¡¨ä¸­è®¾ç½®å¤–é”®ç”¨æˆ·IDæŒ‡å‘ç”¨æˆ·è¡¨çš„ä¸»é”®IDæ¥å®ç°&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šå¯¹å¤šå…³ç³»&lt;/strong&gt;ï¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªé¢å¤–çš„å…³è”è¡¨ï¼Œå…¶ä¸­åŒ…å«æŒ‡å‘ä¸¤ä¸ªç›¸å…³è¡¨ä¸»é”®çš„å¤–é”®æ¥å®ç°, å¦‚æœ¯è¯­å’Œåˆ†ç±»è¡¨, æ¯ä¸ªæœ¯è¯­å¯ä»¥æœ‰å¤šä¸ªåˆ†ç±», æ¯ä¸ªåˆ†ç±»ä¸‹å¯ä»¥æœ‰å¤šä¸ªæœ¯è¯­, è¿™æ—¶å€™éœ€è¦ä¸€ä¸ªå•ç‹¬çš„æœ¯è¯­åˆ†ç±»å…³ç³»è¡¨, æ¥è¡¨ç¤ºæœ¯è¯­å’Œåˆ†ç±»çš„å…³ç³»&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;å¤šå¯¹å¤šå…³ç³»ä¸­, å¯ä»¥åœ¨å•ç‹¬çš„é‚£ä¸ªå…³ç³»è¡¨ä¸­å»ºç«‹ä¸€ä¸ªå¤åˆç´¢å¼•, æ¯”å¦‚æœ¯è¯­å’Œåˆ†ç±», æˆ‘ä»¬å»ºç«‹ (åˆ†ç±», æœ¯è¯­) ç´¢å¼•, è¿™æ ·å‘¢, æˆ‘ä»¬å°±å¯ä»¥å¾ˆå¿«çš„æ‰¾åˆ°æŸä¸ªåˆ†ç±»ä¸‹çš„æ‰€æœ‰æœ¯è¯­, å› ä¸ºä½†æˆ‘ä»¬å»ºç«‹äº†è¿™ä¸ªç´¢å¼•, è¡¨ä¸­çš„å­˜å‚¨ç»“æ„å°±ä¼šå˜ä¸º: åŒä¸€åˆ†ç±»ä¸‹çš„æœ¯è¯­éƒ½ä¼šåœ¨ä¸€å—, ä¸” åˆ†ç±»ä¹Ÿæ˜¯æ’åºè¿‡çš„,&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;4-one-to-many-and-many-to-many-in-nosql-mongodb&#34;&gt;4. One-to-Many and Many-to-Many in NoSQL MongoDB&lt;/h2&gt;
&lt;p&gt;ä¸€å¯¹å¤šå…³ç³»åœ¨MongoDBä¸­é€šå¸¸æœ‰ä¸¤ç§è¡¨ç¤ºæ–¹å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åµŒå…¥æ–‡æ¡£&lt;/strong&gt;: å¦‚æœä¸€ä¸ªç”¨æˆ·æœ‰å¤šä¸ªåœ°å€ï¼Œé‚£ä¹ˆåœ°å€å¯ä»¥ç›´æ¥åµŒå…¥åˆ°ç”¨æˆ·æ–‡æ¡£ä¸­&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;userId123&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;John Doe&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;addresses&amp;#34;&lt;/span&gt;: [
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;street&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;123 Apple St&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;city&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;New York&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;street&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;456 Orange Ave&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;city&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Boston&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  ]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å¼•ç”¨&lt;/strong&gt;: ç±»ä¼¼å…³ç³»å‹æ•°æ®åº“ä¸­çš„å¤–é”®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// User document
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;userId123&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;John Doe&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// Address documents
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;[
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;addressId1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectID(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;userId123&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;street&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;123 Apple St&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;city&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;New York&amp;#34;&lt;/span&gt;},
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  {&lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;addressId2&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;ObjectID(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;userId123&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#960050;background-color:#1e0010&#34;&gt;)&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;street&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;456 Orange Ave&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;city&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Boston&amp;#34;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¤šå¯¹å¤šå…³ç³»åœ¨MongoDBä¸­é€šå¸¸é€šè¿‡å¼•ç”¨æ¥è¡¨ç¤º, æ¯ä¸ªæ–‡æ¡£å­˜å‚¨ä¸ä¹‹ç›¸å…³è”çš„å…¶ä»–æ–‡æ¡£çš„ID, &lt;strong&gt;an array of object IDs&lt;/strong&gt;. å‡è®¾æœ‰å­¦ç”Ÿå’Œè¯¾ç¨‹ï¼Œæ¯ä¸ªå­¦ç”Ÿå¯ä»¥é€‰ä¿®å¤šé—¨è¯¾ç¨‹ï¼Œæ¯é—¨è¯¾ç¨‹ä¹Ÿå¯ä»¥ç”±å¤šä¸ªå­¦ç”Ÿé€‰ä¿®&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­¦ç”Ÿæ–‡æ¡£&lt;/strong&gt;å¯èƒ½åŒ…å«å®ƒä»¬æ‰€é€‰è¯¾ç¨‹çš„IDåˆ—è¡¨:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;studentId1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Alice&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;courses&amp;#34;&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;courseId1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;courseId2&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è¯¾ç¨‹æ–‡æ¡£&lt;/strong&gt;å¯èƒ½åŒ…å«é€‰ä¿®è¯¥è¯¾ç¨‹çš„å­¦ç”ŸIDåˆ—è¡¨:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;courseId1&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;courseName&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;Mathematics&amp;#34;&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;&amp;#34;students&amp;#34;&lt;/span&gt;: [&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;studentId1&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;studentId3&amp;#34;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åµŒå…¥æ–‡æ¡£å¯ä»¥æé«˜è¯»å–æ€§èƒ½ï¼Œå› ä¸ºæ‰€æœ‰ç›¸å…³æ•°æ®éƒ½åœ¨ä¸€ä¸ªæ–‡æ¡£å†…ï¼›è€Œå¼•ç”¨æ›´çµæ´»ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°ç»´æŠ¤å¤§é‡åŠ¨æ€å…³è”æ•°æ®, äº†è§£æ›´å¤š: MongoDB in Action: 4.2.1 Many-to-many relationships&lt;/p&gt;
</content>
    </item>
    
  </channel>
</rss>
