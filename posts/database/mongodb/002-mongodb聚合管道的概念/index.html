<!DOCTYPE html>
<html lang="en">
<head>
  
    
    <title>MongoDB èšåˆç®¡é“ä¸­çš„ (Stages å’Œ Operators) :: ä¸ºéœœçš„åšå®¢</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="1. ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜ 1.1. æ™®é€šæŸ¥è¯¢ var posts = await _postModel.Find(_ =&gt; true).ToListAsync(); List&lt;CommentModel&gt; allComments = new List&lt;CommentModel&gt;(); foreach (var post in posts) { if (post.CommentList != null &amp;&amp; post.CommentList.Any()) { allComments.AddRange(post.CommentList); } } return allComments; â—1. ä¼ è¾“çš„æ•°æ®ä½“ç§¯å¤§
ToListAsync() ä¼šæŠŠæ•´æ¡æ–‡æ¡£åŠ è½½è¿›å†…å­˜ï¼ŒåŒ…æ‹¬å¸–å­å†…å®¹ã€æ ‡é¢˜ã€æ ‡ç­¾ã€å›¾ç‰‡ç­‰ä¸€å †æ— å…³å­—æ®µ æ¯”å¦‚æ¯ä¸ªå¸–å­ 1MBï¼Œ1000 ä¸ªå¸–å­å°±æ˜¯ 1GB ç½‘ç»œä¼ è¾“é‡ï¼Œå“ªæ€•ä½ åªè¦å…¶ä¸­çš„è¯„è®º â—2. å†…å­˜å ç”¨é«˜
æ‰€æœ‰æ•°æ®éƒ½æ‹‰è¿›å†…å­˜ï¼Œå“ªæ€•ä½ åªå…³å¿ƒé‡Œé¢ä¸€å°å—æ•°æ®ï¼ˆæ¯”å¦‚ CommentListï¼‰ å¯¹äºå¤§é›†åˆã€é«˜å¹¶å‘æœåŠ¡ï¼Œè¿™ä¼šé€ æˆä¸¥é‡çš„èµ„æºæ¶ˆè€— â—3. å¤„ç†é€»è¾‘å†™åœ¨ä»£ç å±‚ï¼Œæ•ˆç‡ä½
ä½ è¦åœ¨ C# å±‚æ‰‹åŠ¨æ‹†è§£ã€éå†ã€ç»„åˆè¿™äº›æ•°æ®ï¼Œç›¸å½“äºè‡ªå·±åœ¨æ¨¡æ‹Ÿæ•°æ®åº“çš„å·¥ä½œï¼Œæ€§èƒ½è¿œä¸å¦‚æ•°æ®åº“åŸç”Ÿæ“ä½œ 1.2. èšåˆæŸ¥è¯¢ var pipeline = new BsonDocument[] { // ç¬¬ä¸€æ­¥ï¼šå±•å¼€ CommentList æ•°ç»„ // å¯¹æ¯ä¸ª Post æ–‡æ¡£ï¼Œå°† CommentList ä¸­çš„æ¯æ¡è¯„è®ºéƒ½â€œæ‹†å¼€â€ï¼Œæ¯æ¡è¯„è®ºå•ç‹¬å½¢æˆä¸€æ¡æ–‡æ¡£ new BsonDocument(&#34;$unwind&#34;, new BsonDocument(&#34;path&#34;, &#34;$CommentList&#34;) .Add(&#34;preserveNullAndEmptyArrays&#34;, false)), // å¦‚æœ CommentList æ˜¯ null æˆ–ç©ºæ•°ç»„ï¼Œåˆ™è·³è¿‡è¯¥æ–‡æ¡£ // ç¬¬äºŒæ­¥ï¼šæŠ•å½±å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—æ®µ // æˆ‘ä»¬åªè¦è¯„è®ºå†…å®¹ï¼ŒæŠŠå®ƒåŒ…è£…æˆ &#34;comment&#34; å­—æ®µï¼ŒåŒæ—¶å»æ‰ _id new BsonDocument(&#34;$project&#34;, new BsonDocument(&#34;_id&#34;, 0) // ä¸è¦ MongoDB çš„ ObjectId å­—æ®µ .Add(&#34;comment&#34;, &#34;$CommentList&#34;)), // æŠŠ CommentList çš„å½“å‰é¡¹å‘½åä¸º comment // ç¬¬ä¸‰æ­¥ï¼šæŠŠ comment ä½œä¸ºæ ¹èŠ‚ç‚¹ // æŠŠæ•´æ¡æ–‡æ¡£æ›¿æ¢ä¸º comment å­—æ®µçš„å†…å®¹ï¼Œç›¸å½“äºå»æ‰äº†å¤–å±‚åŒ…è£¹ new BsonDocument(&#34;$replaceRoot&#34;, new BsonDocument(&#34;newRoot&#34;, &#34;$comment&#34;)) }; // æ‰§è¡Œèšåˆç®¡é“ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ç»„ CommentModel ç±»å‹çš„åˆ—è¡¨ var comments = await _postModel.Aggregate&lt;CommentModel&gt;(pipeline).ToListAsync(); return comments; âœ…1. åªå–éœ€è¦çš„æ•°æ®
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.jiyi27.com/posts/database/mongodb/002-mongodb%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93%E7%9A%84%E6%A6%82%E5%BF%B5/" />





  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/categories.min.3202f75cbb294747099af3850a68a09ee94b3ce505fc39e134692d90ff0a9b2a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/code.min.dd73d157e77e82a3dc1cb06ba424cf6cc6811af0bb604ad6c68e70faf2439c8a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/main.min.3fb8954e26342ad3afabb4525959bfec6f9fc0d6929f0dda738ddeee30211690.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/menu.min.8cee75f73b9f9b1e40bd0dd53e6e770156b08bbfe1c579cd256c3f6cd3b6d32b.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/post.min.014a50745fbdd41d5f420a3e288730d5af4b7d90344dc6211d0e50c368b5b303.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/prism.min.b958d3d7c6c67361b945f9062d07d403422604b3d2cd33f93b88d41ed0ba634d.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/term.min.94de320c1b850e126e6d2c88a7c90acf58bb1313f0ea14a14cda2a42f2a88db2.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.jiyi27.com/terminal.css">




<link rel="shortcut icon" href="https://blog.jiyi27.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.jiyi27.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="MongoDB èšåˆç®¡é“ä¸­çš„ (Stages å’Œ Operators)">
<meta property="og:description" content="1. ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜ 1.1. æ™®é€šæŸ¥è¯¢ var posts = await _postModel.Find(_ =&gt; true).ToListAsync(); List&lt;CommentModel&gt; allComments = new List&lt;CommentModel&gt;(); foreach (var post in posts) { if (post.CommentList != null &amp;&amp; post.CommentList.Any()) { allComments.AddRange(post.CommentList); } } return allComments; â—1. ä¼ è¾“çš„æ•°æ®ä½“ç§¯å¤§
ToListAsync() ä¼šæŠŠæ•´æ¡æ–‡æ¡£åŠ è½½è¿›å†…å­˜ï¼ŒåŒ…æ‹¬å¸–å­å†…å®¹ã€æ ‡é¢˜ã€æ ‡ç­¾ã€å›¾ç‰‡ç­‰ä¸€å †æ— å…³å­—æ®µ æ¯”å¦‚æ¯ä¸ªå¸–å­ 1MBï¼Œ1000 ä¸ªå¸–å­å°±æ˜¯ 1GB ç½‘ç»œä¼ è¾“é‡ï¼Œå“ªæ€•ä½ åªè¦å…¶ä¸­çš„è¯„è®º â—2. å†…å­˜å ç”¨é«˜
æ‰€æœ‰æ•°æ®éƒ½æ‹‰è¿›å†…å­˜ï¼Œå“ªæ€•ä½ åªå…³å¿ƒé‡Œé¢ä¸€å°å—æ•°æ®ï¼ˆæ¯”å¦‚ CommentListï¼‰ å¯¹äºå¤§é›†åˆã€é«˜å¹¶å‘æœåŠ¡ï¼Œè¿™ä¼šé€ æˆä¸¥é‡çš„èµ„æºæ¶ˆè€— â—3. å¤„ç†é€»è¾‘å†™åœ¨ä»£ç å±‚ï¼Œæ•ˆç‡ä½
ä½ è¦åœ¨ C# å±‚æ‰‹åŠ¨æ‹†è§£ã€éå†ã€ç»„åˆè¿™äº›æ•°æ®ï¼Œç›¸å½“äºè‡ªå·±åœ¨æ¨¡æ‹Ÿæ•°æ®åº“çš„å·¥ä½œï¼Œæ€§èƒ½è¿œä¸å¦‚æ•°æ®åº“åŸç”Ÿæ“ä½œ 1.2. èšåˆæŸ¥è¯¢ var pipeline = new BsonDocument[] { // ç¬¬ä¸€æ­¥ï¼šå±•å¼€ CommentList æ•°ç»„ // å¯¹æ¯ä¸ª Post æ–‡æ¡£ï¼Œå°† CommentList ä¸­çš„æ¯æ¡è¯„è®ºéƒ½â€œæ‹†å¼€â€ï¼Œæ¯æ¡è¯„è®ºå•ç‹¬å½¢æˆä¸€æ¡æ–‡æ¡£ new BsonDocument(&#34;$unwind&#34;, new BsonDocument(&#34;path&#34;, &#34;$CommentList&#34;) .Add(&#34;preserveNullAndEmptyArrays&#34;, false)), // å¦‚æœ CommentList æ˜¯ null æˆ–ç©ºæ•°ç»„ï¼Œåˆ™è·³è¿‡è¯¥æ–‡æ¡£ // ç¬¬äºŒæ­¥ï¼šæŠ•å½±å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—æ®µ // æˆ‘ä»¬åªè¦è¯„è®ºå†…å®¹ï¼ŒæŠŠå®ƒåŒ…è£…æˆ &#34;comment&#34; å­—æ®µï¼ŒåŒæ—¶å»æ‰ _id new BsonDocument(&#34;$project&#34;, new BsonDocument(&#34;_id&#34;, 0) // ä¸è¦ MongoDB çš„ ObjectId å­—æ®µ .Add(&#34;comment&#34;, &#34;$CommentList&#34;)), // æŠŠ CommentList çš„å½“å‰é¡¹å‘½åä¸º comment // ç¬¬ä¸‰æ­¥ï¼šæŠŠ comment ä½œä¸ºæ ¹èŠ‚ç‚¹ // æŠŠæ•´æ¡æ–‡æ¡£æ›¿æ¢ä¸º comment å­—æ®µçš„å†…å®¹ï¼Œç›¸å½“äºå»æ‰äº†å¤–å±‚åŒ…è£¹ new BsonDocument(&#34;$replaceRoot&#34;, new BsonDocument(&#34;newRoot&#34;, &#34;$comment&#34;)) }; // æ‰§è¡Œèšåˆç®¡é“ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ç»„ CommentModel ç±»å‹çš„åˆ—è¡¨ var comments = await _postModel.Aggregate&lt;CommentModel&gt;(pipeline).ToListAsync(); return comments; âœ…1. åªå–éœ€è¦çš„æ•°æ®
" />
<meta property="og:url" content="https://blog.jiyi27.com/posts/database/mongodb/002-mongodb%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93%E7%9A%84%E6%A6%82%E5%BF%B5/" />
<meta property="og:site_name" content="ä¸ºéœœçš„åšå®¢" />

  <meta property="og:image" content="https://blog.jiyi27.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="æ•°æ®åº“" />


  <meta property="article:published_time" content="2025-04-19 22:20:18 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  
  
  

  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.jiyi27.com/posts/database/mongodb/002-mongodb%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93%E7%9A%84%E6%A6%82%E5%BF%B5/">MongoDB èšåˆç®¡é“ä¸­çš„ (Stages å’Œ Operators)</a>
  </h1>
  <div class="post-meta"><time class="post-date">2025-04-19</time><span class="post-reading-time">5 åˆ†é’Ÿé˜…è¯» (994 å­—æ•°)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.jiyi27.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">æ•°æ®åº“</a>&nbsp;
      
      #<a href="https://blog.jiyi27.com/tags/mongodb/">mongodb</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h2 id="1-ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜">1. ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜<a href="#1-ä¸ºä½•èšåˆç®¡é“æ•ˆç‡æ›´é«˜" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="11-æ™®é€šæŸ¥è¯¢">1.1. æ™®é€šæŸ¥è¯¢<a href="#11-æ™®é€šæŸ¥è¯¢" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> posts = <span style="color:#66d9ef">await</span> _postModel.Find(_ =&gt; <span style="color:#66d9ef">true</span>).ToListAsync();
</span></span><span style="display:flex;"><span>List&lt;CommentModel&gt; allComments = <span style="color:#66d9ef">new</span> List&lt;CommentModel&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> post <span style="color:#66d9ef">in</span> posts)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (post.CommentList != <span style="color:#66d9ef">null</span> &amp;&amp; post.CommentList.Any())
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        allComments.AddRange(post.CommentList);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> allComments;
</span></span></code></pre></div><p>â—1. <strong>ä¼ è¾“çš„æ•°æ®ä½“ç§¯å¤§</strong></p>
<ul>
<li><code>ToListAsync()</code> ä¼šæŠŠ<strong>æ•´æ¡æ–‡æ¡£åŠ è½½è¿›å†…å­˜</strong>ï¼ŒåŒ…æ‹¬å¸–å­å†…å®¹ã€æ ‡é¢˜ã€æ ‡ç­¾ã€å›¾ç‰‡ç­‰ä¸€å †æ— å…³å­—æ®µ</li>
<li>æ¯”å¦‚æ¯ä¸ªå¸–å­ 1MBï¼Œ1000 ä¸ªå¸–å­å°±æ˜¯ 1GB ç½‘ç»œä¼ è¾“é‡ï¼Œå“ªæ€•ä½ åªè¦å…¶ä¸­çš„è¯„è®º</li>
</ul>
<p>â—2. <strong>å†…å­˜å ç”¨é«˜</strong></p>
<ul>
<li>æ‰€æœ‰æ•°æ®éƒ½æ‹‰è¿›å†…å­˜ï¼Œå“ªæ€•ä½ åªå…³å¿ƒé‡Œé¢ä¸€å°å—æ•°æ®ï¼ˆæ¯”å¦‚ <code>CommentList</code>ï¼‰</li>
<li>å¯¹äºå¤§é›†åˆã€é«˜å¹¶å‘æœåŠ¡ï¼Œè¿™ä¼šé€ æˆä¸¥é‡çš„èµ„æºæ¶ˆè€—</li>
</ul>
<p>â—3. <strong>å¤„ç†é€»è¾‘å†™åœ¨ä»£ç å±‚ï¼Œæ•ˆç‡ä½</strong></p>
<ul>
<li>ä½ è¦åœ¨ C# å±‚æ‰‹åŠ¨æ‹†è§£ã€éå†ã€ç»„åˆè¿™äº›æ•°æ®ï¼Œç›¸å½“äºè‡ªå·±åœ¨æ¨¡æ‹Ÿæ•°æ®åº“çš„å·¥ä½œï¼Œæ€§èƒ½è¿œä¸å¦‚æ•°æ®åº“åŸç”Ÿæ“ä½œ</li>
</ul>
<h3 id="12-èšåˆæŸ¥è¯¢">1.2. èšåˆæŸ¥è¯¢<a href="#12-èšåˆæŸ¥è¯¢" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> pipeline = <span style="color:#66d9ef">new</span> BsonDocument[]
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç¬¬ä¸€æ­¥ï¼šå±•å¼€ CommentList æ•°ç»„</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¯¹æ¯ä¸ª Post æ–‡æ¡£ï¼Œå°† CommentList ä¸­çš„æ¯æ¡è¯„è®ºéƒ½â€œæ‹†å¼€â€ï¼Œæ¯æ¡è¯„è®ºå•ç‹¬å½¢æˆä¸€æ¡æ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> BsonDocument(<span style="color:#e6db74">&#34;$unwind&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> BsonDocument(<span style="color:#e6db74">&#34;path&#34;</span>, <span style="color:#e6db74">&#34;$CommentList&#34;</span>)
</span></span><span style="display:flex;"><span>            .Add(<span style="color:#e6db74">&#34;preserveNullAndEmptyArrays&#34;</span>, <span style="color:#66d9ef">false</span>)), <span style="color:#75715e">// å¦‚æœ CommentList æ˜¯ null æˆ–ç©ºæ•°ç»„ï¼Œåˆ™è·³è¿‡è¯¥æ–‡æ¡£</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç¬¬äºŒæ­¥ï¼šæŠ•å½±å‡ºæˆ‘ä»¬æ„Ÿå…´è¶£çš„å­—æ®µ</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æˆ‘ä»¬åªè¦è¯„è®ºå†…å®¹ï¼ŒæŠŠå®ƒåŒ…è£…æˆ &#34;comment&#34; å­—æ®µï¼ŒåŒæ—¶å»æ‰ _id</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> BsonDocument(<span style="color:#e6db74">&#34;$project&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> BsonDocument(<span style="color:#e6db74">&#34;_id&#34;</span>, <span style="color:#ae81ff">0</span>) <span style="color:#75715e">// ä¸è¦ MongoDB çš„ ObjectId å­—æ®µ</span>
</span></span><span style="display:flex;"><span>            .Add(<span style="color:#e6db74">&#34;comment&#34;</span>, <span style="color:#e6db74">&#34;$CommentList&#34;</span>)), <span style="color:#75715e">// æŠŠ CommentList çš„å½“å‰é¡¹å‘½åä¸º comment</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ç¬¬ä¸‰æ­¥ï¼šæŠŠ comment ä½œä¸ºæ ¹èŠ‚ç‚¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æŠŠæ•´æ¡æ–‡æ¡£æ›¿æ¢ä¸º comment å­—æ®µçš„å†…å®¹ï¼Œç›¸å½“äºå»æ‰äº†å¤–å±‚åŒ…è£¹</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">new</span> BsonDocument(<span style="color:#e6db74">&#34;$replaceRoot&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> BsonDocument(<span style="color:#e6db74">&#34;newRoot&#34;</span>, <span style="color:#e6db74">&#34;$comment&#34;</span>))
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ‰§è¡Œèšåˆç®¡é“ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ç»„ CommentModel ç±»å‹çš„åˆ—è¡¨</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> comments = <span style="color:#66d9ef">await</span> _postModel.Aggregate&lt;CommentModel&gt;(pipeline).ToListAsync();
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">return</span> comments;
</span></span></code></pre></div><p>âœ…1. <strong>åªå–éœ€è¦çš„æ•°æ®</strong></p>
<ul>
<li>èšåˆç®¡é“ä¸­ç”¨ <code>$project</code> å’Œ <code>$replaceRoot</code> ç²¾ç¡®è¿‡æ»¤å‡ºã€Œä½ æƒ³è¦çš„å­—æ®µã€ï¼Œå‡å°‘ç½‘ç»œè´Ÿæ‹…</li>
</ul>
<p>âœ…2. <strong>ç”±æ•°æ®åº“é«˜æ•ˆå¤„ç†æ•°æ®ç»“æ„</strong></p>
<ul>
<li>MongoDB å†…éƒ¨åšå±•å¼€ã€æ˜ å°„ã€è¿‡æ»¤ï¼Œä½¿ç”¨åŸç”Ÿçš„ C++ å¼•æ“ï¼Œé€Ÿåº¦è¿œè¿œå¿«äº C# éå†</li>
</ul>
<p>âœ…3. <strong>èŠ‚çœå†…å­˜ä¸è®¡ç®—èµ„æº</strong></p>
<ul>
<li>ä¸éœ€è¦æŠŠæ•´æ¡å¤§æ–‡æ¡£æ‹‰è¿›æ¥ï¼Œåªéœ€è¦ä» MongoDB æ‹¿ä½ æƒ³è¦çš„éƒ¨åˆ†ï¼ŒC# å±‚ä»£ç ä¹Ÿå˜å¾—éå¸¸è½»é‡</li>
</ul>
<p>âœ…4. <strong>å¯ä»¥åœ¨èšåˆä¸­åšæ›´å¤æ‚æ“ä½œ</strong></p>
<ul>
<li>æƒ³åšæ’åºã€è¿‡æ»¤ã€åˆ†é¡µç­‰æ“ä½œï¼Ÿèšåˆæ”¯æŒ <code>$match</code>ã€<code>$sort</code>ã€<code>$limit</code>ï¼Œè®©æ•°æ®åº“å¸®ä½ å®Œæˆè¿™äº›é€»è¾‘</li>
</ul>
<h2 id="2-unwind-project-replaceroot">2. <code>unwind</code>, <code>project</code>, <code>replaceRoot</code><a href="#2-unwind-project-replaceroot" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>åœ¨ä¸Šé¢çš„èšåˆç®¡é“ä¸­, æˆ‘ä»¬ç”¨äº†:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">$unwind</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;$CommentList&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$project</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">comment</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;$CommentList&#34;</span> }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$replaceRoot</span><span style="color:#f92672">:</span> { <span style="color:#a6e22e">newRoot</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;$comment&#34;</span> }
</span></span></code></pre></div><p>MongoDB ä¼šæŠŠæ¯ä¸ªè¯„è®ºéƒ½<strong>å•ç‹¬å±•å¼€æˆä¸€æ¡ç»“æœæ–‡æ¡£</strong>ï¼Œåƒè¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  { <span style="color:#e6db74">&#34;Author&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;å°æ˜&#34;</span>, <span style="color:#e6db74">&#34;Content&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;å†™å¾—ä¸é”™&#34;</span>, <span style="color:#e6db74">&#34;CreatedAt&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;...&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#e6db74">&#34;Author&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;å°çº¢&#34;</span>, <span style="color:#e6db74">&#34;Content&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;é¡¶ä¸€ä¸ª&#34;</span>, <span style="color:#e6db74">&#34;CreatedAt&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;...&#34;</span> },
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>æ¯æ¡ç»“æœå°±æ˜¯ä¸€ä¸ªçº¯ç²¹çš„ <code>CommentModel</code>ï¼Œæ‰€ä»¥ï¼šèšåˆåè¿”å›çš„æ¯ä¸€æ¡è®°å½•æ˜¯ä¸€ä¸ª <code>CommentModel</code> å®ä¾‹ï¼Œç»„æˆçš„æ•´ä½“å°±æ˜¯ä¸€ä¸ª <code>List&lt;CommentModel&gt;</code></p>
<p>å‡è®¾æœ‰ä¸€ä¸ªå¸–å­é›†åˆ <code>posts</code>ï¼Œæ¯æ¡æ–‡æ¡£ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;MongoDB èšåˆç¤ºä¾‹&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;CommentList&#34;</span>: [
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;Nice post!&#34;</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Bob&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;I agree!&#34;</span> }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æˆ‘ä»¬ç›®æ ‡æ˜¯ï¼šä»æ•´ä¸ª posts é›†åˆä¸­ï¼Œ<strong>æå–å‡ºæ¯ä¸€æ¡ç‹¬ç«‹çš„è¯„è®ºï¼ˆCommentModelï¼‰</strong>ï¼Œä¸å¸¦å…¶ä»–å­—æ®µ</p>
<h3 id="21-ç¬¬ä¸€æ­¥-unwind--å±•å¼€æ•°ç»„å­—æ®µ">2.1. ç¬¬ä¸€æ­¥ <code>$unwind</code> â€”â€” <strong>å±•å¼€æ•°ç»„å­—æ®µ</strong><a href="#21-ç¬¬ä¸€æ­¥-unwind--å±•å¼€æ•°ç»„å­—æ®µ" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><strong>âœ… è¯­æ³•ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{ <span style="color:#f92672">&#34;$unwind&#34;</span>: { <span style="color:#f92672">&#34;path&#34;</span>: <span style="color:#e6db74">&#34;$CommentList&#34;</span>, <span style="color:#f92672">&#34;preserveNullAndEmptyArrays&#34;</span>: <span style="color:#66d9ef">false</span> } }
</span></span></code></pre></div><p><strong>âœ… å‚æ•°è§£é‡Šï¼š</strong></p>
<ul>
<li><code>path</code>: è¦å±•å¼€çš„æ•°ç»„å­—æ®µï¼Œ<strong>å¿…é¡»æ˜¯æ•°ç»„</strong>ï¼ˆè¿™é‡Œæ˜¯ <code>CommentList</code>ï¼‰</li>
<li><code>preserveNullAndEmptyArrays</code>: æ˜¯å¦ä¿ç•™ç©ºæ•°ç»„æˆ–ä¸å­˜åœ¨è¯¥å­—æ®µçš„æ–‡æ¡£
<ul>
<li><code>false</code> è¡¨ç¤ºä¸ä¿ç•™ï¼ˆåªå¤„ç†æœ‰è¯„è®ºçš„æ–‡æ¡£ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>âœ… æ•ˆæœï¼š</strong></p>
<p>è¿™ä¸€æ­¥çš„ä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p>å¦‚æœä¸€ä¸ªæ–‡æ¡£ä¸­çš„ <code>CommentList</code> æ˜¯ä¸€ä¸ªæ•°ç»„, å®ƒä¼š<strong>æŠŠæ•°ç»„é‡Œçš„æ¯ä¸ªå…ƒç´ æ‹†åˆ†ä¸ºä¸€æ¡æ–°çš„æ–‡æ¡£</strong></p>
</blockquote>
<p>ğŸ” åŸå§‹æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;CommentList&#34;</span>: [
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;Nice post!&#34;</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Bob&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;I agree!&#34;</span> }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ“¤ ç»è¿‡ <code>$unwind</code> åå˜æˆä¸¤æ¡è®°å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;CommentList&#34;</span>: { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;Nice post!&#34;</span> }
</span></span><span style="display:flex;"><span>}<span style="color:#960050;background-color:#1e0010">,</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;CommentList&#34;</span>: { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Bob&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;I agree!&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ¯æ¡ç»“æœéƒ½åªåŒ…å«<strong>ä¸€ä¸ªè¯„è®ºå¯¹è±¡</strong>åœ¨ <code>CommentList</code> å­—æ®µä¸­ï¼ˆå·²ç»ä¸æ˜¯æ•°ç»„äº†ï¼‰</p>
<h3 id="22-ç¬¬äºŒæ­¥-project--ä¿ç•™æˆ‘ä»¬å…³å¿ƒçš„å­—æ®µå¹¶é‡æ–°å‘½å">2.2. ç¬¬äºŒæ­¥ <code>$project</code> â€”â€” <strong>ä¿ç•™æˆ‘ä»¬å…³å¿ƒçš„å­—æ®µï¼Œå¹¶é‡æ–°å‘½å</strong><a href="#22-ç¬¬äºŒæ­¥-project--ä¿ç•™æˆ‘ä»¬å…³å¿ƒçš„å­—æ®µå¹¶é‡æ–°å‘½å" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><strong>âœ… è¯­æ³•ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{ <span style="color:#f92672">&#34;$project&#34;</span>: { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#f92672">&#34;comment&#34;</span>: <span style="color:#e6db74">&#34;$CommentList&#34;</span> } }
</span></span></code></pre></div><p><strong>âœ… å‚æ•°è§£é‡Šï¼š</strong></p>
<ul>
<li>
<p><code>_id: 0</code>ï¼šä¸æ˜¾ç¤º MongoDB é»˜è®¤çš„ <code>_id</code> å­—æ®µ</p>
</li>
<li>
<p><code>&quot;comment&quot;: &quot;$CommentList&quot;</code>ï¼šæŠŠ <code>CommentList</code> å­—æ®µçš„å†…å®¹èµ‹å€¼ç»™ä¸€ä¸ªæ–°å­—æ®µ <code>comment</code></p>
</li>
</ul>
<p><strong>ğŸ” ä¸Šä¸€æ­¥è¾“å‡ºï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;post1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;CommentList&#34;</span>: { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;Nice post!&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>ğŸ“¤ å˜æˆï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;comment&#34;</span>: { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;Nice post!&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ’¡ æˆ‘ä»¬åªä¿ç•™äº†è¯„è®ºè¿™éƒ¨åˆ†æ•°æ®ï¼Œå­—æ®µåå˜æˆäº† <code>comment</code>ï¼Œ<strong>æ›´å¥½å¤„ç†ä¸‹ä¸€æ­¥çš„ç»“æ„å˜æ¢</strong></p>
<h3 id="23-ç¬¬ä¸‰æ­¥-replaceroot--è®©-comment-æˆä¸ºæ–°æ–‡æ¡£çš„æ ¹éƒ¨">2.3. ç¬¬ä¸‰æ­¥ <code>$replaceRoot</code> â€”â€” <strong>è®© comment æˆä¸ºæ–°æ–‡æ¡£çš„æ ¹éƒ¨</strong><a href="#23-ç¬¬ä¸‰æ­¥-replaceroot--è®©-comment-æˆä¸ºæ–°æ–‡æ¡£çš„æ ¹éƒ¨" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>âœ… è¯­æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{ <span style="color:#f92672">&#34;$replaceRoot&#34;</span>: { <span style="color:#f92672">&#34;newRoot&#34;</span>: <span style="color:#e6db74">&#34;$comment&#34;</span> } }
</span></span></code></pre></div><p><strong>âœ… å‚æ•°è§£é‡Š</strong></p>
<ul>
<li><code>newRoot</code>: ç”¨å“ªä¸ªå­—æ®µçš„å€¼<strong>æ›¿æ¢æ‰å½“å‰æ–‡æ¡£çš„æ ¹</strong></li>
</ul>
<p><strong>ğŸ” ä¸Šä¸€æ­¥è¾“å‡ºï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;comment&#34;</span>: { <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>, <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;Nice post!&#34;</span> }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>ğŸ“¤ å˜æˆï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Author&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;Content&#34;</span>: <span style="color:#e6db74">&#34;Nice post!&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ğŸ’¡ <code>comment</code> å­—æ®µé‡Œçš„å†…å®¹è¢«<strong>æå–æˆäº†é¡¶å±‚å­—æ®µ</strong>ï¼Œæ­£æ˜¯ä½ æœ€ç»ˆæƒ³è¦çš„ç»“æ„ï¼šä¸€ä¸ªå¹²å‡€çš„ <code>CommentModel</code></p>
<h2 id="3-group-sum">3. <code>$group</code>, <code>$sum</code><a href="#3-group-sum" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé›†åˆ <code>orders</code>ï¼Œå®ƒå­˜å‚¨äº†å®¢æˆ·è®¢å•ï¼Œç»“æ„å¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&#34;orderStatus&#34;</span>: <span style="color:#e6db74">&#34;pending&#34;</span>, <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">100</span>, <span style="color:#f92672">&#34;customer&#34;</span>: <span style="color:#e6db74">&#34;Alice&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#f92672">&#34;orderStatus&#34;</span>: <span style="color:#e6db74">&#34;processing&#34;</span>, <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">200</span>, <span style="color:#f92672">&#34;customer&#34;</span>: <span style="color:#e6db74">&#34;Bob&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#f92672">&#34;orderStatus&#34;</span>: <span style="color:#e6db74">&#34;completed&#34;</span>, <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">150</span>, <span style="color:#f92672">&#34;customer&#34;</span>: <span style="color:#e6db74">&#34;Charlie&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">4</span>, <span style="color:#f92672">&#34;orderStatus&#34;</span>: <span style="color:#e6db74">&#34;pending&#34;</span>, <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">300</span>, <span style="color:#f92672">&#34;customer&#34;</span>: <span style="color:#e6db74">&#34;Dave&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">5</span>, <span style="color:#f92672">&#34;orderStatus&#34;</span>: <span style="color:#e6db74">&#34;completed&#34;</span>, <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">250</span>, <span style="color:#f92672">&#34;customer&#34;</span>: <span style="color:#e6db74">&#34;Eve&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">6</span>, <span style="color:#f92672">&#34;orderStatus&#34;</span>: <span style="color:#e6db74">&#34;processing&#34;</span>, <span style="color:#f92672">&#34;amount&#34;</span>: <span style="color:#ae81ff">400</span>, <span style="color:#f92672">&#34;customer&#34;</span>: <span style="color:#e6db74">&#34;Frank&#34;</span> }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>ç›®æ ‡æ˜¯é€šè¿‡èšåˆç®¡é“ç»Ÿè®¡æ¯ä¸ªè®¢å•çŠ¶æ€ï¼ˆ<code>orderStatus</code>ï¼‰çš„è®¢å•æ•°é‡ï¼Œä¾‹å¦‚æœ‰å¤šå°‘è®¢å•æ˜¯ <code>pending</code>ã€<code>processing</code> å’Œ <code>completed</code>, ä½¿ç”¨ä¸€ä¸ª <code>$group</code> èšåˆé˜¶æ®µé…åˆä¸€ä¸ªèšåˆè¿ç®—ç¬¦ <code>$sum</code> å°±å¯ä»¥å®ç°:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;$group&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;$orderStatus&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;count&#34;</span>: { <span style="color:#e6db74">&#34;$sum&#34;</span>: <span style="color:#ae81ff">1</span> }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li><code>&quot;_id&quot;: &quot;$orderStatus&quot;</code> å‘Šè¯‰ MongoDB æ ¹æ® <code>orderStatus</code> å­—æ®µçš„å€¼å°†æ–‡æ¡£åˆ†ç»„</li>
<li>MongoDB ä¼š<strong>æ‰«æé›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£</strong>ï¼Œè¯»å– <code>orderStatus</code> çš„å€¼ï¼Œå¹¶å°†å…·æœ‰ç›¸åŒ <code>orderStatus</code> å€¼çš„æ–‡æ¡£å½’ä¸ºä¸€ç»„</li>
<li><code>$sum: 1</code> çš„è®¡æ•°è¿‡ç¨‹
<ul>
<li>å¯¹äºæ¯ä¸ªåˆ†ç»„ï¼ŒMongoDB <strong>åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£</strong>ï¼ŒåŒ…å« <code>_id</code>ï¼ˆåˆ†ç»„é”®çš„å€¼ï¼Œä¾‹å¦‚ &ldquo;pending&rdquo;ï¼‰å’Œ <code>count</code> å­—æ®µï¼ˆç”± $sum: 1 å®šä¹‰ï¼‰ <code>count</code> åˆå§‹å€¼ä¸º 0</li>
<li>ä¹Ÿå°±æ˜¯è¯´, MongoDB ä¼šåˆ›å»ºä¸‰ä¸ªæ–‡æ¡£(å› ä¸ºä¸€å…±æœ‰ä¸‰ä¸ªçŠ¶æ€), æ¯ä¸ªæ–‡æ¡£çš„åˆ†ç»„é”® <code>_id</code> çš„å€¼éƒ½æ˜¯å¯¹åº”çš„çŠ¶æ€å€¼</li>
<li>MongoDB æŒ‰é¡ºåºï¼ˆæˆ–ä¼˜åŒ–åçš„é¡ºåºï¼‰éå†é›†åˆä¸­çš„æ¯ä¸ªæ–‡æ¡£ï¼Œæ£€æŸ¥å…¶ <code>orderStatus</code>ï¼Œå¹¶å°†å…¶åˆ†é…åˆ°å¯¹åº”çš„åˆ†ç»„</li>
<li>å¯¹äºæ¯ä¸ªæ–‡æ¡£ï¼Œ<code>$sum: 1</code> è¡¨ç¤ºå°†è¯¥æ–‡æ¡£çš„  <code>count</code> å­—æ®µçš„å€¼å¢åŠ  1, æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªæ–‡æ¡£ä¸ºå®ƒæ‰€åœ¨åˆ†ç»„çš„ <code>count</code> è´¡çŒ® 1</li>
</ul>
</li>
</ul>
<p>ç»è¿‡ <code>$group</code> é˜¶æ®µï¼Œæ•°æ®è¢«è½¬æ¢ä¸ºä»¥ä¸‹å½¢å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;pending&#34;</span>, <span style="color:#f92672">&#34;count&#34;</span>: <span style="color:#ae81ff">2</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;processing&#34;</span>, <span style="color:#f92672">&#34;count&#34;</span>: <span style="color:#ae81ff">2</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;completed&#34;</span>, <span style="color:#f92672">&#34;count&#34;</span>: <span style="color:#ae81ff">2</span> }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h2 id="4-operators-vs-stages">4. Operators vs Stages<a href="#4-operators-vs-stages" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="41-èšåˆé˜¶æ®µaggregation-stages">4.1. èšåˆé˜¶æ®µï¼ˆAggregation Stagesï¼‰<a href="#41-èšåˆé˜¶æ®µaggregation-stages" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>æ„æˆèšåˆç®¡é“çš„â€œæ¯ä¸€æ­¥â€</p>
<table>
  <thead>
      <tr>
          <th>èšåˆé˜¶æ®µ</th>
          <th>åŠŸèƒ½</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>$match</code></td>
          <td>è¿‡æ»¤æ–‡æ¡£ï¼ˆç±»ä¼¼ SQL çš„ <code>WHERE</code>ï¼‰</td>
      </tr>
      <tr>
          <td><code>$group</code></td>
          <td>åˆ†ç»„å¹¶è¿›è¡Œèšåˆè®¡ç®—ï¼ˆç±»ä¼¼ SQL çš„ <code>GROUP BY</code>ï¼‰</td>
      </tr>
      <tr>
          <td><code>$project</code></td>
          <td>æŠ•å½±å­—æ®µï¼ˆç±»ä¼¼ SQL çš„ <code>SELECT column AS ...</code>ï¼‰</td>
      </tr>
      <tr>
          <td><code>$sort</code></td>
          <td>æ’åº</td>
      </tr>
      <tr>
          <td><code>$limit</code> / <code>$skip</code></td>
          <td>åˆ†é¡µ</td>
      </tr>
      <tr>
          <td><code>$lookup</code></td>
          <td>ç±»ä¼¼ SQL çš„ <code>JOIN</code></td>
      </tr>
  </tbody>
</table>
<h3 id="42--èšåˆè¿ç®—ç¬¦aggregation-operators">4.2.  èšåˆè¿ç®—ç¬¦ï¼ˆAggregation Operatorsï¼‰<a href="#42--èšåˆè¿ç®—ç¬¦aggregation-operators" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>åœ¨æŸäº›é˜¶æ®µå†…éƒ¨ä½¿ç”¨çš„â€œå‡½æ•°â€ï¼Œæ¯”å¦‚ <code>$group</code> é˜¶æ®µé‡Œé¢å¸¸ç”¨çš„ï¼š</p>
<table>
  <thead>
      <tr>
          <th>èšåˆè¿ç®—ç¬¦</th>
          <th>ç”¨æ³•</th>
          <th>ç±»ä¼¼ SQL å‡½æ•°</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>$sum</code></td>
          <td>æ±‚å’Œæˆ–è®¡æ•°</td>
          <td><code>SUM()</code> / <code>COUNT()</code></td>
      </tr>
      <tr>
          <td><code>$avg</code></td>
          <td>æ±‚å¹³å‡</td>
          <td><code>AVG()</code></td>
      </tr>
      <tr>
          <td><code>$min</code> / <code>$max</code></td>
          <td>æœ€å°/æœ€å¤§å€¼</td>
          <td><code>MIN()</code> / <code>MAX()</code></td>
      </tr>
  </tbody>
</table>
<h2 id="5-sum-vs--group">5. <code>$sum</code> vs  <code>$group</code><a href="#5-sum-vs--group" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p><code>$sum</code> æ˜¯èšåˆè¿ç®—ç¬¦, ä¸ <code>$group</code> èšåˆé˜¶æ®µä¸åŒ, <strong>ä¸€ä¸ªæŸ¥è¯¢èšåˆç®¡é“ç”±å¤šä¸ªèšåˆé˜¶æ®µç»„æˆ</strong>, æ¯ä¸ªèšåˆé˜¶æ®µéƒ½å®šä¹‰äº†ä¸€ä¸ªæ–°çš„æ–‡æ¡£, å¯ä»¥ç†è§£ä¸ºæ¯ä¸ªèšåˆé˜¶æ®µ stage éƒ½ä¼šå¯¹è¾“å…¥çš„æ–‡æ¡£æµè¿›è¡Œå¤„ç†ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„æ–‡æ¡£æµï¼ˆå¯ä»¥æ˜¯è½¬æ¢åçš„æ–‡æ¡£ã€è¿‡æ»¤åçš„æ–‡æ¡£ã€åˆ†ç»„åçš„æ–‡æ¡£ç­‰ï¼‰</p>
<h3 id="51-ä¸šåŠ¡é€»è¾‘">5.1. ä¸šåŠ¡é€»è¾‘<a href="#51-ä¸šåŠ¡é€»è¾‘" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#e6db74">&#34;Laptop&#34;</span>, <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Electronics&#34;</span>, <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">1000</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#f92672">&#34;orderDate&#34;</span>: <span style="color:#e6db74">&#34;2023-01-10&#34;</span>, <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;North&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#e6db74">&#34;Phone&#34;</span>, <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Electronics&#34;</span>, <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">500</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">5</span>, <span style="color:#f92672">&#34;orderDate&#34;</span>: <span style="color:#e6db74">&#34;2023-01-15&#34;</span>, <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;South&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#e6db74">&#34;Desk&#34;</span>, <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Furniture&#34;</span>, <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">200</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&#34;orderDate&#34;</span>: <span style="color:#e6db74">&#34;2023-02-01&#34;</span>, <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;North&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">4</span>, <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#e6db74">&#34;Chair&#34;</span>, <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Furniture&#34;</span>, <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">100</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">4</span>, <span style="color:#f92672">&#34;orderDate&#34;</span>: <span style="color:#e6db74">&#34;2023-02-10&#34;</span>, <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;South&#34;</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">5</span>, <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#e6db74">&#34;Tablet&#34;</span>, <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Electronics&#34;</span>, <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#ae81ff">300</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#f92672">&#34;orderDate&#34;</span>: <span style="color:#e6db74">&#34;2023-03-01&#34;</span>, <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;North&#34;</span> }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>æˆ‘ä»¬æƒ³åˆ†æ 2023 å¹´ 1 æœˆå’Œ 2 æœˆçš„é”€å”®æ•°æ®ï¼Œç­›é€‰å‡º <code>Electronics</code> ç±»åˆ«ï¼ŒæŒ‰ <code>region</code> åˆ†ç»„ï¼Œè®¡ç®—æ¯ä¸ªåœ°åŒºçš„æ€»é”€å”®é¢ï¼ˆ<code>price * quantity</code>ï¼‰ï¼Œå¹¶æŒ‰æ€»é”€å”®é¢é™åºæ’åºï¼Œè¾“å‡ºç‰¹å®šå­—æ®µ, ä»¥ä¸‹æ˜¯å¯¹åº”çš„èšåˆç®¡é“ï¼ˆç”¨ MongoDB çš„ <code>BSON</code> æ ¼å¼è¡¨ç¤ºï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;$match&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Electronics&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;orderDate&#34;</span>: { <span style="color:#f92672">&#34;$gte&#34;</span>: <span style="color:#e6db74">&#34;2023-01-01&#34;</span>, <span style="color:#f92672">&#34;$lte&#34;</span>: <span style="color:#e6db74">&#34;2023-02-28&#34;</span> }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;$project&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;totalSale&#34;</span>: { <span style="color:#f92672">&#34;$multiply&#34;</span>: [<span style="color:#e6db74">&#34;$price&#34;</span>, <span style="color:#e6db74">&#34;$quantity&#34;</span>] }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;$group&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;$region&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;totalRegionSale&#34;</span>: { <span style="color:#f92672">&#34;$sum&#34;</span>: <span style="color:#e6db74">&#34;$totalSale&#34;</span> }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;$sort&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;totalRegionSale&#34;</span>: <span style="color:#ae81ff">-1</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="52-åˆå§‹æ•°æ®-è¾“å…¥æ–‡æ¡£ç»“æ„">5.2. åˆå§‹æ•°æ® è¾“å…¥æ–‡æ¡£ç»“æ„<a href="#52-åˆå§‹æ•°æ®-è¾“å…¥æ–‡æ¡£ç»“æ„" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#960050;background-color:#1e0010">ObjectId</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;product&#34;</span>: <span style="color:#960050;background-color:#1e0010">String</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#960050;background-color:#1e0010">String</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;price&#34;</span>: <span style="color:#960050;background-color:#1e0010">Number</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#960050;background-color:#1e0010">Number</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;orderDate&#34;</span>: <span style="color:#960050;background-color:#1e0010">String</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#960050;background-color:#1e0010">String</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="53-é˜¶æ®µ-1-match">5.3. é˜¶æ®µ 1: <code>$match</code><a href="#53-é˜¶æ®µ-1-match" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>è¿‡æ»¤æ–‡æ¡£ï¼Œåªä¿ç•™ <code>category</code> ä¸º <code>&quot;Electronics&quot;</code> ä¸” <code>orderDate</code> åœ¨ 2023 å¹´ 1 æœˆè‡³ 2 æœˆä¹‹é—´çš„æ–‡æ¡£</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;$match&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;category&#34;</span>: <span style="color:#e6db74">&#34;Electronics&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;orderDate&#34;</span>: { <span style="color:#f92672">&#34;$gte&#34;</span>: <span style="color:#e6db74">&#34;2023-01-01&#34;</span>, <span style="color:#f92672">&#34;$lte&#34;</span>: <span style="color:#e6db74">&#34;2023-02-28&#34;</span> }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>è¾“å‡ºæ–‡æ¡£ç»“æ„</strong>ï¼šä¸è¾“å…¥ç›¸åŒï¼Œå› ä¸º $match åªè¿‡æ»¤æ–‡æ¡£ï¼Œä¸æ”¹å˜ç»“æ„</p>
<h3 id="54-é˜¶æ®µ-2-project">5.4. é˜¶æ®µ 2: <code>$project</code><a href="#54-é˜¶æ®µ-2-project" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p><strong>æ“ä½œ</strong>ï¼šé€‰æ‹©å¹¶è½¬æ¢å­—æ®µï¼Œåªä¿ç•™ <code>region</code> å­—æ®µï¼Œå¹¶è®¡ç®—æ¯ä¸ªè®¢å•çš„æ€»é”€å”®é¢ï¼ˆ<code>totalSale = price * quantity</code>ï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;$project&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;totalSale&#34;</span>: { <span style="color:#f92672">&#34;$multiply&#34;</span>: [<span style="color:#e6db74">&#34;$price&#34;</span>, <span style="color:#e6db74">&#34;$quantity&#34;</span>] }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>è¾“å…¥æ–‡æ¡£ç»“æ„</strong>ï¼šé˜¶æ®µ 1 çš„è¾“å‡ºï¼ˆåŒ…å« <code>_id</code>ã€ <code>product</code>ã€ <code>category</code> ç­‰ï¼‰</p>
<p><strong>è¾“å‡ºæ–‡æ¡£ç»“æ„</strong>ï¼š</p>
<ul>
<li><code>region</code>: ä¿ç•™åŸå§‹ region å­—æ®µ</li>
<li><code>totalSale</code>: æ–°å­—æ®µï¼Œè®¡ç®— <code>price * quantity</code></li>
<li><strong>æ³¨æ„</strong>ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>_id</code> å­—æ®µä¼šä¿ç•™ï¼Œé™¤éæ˜ç¡®è®¾ç½®ä¸º <code>&quot;_id&quot;: 0</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#960050;background-color:#1e0010">ObjectId</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#960050;background-color:#1e0010">String</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;totalSale&#34;</span>: <span style="color:#960050;background-color:#1e0010">Number</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>è¾“å‡ºæ•°æ®</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;North&#34;</span>, <span style="color:#f92672">&#34;totalSale&#34;</span>: <span style="color:#ae81ff">2000</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#f92672">&#34;region&#34;</span>: <span style="color:#e6db74">&#34;South&#34;</span>, <span style="color:#f92672">&#34;totalSale&#34;</span>: <span style="color:#ae81ff">2500</span> }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="55-é˜¶æ®µ-3-group">5.5. é˜¶æ®µ 3: <code>$group</code><a href="#55-é˜¶æ®µ-3-group" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<ul>
<li><strong>æ“ä½œ</strong>ï¼šæŒ‰ <code>region</code> åˆ†ç»„ï¼Œè®¡ç®—æ¯ä¸ªåœ°åŒºçš„ <code>totalSale</code> æ€»å’Œï¼ˆ<code>totalRegionSale</code>ï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;$group&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;$region&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;totalRegionSale&#34;</span>: { <span style="color:#f92672">&#34;$sum&#34;</span>: <span style="color:#e6db74">&#34;$totalSale&#34;</span> }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>è¾“å…¥æ–‡æ¡£ç»“æ„</strong>ï¼šé˜¶æ®µ 2 çš„è¾“å‡ºï¼ˆåŒ…å« <code>_id</code>ã€ <code>region</code>ã€ <code>totalSale</code>ï¼‰</p>
<p><strong>è¾“å‡ºæ–‡æ¡£ç»“æ„</strong>ï¼š</p>
<ul>
<li>
<p><code>_id</code>: åˆ†ç»„é”®ï¼Œå³ <code>region</code> çš„å€¼</p>
</li>
<li>
<p><code>totalRegionSale</code>: æ¯ä¸ªç»„çš„ <code>totalSale</code> å­—æ®µæ€»å’Œï¼ˆç”± <code>$sum</code> è®¡ç®—ï¼‰</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#960050;background-color:#1e0010">String</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;totalRegionSale&#34;</span>: <span style="color:#960050;background-color:#1e0010">Number</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>è¾“å‡ºæ•°æ®</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;North&#34;</span>, <span style="color:#f92672">&#34;totalRegionSale&#34;</span>: <span style="color:#ae81ff">2000</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;South&#34;</span>, <span style="color:#f92672">&#34;totalRegionSale&#34;</span>: <span style="color:#ae81ff">2500</span> }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>&hellip;</p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">æŸ¥çœ‹å…¶ä»–æ–‡ç« </span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.jiyi27.com/posts/git/007-%E4%B8%80%E4%BA%9B%E6%96%B0%E7%9A%84git%E6%8C%87%E4%BB%A4/" class="button inline prev">
        git ä¸€äº›é­”æ³•æŒ‡ä»¤
      </a>
    
    
      ::
    
    
      <a href="https://blog.jiyi27.com/posts/frontend/vue/003-template%E8%AF%AD%E6%B3%95/" class="button inline next">
        Vue Template è¯­æ³•
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/jiyi27/jiyi27.github.io" target="_blank">Theme</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
