<!DOCTYPE html>
<html lang="en">
<head>
  
    
    <title>ufw vs  AWS Security Group :: 为霜的博客</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="1. ufw command 1.1. Commonly used ufw commands # ubuntu @ ip-172-31-12-228 $ sudo ufw status Status: inactive # ubuntu @ ip-172-31-12-228 $ sudo ufw enable Command may disrupt existing ssh connections. Proceed with operation (y|n)? n Aborted Note: use sudo ufw enable carefully, because it may disrupt your ssh connection.
ufw enable: Enables the firewall, which starts enforcing the configured rules. ufw disable: Disables the firewall, allowing all network traffic. ufw status: Displays the current status of the firewall and the rules that are in effect. ufw default allow: Sets the default policy to allow all incoming and outgoing traffic. ufw default deny: Sets the default policy to deny all incoming and outgoing traffic. ufw allow &lt;port&gt;: Opens a specific port for incoming traffic. ufw deny &lt;port&gt;: Blocks incoming traffic on a specific port. ufw delete &lt;rule&gt;: Deletes a specific rule from the firewall. # e.g., sudo ufw delete allow 80 1.2. ufw app list # ubuntu @ ip-172-31-12-228 $ sudo ufw app list Available applications: Nginx Full Nginx HTTP Nginx HTTPS OpenSSH The output of sudo ufw app list only shows the available application profiles, not their actual status or whether they have been allowed or denied by ufw. It simply provides a list of predefined profiles so that you can use conveniently when configuring firewall rules. You don&rsquo;t need to remember which port for each application, you can simply use like this:
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.jiyi27.com/posts/build-website/006-ufw-aws-sg/" />





  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/categories.min.3202f75cbb294747099af3850a68a09ee94b3ce505fc39e134692d90ff0a9b2a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/code.min.dd73d157e77e82a3dc1cb06ba424cf6cc6811af0bb604ad6c68e70faf2439c8a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/main.min.3fb8954e26342ad3afabb4525959bfec6f9fc0d6929f0dda738ddeee30211690.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/menu.min.8cee75f73b9f9b1e40bd0dd53e6e770156b08bbfe1c579cd256c3f6cd3b6d32b.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/post.min.014a50745fbdd41d5f420a3e288730d5af4b7d90344dc6211d0e50c368b5b303.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/prism.min.b958d3d7c6c67361b945f9062d07d403422604b3d2cd33f93b88d41ed0ba634d.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/term.min.94de320c1b850e126e6d2c88a7c90acf58bb1313f0ea14a14cda2a42f2a88db2.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.jiyi27.com/terminal.css">




<link rel="shortcut icon" href="https://blog.jiyi27.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.jiyi27.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="ufw vs  AWS Security Group">
<meta property="og:description" content="1. ufw command 1.1. Commonly used ufw commands # ubuntu @ ip-172-31-12-228 $ sudo ufw status Status: inactive # ubuntu @ ip-172-31-12-228 $ sudo ufw enable Command may disrupt existing ssh connections. Proceed with operation (y|n)? n Aborted Note: use sudo ufw enable carefully, because it may disrupt your ssh connection.
ufw enable: Enables the firewall, which starts enforcing the configured rules. ufw disable: Disables the firewall, allowing all network traffic. ufw status: Displays the current status of the firewall and the rules that are in effect. ufw default allow: Sets the default policy to allow all incoming and outgoing traffic. ufw default deny: Sets the default policy to deny all incoming and outgoing traffic. ufw allow &lt;port&gt;: Opens a specific port for incoming traffic. ufw deny &lt;port&gt;: Blocks incoming traffic on a specific port. ufw delete &lt;rule&gt;: Deletes a specific rule from the firewall. # e.g., sudo ufw delete allow 80 1.2. ufw app list # ubuntu @ ip-172-31-12-228 $ sudo ufw app list Available applications: Nginx Full Nginx HTTP Nginx HTTPS OpenSSH The output of sudo ufw app list only shows the available application profiles, not their actual status or whether they have been allowed or denied by ufw. It simply provides a list of predefined profiles so that you can use conveniently when configuring firewall rules. You don&rsquo;t need to remember which port for each application, you can simply use like this:
" />
<meta property="og:url" content="https://blog.jiyi27.com/posts/build-website/006-ufw-aws-sg/" />
<meta property="og:site_name" content="为霜的博客" />

  <meta property="og:image" content="https://blog.jiyi27.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="建站" />


  <meta property="article:published_time" content="2023-10-09 13:53:57 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  
  
  

  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.jiyi27.com/posts/build-website/006-ufw-aws-sg/">ufw vs  AWS Security Group</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-10-09</time><span class="post-reading-time">3 分钟阅读 (635 字数)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.jiyi27.com/tags/%E5%BB%BA%E7%AB%99/">建站</a>&nbsp;
      
      #<a href="https://blog.jiyi27.com/tags/ufw/">ufw</a>&nbsp;
      
      #<a href="https://blog.jiyi27.com/tags/aws/">aws</a>&nbsp;
      
      #<a href="https://blog.jiyi27.com/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/">后端开发</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h2 id="1-ufw-command">1. <code>ufw</code> command<a href="#1-ufw-command" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="11-commonly-used-ufw-commands">1.1. Commonly used ufw commands<a href="#11-commonly-used-ufw-commands" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ubuntu @ ip-172-31-12-228</span>
</span></span><span style="display:flex;"><span>$ sudo ufw status
</span></span><span style="display:flex;"><span>Status: inactive
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ubuntu @ ip-172-31-12-228</span>
</span></span><span style="display:flex;"><span>$ sudo ufw enable
</span></span><span style="display:flex;"><span>Command may disrupt existing ssh connections. Proceed with operation <span style="color:#f92672">(</span>y|n<span style="color:#f92672">)</span>? n
</span></span><span style="display:flex;"><span>Aborted
</span></span></code></pre></div><blockquote>
<p><strong>Note:</strong> use <code>sudo ufw enable</code> carefully, because it may disrupt your ssh connection.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ufw enable: Enables the firewall, which starts enforcing the configured rules.
</span></span><span style="display:flex;"><span>ufw disable: Disables the firewall, allowing all network traffic.
</span></span><span style="display:flex;"><span>ufw status: Displays the current status of the firewall and the rules that are in effect.
</span></span><span style="display:flex;"><span>ufw default allow: Sets the default policy to allow all incoming and outgoing traffic.
</span></span><span style="display:flex;"><span>ufw default deny: Sets the default policy to deny all incoming and outgoing traffic.
</span></span><span style="display:flex;"><span>ufw allow &lt;port&gt;: Opens a specific port <span style="color:#66d9ef">for</span> incoming traffic.
</span></span><span style="display:flex;"><span>ufw deny &lt;port&gt;: Blocks incoming traffic on a specific port.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ufw delete &lt;rule&gt;: Deletes a specific rule from the firewall. 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># e.g., sudo ufw delete allow 80</span>
</span></span></code></pre></div><h3 id="12-ufw-app-list">1.2. <code>ufw app list</code><a href="#12-ufw-app-list" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># ubuntu @ ip-172-31-12-228</span>
</span></span><span style="display:flex;"><span>$ sudo ufw app list
</span></span><span style="display:flex;"><span>Available applications:
</span></span><span style="display:flex;"><span>  Nginx Full
</span></span><span style="display:flex;"><span>  Nginx HTTP
</span></span><span style="display:flex;"><span>  Nginx HTTPS
</span></span><span style="display:flex;"><span>  OpenSSH
</span></span></code></pre></div><p>The output of <code>sudo ufw app list</code> only shows the available <strong>application profiles</strong>, not their actual status or whether they have been allowed or denied by <code>ufw</code>. It simply provides a list of predefined profiles <strong>so that you can use conveniently</strong> when configuring firewall rules. You don&rsquo;t need to remember which port for each application, you can simply use like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># sudo ufw allow &#39;Profile Name&#39;</span>
</span></span><span style="display:flex;"><span>$ sudo ufw allow <span style="color:#e6db74">&#39;OpenSSH&#39;</span>
</span></span><span style="display:flex;"><span>Rules updated
</span></span><span style="display:flex;"><span>Rules updated <span style="color:#f92672">(</span>v6<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>$ sudo ufw allow <span style="color:#e6db74">&#39;OpenS&#39;</span>  
</span></span><span style="display:flex;"><span>ERROR: Could not find a profile matching <span style="color:#e6db74">&#39;OpenS&#39;</span>
</span></span></code></pre></div><p>rather than</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>sudo ufw allow <span style="color:#ae81ff">22</span>
</span></span></code></pre></div><p>So the command below will allow both port <code>80</code> and <code>443</code>:</p>
<pre tabindex="0"><code>sudo ufw allow &#39;Nginx Full&#39;
</code></pre><p>To check the status of your firewall rules and verify whether Nginx HTTP, Nginx HTTPS, or OpenSSH have been allowed or denied by <code>ufw</code>, you can use the <code>sudo ufw status</code> command. This command will display the current status of the firewall and the active rules.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo ufw allow <span style="color:#e6db74">&#39;OpenSSH&#39;</span>
</span></span><span style="display:flex;"><span>Rules updated
</span></span><span style="display:flex;"><span>Rules updated <span style="color:#f92672">(</span>v6<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo ufw enable
</span></span><span style="display:flex;"><span>Command may disrupt existing ssh connections. Proceed with operation <span style="color:#f92672">(</span>y|n<span style="color:#f92672">)</span>? y
</span></span><span style="display:flex;"><span>Firewall is active and enabled on system startup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo ufw status       
</span></span><span style="display:flex;"><span>Status: active
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To                         Action      From
</span></span><span style="display:flex;"><span>--                         ------      ----
</span></span><span style="display:flex;"><span>5060/udp                   ALLOW       Anywhere                  
</span></span><span style="display:flex;"><span>OpenSSH                    ALLOW       Anywhere                  
</span></span><span style="display:flex;"><span>5060/udp <span style="color:#f92672">(</span>v6<span style="color:#f92672">)</span>              ALLOW       Anywhere <span style="color:#f92672">(</span>v6<span style="color:#f92672">)</span>             
</span></span><span style="display:flex;"><span>OpenSSH <span style="color:#f92672">(</span>v6<span style="color:#f92672">)</span>               ALLOW       Anywhere <span style="color:#f92672">(</span>v6<span style="color:#f92672">)</span>  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo ufw disable
</span></span><span style="display:flex;"><span>Firewall stopped and disabled on system startup
</span></span></code></pre></div><h2 id="2-ubuntu-firewall-ufw-vs-aws-security-groups">2. Ubuntu Firewall (ufw) vs AWS Security Groups<a href="#2-ubuntu-firewall-ufw-vs-aws-security-groups" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>A firewall like UFW is running at the OS level, while Amazon Security Groups are running at the instance level. Traffic coming into the EC2 would first pass through the SG, and then be evaluated by UFW.</p>
<p>I strongly recommend you to use only &ldquo;SG(Security Group)&rdquo; on EC2 even though we can use both &ldquo;SG&rdquo; and &ldquo;UFW. &ldquo;SG&rdquo; is a firewall same as &ldquo;UFW&rdquo;.</p>
<p>When only &ldquo;SG&rdquo; allowed &ldquo;SSH 22&rdquo; and &ldquo;UFW&rdquo; didn&rsquo;t allow &ldquo;SSH 22&rdquo; then I logged out ubuntu, I couldn&rsquo;t log in to ubuntu forever, then I terminated ubuntu.</p>
<p>Even though &ldquo;SG&rdquo; allowed &ldquo;SSH 22&rdquo;, I couldn&rsquo;t log in to ubuntu because &ldquo;UFW&rdquo; didn&rsquo;t allow &ldquo;SSH 22&rdquo;. So if either of them doesn&rsquo;t allow &ldquo;SSH 22&rdquo;, &ldquo;SSH 22&rdquo; doesn&rsquo;t work. If both &ldquo;SG&rdquo; and &ldquo;UFW&rdquo; allow &ldquo;SSH 22&rdquo;, &ldquo;SSH 22&rdquo; works, then we can log in to ubuntu.</p>
<p>I also experimented with &ldquo;HTTP 80&rdquo;. When only &ldquo;SG&rdquo; allowed &ldquo;HTTP 80&rdquo; and &ldquo;UFW&rdquo; didn&rsquo;t allow &ldquo;HTTP 80&rdquo;, &ldquo;HTTP 80&rdquo; didn&rsquo;t work. When &ldquo;SG&rdquo; and &ldquo;UFW&rdquo; allowed &ldquo;HTTP 80&rdquo;, &ldquo;HTTP 80&rdquo; worked.</p>
<p>Just remember like &ldquo;If both allow, it works&rdquo; and &ldquo;If only either of them allow, it doesn&rsquo;t work&rdquo;. Actually, using both of them makes complication and some trobles. So again, I really recommend you to <strong>use only &ldquo;SG&rdquo; on EC2</strong> which is simpler than using both of them.</p>
<p>Source: <a href="https://stackoverflow.com/questions/57436758/does-ubuntu-ufw-overrides-amazon-ec2s-security-groups-and-rules">https://stackoverflow.com/questions/57436758/does-ubuntu-ufw-overrides-amazon-ec2s-security-groups-and-rules</a></p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">查看其他文章</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.jiyi27.com/posts/docker/001-docker-basics/" class="button inline prev">
        Docker Basics
      </a>
    
    
      ::
    
    
      <a href="https://blog.jiyi27.com/posts/python/practice/002-openssl-issue/" class="button inline next">
        urllib3 not compatible with openssl issue - python
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/jiyi27/jiyi27.github.io" target="_blank">Theme</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
