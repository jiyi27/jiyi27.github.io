<!DOCTYPE html>
<html lang="en">
<head>
  
    
    <title>未初始化的变量和未定义行为 :: 为霜的博客</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="1. Uninitialized variables Uninitialized variables就是你定义它了但是却没有给它赋过值(即通过assignment操作或者initialization操作), 如下a就是个uninitialized variable:
int a; 为什么要说这个呢, C&#43;&#43;编译器在这有点狗, 如果你定义局部变量的时候没有给它值, 如上面的变量a, 那编译器也并不会给a一个特定的初始值, 然后你运行程序编译器也不会报错:
int b; int main() { int a; cout &lt;&lt; a &lt;&lt; endl; // 打印72433004 cout &lt;&lt; b &lt;&lt; endl; // 打印0 return 0; } Java的话是直接不允许你使用未定义的局部变量, 会报错, 如下:
public static void main(String []args) { int a; System.out.println(a); } // error: java: variable a might not have been initialized golang就会省事一些, 不论局部全局, 你若定义的时候没有给值, 编译器会自动给个初始值, Golang明确说明:
Variables declared without an explicit initial value are given their zero value.
" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.jiyi27.com/posts/cpp/007-uninitialized-variables-and-undefined-behaviors/" />





  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/buttons.min.2bc533403a27dfe0e93105a92502b42ce4587e2e4a87d9f7d349e51e16e09478.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/categories.min.3202f75cbb294747099af3850a68a09ee94b3ce505fc39e134692d90ff0a9b2a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/code.min.dd73d157e77e82a3dc1cb06ba424cf6cc6811af0bb604ad6c68e70faf2439c8a.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/fonts.min.4881f0c525f3ce2a1864fb6e96676396cebe1e6fcef1933e8e1dde7041004fb5.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/footer.min.2e3eb191baee58dd05a9f0104ac1fab0827bca7c64dafe0b2579f934c33a1d69.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/header.min.b6fb4423cf82a9f9d7abc9cd010223fa3d70a6526a3f28f8e17d814c06e18f9e.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/main.min.3fb8954e26342ad3afabb4525959bfec6f9fc0d6929f0dda738ddeee30211690.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/menu.min.8cee75f73b9f9b1e40bd0dd53e6e770156b08bbfe1c579cd256c3f6cd3b6d32b.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/pagination.min.82f6400eae7c7c6dc3c866733c2ec0579e4089608fea69400ff85b3880aa0d3c.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/post.min.014a50745fbdd41d5f420a3e288730d5af4b7d90344dc6211d0e50c368b5b303.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/prism.min.b958d3d7c6c67361b945f9062d07d403422604b3d2cd33f93b88d41ed0ba634d.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/term.min.94de320c1b850e126e6d2c88a7c90acf58bb1313f0ea14a14cda2a42f2a88db2.css">

  
  <link rel="stylesheet" href="https://blog.jiyi27.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.jiyi27.com/terminal.css">




<link rel="shortcut icon" href="https://blog.jiyi27.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.jiyi27.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="未初始化的变量和未定义行为">
<meta property="og:description" content="1. Uninitialized variables Uninitialized variables就是你定义它了但是却没有给它赋过值(即通过assignment操作或者initialization操作), 如下a就是个uninitialized variable:
int a; 为什么要说这个呢, C&#43;&#43;编译器在这有点狗, 如果你定义局部变量的时候没有给它值, 如上面的变量a, 那编译器也并不会给a一个特定的初始值, 然后你运行程序编译器也不会报错:
int b; int main() { int a; cout &lt;&lt; a &lt;&lt; endl; // 打印72433004 cout &lt;&lt; b &lt;&lt; endl; // 打印0 return 0; } Java的话是直接不允许你使用未定义的局部变量, 会报错, 如下:
public static void main(String []args) { int a; System.out.println(a); } // error: java: variable a might not have been initialized golang就会省事一些, 不论局部全局, 你若定义的时候没有给值, 编译器会自动给个初始值, Golang明确说明:
Variables declared without an explicit initial value are given their zero value.
" />
<meta property="og:url" content="https://blog.jiyi27.com/posts/cpp/007-uninitialized-variables-and-undefined-behaviors/" />
<meta property="og:site_name" content="为霜的博客" />

  <meta property="og:image" content="https://blog.jiyi27.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="c&#43;&#43;" />


  <meta property="article:published_time" content="2023-05-15 09:57:02 &#43;0000 UTC" />












</head>
<body>


<div class="container center">

  
  
  

  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.jiyi27.com/posts/cpp/007-uninitialized-variables-and-undefined-behaviors/">未初始化的变量和未定义行为</a>
  </h1>
  <div class="post-meta"><time class="post-date">2023-05-15</time><span class="post-reading-time">3 分钟阅读 (484 字数)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.jiyi27.com/tags/c&#43;&#43;/">c&#43;&#43;</a>&nbsp;
      
    </span>
  
  


  

  <div class="post-content"><div>
        <h2 id="1-uninitialized-variables">1. Uninitialized variables<a href="#1-uninitialized-variables" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Uninitialized variables就是你定义它了但是却没有给它赋过值(即通过assignment操作或者initialization操作), 如下<code>a</code>就是个uninitialized variable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> a; 
</span></span></code></pre></div><p>为什么要说这个呢, C++编译器在这有点狗, 如果你定义局部变量的时候没有给它值, 如上面的变量<code>a</code>, 那编译器也并不会给<code>a</code>一个特定的初始值, 然后你运行程序编译器也不会报错:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> b;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> a;
</span></span><span style="display:flex;"><span>    cout <span style="color:#f92672">&lt;&lt;</span> a <span style="color:#f92672">&lt;&lt;</span> endl; <span style="color:#75715e">// 打印72433004
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    cout <span style="color:#f92672">&lt;&lt;</span> b <span style="color:#f92672">&lt;&lt;</span> endl; <span style="color:#75715e">// 打印0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Java的话是直接不允许你使用未定义的局部变量, 会报错, 如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String <span style="color:#f92672">[]</span>args) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">int</span> a;
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(a);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// error: java: variable a might not have been initialized</span>
</span></span></code></pre></div><p>golang就会省事一些, 不论局部全局, 你若定义的时候没有给值, 编译器会自动给个初始值, Golang明确说明:</p>
<blockquote>
<p>Variables declared without an explicit initial value are given their <em><strong>zero value</strong></em>.</p>
</blockquote>
<p>对比完不同的语言, 那我们继续上面的说C++, 为什么这么问题很严重, 这也是所谓的野指针(wild pointer)问题,</p>
<p>假如这时候你定义的是个指针, 然后没有初始化, 这个时候该指针的值是”随机“的(其实页并不是随机, 即编译器为该指针变量分的那块内存里原本有什么, 那指针的值就是什么), 如果你此时尝试访问这个指针就可能会造成未定义行为(undefined behavior), 因为你不知道该指针的“随机”指向哪块内存, 你修改了该块内存的内容就有可能让你的的程序崩溃crush, 如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> p;
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span>p <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 有时候程序会崩溃, 有时候程序会正常运行, 取决于p指向的哪块内存地址
</span></span></span></code></pre></div><blockquote>
<p>Unlike some programming languages, C/C++ does not initialize most variables to a given value (such as zero) automatically. Thus when a variable is given a memory address to use to store data, the default value of that variable is whatever (garbage) value happens to already be in that memory address! A variable that has not been given a known value (usually through initialization or assignment) is called an <strong>uninitialized</strong>.</p>
</blockquote>
<p>最后对于上面未初始化的变量<code>a</code>打印了一个“随机”的值, 可能会有疑问, 看到<a href="https://www.learncpp.com/cpp-tutorial/uninitialized-variables-and-undefined-behavior/">一篇文章</a>解释的不错, 分享一下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c++" data-lang="c++"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// define an integer variable named x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> x; <span style="color:#75715e">// this variable is uninitialized because we haven&#39;t given it a value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// print the value of x to the screen
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> x <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#39;\n&#39;</span>; <span style="color:#75715e">// who knows what we&#39;ll get, because x is uninitialized
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>In this case, the computer will assign some unused memory to <em>x</em>. It will then send the value residing in that memory location to <em>std::cout</em>, which will print the value (interpreted as an integer). But what value will it print? The answer is “who knows!”, and the answer may (or may not) change every time you run the program. When the author ran this program in Visual Studio, <em>std::cout</em> printed the value <code>7177728</code> one time, and <code>5277592</code> the next. Feel free to compile and run the program yourself (your computer won’t explode).</p>
<h2 id="2-undefined-behavior">2. Undefined behavior<a href="#2-undefined-behavior" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Using the value from an uninitialized variable is our first example of undefined behavior. <strong>Undefined behavior</strong> is the result of executing code whose behavior is not well-defined by the C++ language. In this case, the C++ language doesn’t have any rules determining what happens if you use the value of a variable that has not been given a known value. Consequently, if you actually do this, undefined behavior will result.</p>
<p>Code implementing undefined behavior may exhibit <em>any</em> of the following symptoms:</p>
<ul>
<li>Your program produces different results every time it is run.</li>
<li>Your program consistently produces the same incorrect result.</li>
<li>Your program behaves inconsistently (sometimes produces the correct result, sometimes not).</li>
<li>Your program seems like it’s working but produces incorrect results later in the program.</li>
<li>Your program crashes, either immediately or later.</li>
<li>Your program works on some compilers but not others.</li>
<li>Your program works until you change some other seemingly unrelated code.</li>
</ul>
<p>References:</p>
<ul>
<li><a href="https://www.learncpp.com/cpp-tutorial/uninitialized-variables-and-undefined-behavior/">1.6 — Uninitialized variables and undefined behavior – Learn C++</a></li>
</ul>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">查看其他文章</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.jiyi27.com/posts/cpp/004-constructors/" class="button inline prev">
        C&#43;&#43; Constructors
      </a>
    
    
      ::
    
    
      <a href="https://blog.jiyi27.com/posts/cpp/006-initialization/" class="button inline next">
        C&#43;&#43; Variable Assignment and Initialization
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/jiyi27/jiyi27.github.io" target="_blank">Theme</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
