<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>手动编译运行Java程序之JVM加载类的顺序 - David&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="David" /><meta name="description" content="java &amp;amp; javac 两个指令 Technically, javac is the program that translates Java code into bytecode (.class file) - an intermediate format which is understandable by the Java Virtual Machine (JVM). And java is the program that starts the JVM, which in turn, loads the .class file, verifies the bytecode and executes it. -classpath classpath, or -cp classpath, specifies a list of directories, JAR files, and ZIP archives" />






<meta name="generator" content="Hugo 0.123.7 with theme even" />


<link rel="canonical" href="https://davidzhu.xyz/post/java/basics/how-jvm-find-class/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="手动编译运行Java程序之JVM加载类的顺序" />
<meta property="og:description" content="java &amp; javac 两个指令 Technically, javac is the program that translates Java code into bytecode (.class file) - an intermediate format which is understandable by the Java Virtual Machine (JVM). And java is the program that starts the JVM, which in turn, loads the .class file, verifies the bytecode and executes it. -classpath classpath, or -cp classpath, specifies a list of directories, JAR files, and ZIP archives" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://davidzhu.xyz/post/java/basics/how-jvm-find-class/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-07-26T17:52:40+00:00" />
<meta property="article:modified_time" content="2023-07-26T17:52:40+00:00" />

<meta itemprop="name" content="手动编译运行Java程序之JVM加载类的顺序">
<meta itemprop="description" content="java &amp; javac 两个指令 Technically, javac is the program that translates Java code into bytecode (.class file) - an intermediate format which is understandable by the Java Virtual Machine (JVM). And java is the program that starts the JVM, which in turn, loads the .class file, verifies the bytecode and executes it. -classpath classpath, or -cp classpath, specifies a list of directories, JAR files, and ZIP archives"><meta itemprop="datePublished" content="2023-07-26T17:52:40+00:00" />
<meta itemprop="dateModified" content="2023-07-26T17:52:40+00:00" />
<meta itemprop="wordCount" content="1154">
<meta itemprop="keywords" content="Java," /><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="手动编译运行Java程序之JVM加载类的顺序"/>
<meta name="twitter:description" content="java &amp; javac 两个指令 Technically, javac is the program that translates Java code into bytecode (.class file) - an intermediate format which is understandable by the Java Virtual Machine (JVM). And java is the program that starts the JVM, which in turn, loads the .class file, verifies the bytecode and executes it. -classpath classpath, or -cp classpath, specifies a list of directories, JAR files, and ZIP archives"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">David&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">David&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">手动编译运行Java程序之JVM加载类的顺序</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-07-26 </span>
        <div class="post-category">
            <a href="/categories/java/"> Java </a>
            <a href="/categories/basics/"> Basics </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#java--javac">java &amp; javac</a>
          <ul>
            <li><a href="#手动编译并运行java程序">手动编译并运行java程序</a></li>
          </ul>
        </li>
        <li><a href="#how-jvm-finds-classes">How JVM Finds Classes</a>
          <ul>
            <li><a href="#how-jvm-finds-bootstrap-classes">How JVM Finds Bootstrap Classes</a></li>
            <li><a href="#how-jvm-finds-extension-classes">How JVM Finds Extension Classes</a></li>
            <li><a href="#how-jvm-finds-user-classes">How JVM Finds User Classes</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="java--javac">java &amp; javac</h2>
<p>两个指令</p>
<ul>
<li>
<p>Technically, <code>javac</code> is the program that translates Java code into bytecode (.class file) - an intermediate format which is understandable by the Java Virtual Machine (JVM).</p>
</li>
<li>
<p>And <code>java</code> is the program that starts the <strong>JVM</strong>, which in turn, loads the <code>.class</code> file, verifies the bytecode and executes it.</p>
<ul>
<li>
<p><code>-classpath</code> <em>classpath</em>, or <code>-cp</code> <em>classpath</em>, specifies a list of directories, JAR files, and ZIP archives to search for <strong>class files</strong>.</p>
</li>
<li>
<p>On Windows, semicolons (<code>;</code>) separate entities in this list; on other platforms it is a colon (<code>:</code>).</p>
</li>
<li>
<p>Specifying <em>classpath</em> overrides any setting of the <code>CLASSPATH</code> environment variable. If the class path option isn&rsquo;t used and <em>classpath</em> isn&rsquo;t set, then the user class path consists of the current directory (<code>.</code>).</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意上面说的, java 启动 JVM, 然后 JVM 导入字节码文件, 别理解错了, 至于 -cp 就是用来告诉 JVM 去哪搜索用程序中到的类的字节码文件<code>.calss</code>,</p>
</blockquote>
<h3 id="手动编译并运行java程序">手动编译并运行java程序</h3>
<p>目录结构:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">├── myproject
</span></span><span class="line"><span class="cl">│   └── src
</span></span><span class="line"><span class="cl">│       ├── Main.java
</span></span><span class="line"><span class="cl">│       └── animal
</span></span><span class="line"><span class="cl">│           └── Cat.java
</span></span></code></pre></td></tr></table>
</div>
</div><p>代码内容:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Cat.java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">package</span><span class="w"> </span><span class="nn">animal</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Cat</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Cat</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;mew~&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Main.java</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="nn">animal.Cat</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Main</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="o">[]</span><span class="n">args</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Cat</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cat</span><span class="p">(</span><span class="s">&#34;kitty&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>src</code>下编译:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">javac Main.java
</span></span></code></pre></td></tr></table>
</div>
</div><p>编译后多出了两个字节码文件,  如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">├── myproject
</span></span><span class="line"><span class="cl">│   └── src
</span></span><span class="line"><span class="cl">│       ├── Main.class
</span></span><span class="line"><span class="cl">│       ├── Main.java
</span></span><span class="line"><span class="cl">│       └── animal
</span></span><span class="line"><span class="cl">│           ├── Cat.class
</span></span><span class="line"><span class="cl">│           └── Cat.java
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以发现, 我们只是编译了<code>Main.java</code>, 被其用到的类 <code>Cat.java</code> 也被编译了, 然后在其它文件夹下执行该程序, 用 <code>-cp</code> 来指明 classpath, 即告诉 JVM 去哪找 user-defined class 字节码文件,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ java -cp myproject/src Main 
</span></span><span class="line"><span class="cl">mew~
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="how-jvm-finds-classes">How JVM Finds Classes</h2>
<p>这个标题本来是&quot;How the Java Launcher Finds Classes&quot;,很具有迷惑性, 因为加载类的是 JVM, 下面也指出了是 JVM 加载类, 所以直接改了标题, 原文来自<a href="https://docs.oracle.com/javase/1.5.0/docs/tooldocs/findingclasses.html">oracle</a>,</p>
<p>The Java launcher, java, initiates the Java virtual machine. <strong>The virtual machine searches for and loads classes in this order:</strong></p>
<ul>
<li>
<p>Bootstrap classes - Classes that comprise the Java platform, including the classes in <code>rt.jar</code> and several other important jar files.</p>
</li>
<li>
<p>Extension classes - Classes that use the Java Extension mechanism. These are bundled as <code>.jar</code> files located in the extensions directory.</p>
</li>
<li>
<p>User classes - Classes defined by developers and third parties that do not take advantage of the extension mechanism. You identify the location of these classes using the <code>-classpath</code> option on the command line (the preferred method) or by using the CLASSPATH environment variable.</p>
</li>
</ul>
<p>In general, you only have to specify the location of user classes. Bootstrap classes and extension classes are found &ldquo;automatically&rdquo;.</p>
<blockquote>
<p>注意这里说的其实就是类加载的过程, 即 JVM 怎么查找并加载类对应的每个字节码文件, 而不是 java launcher, 它只是负责启动 JVM 的,  <code>-cp</code> 的作用在这再次被指出, 可以参考上面的例子</p>
</blockquote>
<h3 id="how-jvm-finds-bootstrap-classes">How JVM Finds Bootstrap Classes</h3>
<p>Bootstrap classes are the classes that implement the Java 2 Platform. Bootstrap classes are in the <code>rt.jar</code> and several other jar files in the <code>jre/lib</code> directory. These archives are specified by the value of the bootstrap class path which is stored in the <code>sun.boot.class.path</code> system property. This system property is for reference only, and should not be directly modified.</p>
<h3 id="how-jvm-finds-extension-classes">How JVM Finds Extension Classes</h3>
<p>Extension classes are classes which extend the Java platform. Every <code>.jar</code> file in the extension directory, <code>jre/lib/ext</code>, is assumed to be an extension and is loaded using the <a href="https://docs.oracle.com/javase/1.5.0/docs/guide/extensions/index.html">Java Extension Framework</a>. Loose class files in the extension directory will not be found. They must be contained in a <code>.jar</code> file (or <code>.zip</code> file). There is no option provided for changing the location of the extension directory.</p>
<p>If the <code>jre/lib/ext</code> directory contains multiple <code>.jar</code> files, and those files contain classes with the same name, such as:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">smart-extension1_0.jar contains class smart.extension.Smartsmart-extension1_1.jar contains class smart.extension.Smart
</span></span></code></pre></td></tr></table>
</div>
</div><p>the class that actually gets loaded is undefined.</p>
<h3 id="how-jvm-finds-user-classes">How JVM Finds User Classes</h3>
<p>User classes are classes which build on the Java platform. To find user classes, the launcher refers to the <em>user class path</em> &ndash; a list of directories, JAR archives, and ZIP archives which contain class files.</p>
<p>A class file has a subpath name that reflects the class&rsquo;s fully-qualified name. For example, if the class <code>com.mypackage.MyClass</code> is stored under <code>/myclasses</code>, then <code>/myclasses</code> must be in the user class path and the full path to the class file must be /<code>myclasses/com/mypackage/MyClass.class</code>. If the class is stored in an archive named <code>myclasses.jar</code>, then <code>myclasses.jar</code> must be in the user class path, and the class file must be stored in the archive as <code>com/mypackage/MyClass.class</code>.</p>
<p>The user class path is specified as a string, with a colon (<strong><code>:</code></strong>) separating the class path entries on Solaris, and a semi-colon (<strong><code>;</code></strong>) separating entries on Microsoft Windows systems. The <strong>java</strong> launcher puts the user class path string in the <code>java.class.path</code> system property. The possible sources of this value are:</p>
<ul>
<li>The default value, &ldquo;.&rdquo;, meaning that user class files are all the class files in the current directory (or under it, if in a package).</li>
<li>The value of the <code>CLASSPATH</code> environment variable, which overrides the default value.</li>
<li>The value of the <code>-cp</code> or <code>-classpath</code> command line option, which overrides both the default value and the CLASSPATH value.</li>
<li>The JAR archive specified by the <code>-jar</code> option, which overrides all other values. If this option is used, all user classes must come from the specified archive.</li>
</ul>
<p>原文:</p>
<ul>
<li><a href="https://docs.oracle.com/javase/1.5.0/docs/tooldocs/findingclasses.html">How Classes are Found</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">David</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-07-26
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/java/">Java</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/java/basics/jdk-jre/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">JDK &amp; JRE</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/other/006-english-reading-1/">
            <span class="next-text nav-default">英语阅读(一)</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:shwezhu@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/shwezhu" class="iconfont icon-github" title="github"></a>
  <a href="https://davidzhu.xyz/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>David</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
