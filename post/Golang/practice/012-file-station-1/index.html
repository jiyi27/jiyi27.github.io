<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>A File Station (1) - Go - David&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="David" /><meta name="description" content="1. Upload file to web server with HTTP request The html code:
1 2 &amp;lt;input id=&amp;#34;upload-file&amp;#34; type=&amp;#34;file&amp;#34; /&amp;gt; &amp;lt;input id=&amp;#34;upload-file-btn&amp;#34; type=&amp;#34;submit&amp;#34; value=&amp;#34;upload&amp;#34; /&amp;gt; I fInd the docs about fetch and write code like this to upload file to the server with http request:
1 2 3 4 5 6 7 8 9 10 11 12 13 document.getElementById(&amp;#34;upload-file-btn&amp;#34;).addEventListener(&amp;#34;click&amp;#34;, uploadFile) async function uploadFile() { const url = &amp;#34;http://127.0.0.1:8080/upload&amp;#34; const fileInput = document.getElementById(&amp;#34;upload-file&amp;#34;) const formData = new FormData() formData." />






<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="https://shaowenzhu.top/post/golang/practice/012-file-station-1/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="A File Station (1) - Go" />
<meta property="og:description" content="1. Upload file to web server with HTTP request The html code:
1 2 &lt;input id=&#34;upload-file&#34; type=&#34;file&#34; /&gt; &lt;input id=&#34;upload-file-btn&#34; type=&#34;submit&#34; value=&#34;upload&#34; /&gt; I fInd the docs about fetch and write code like this to upload file to the server with http request:
1 2 3 4 5 6 7 8 9 10 11 12 13 document.getElementById(&#34;upload-file-btn&#34;).addEventListener(&#34;click&#34;, uploadFile) async function uploadFile() { const url = &#34;http://127.0.0.1:8080/upload&#34; const fileInput = document.getElementById(&#34;upload-file&#34;) const formData = new FormData() formData." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shaowenzhu.top/post/golang/practice/012-file-station-1/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-10-06T20:28:50+00:00" />
<meta property="article:modified_time" content="2023-10-06T20:28:50+00:00" />
<meta itemprop="name" content="A File Station (1) - Go">
<meta itemprop="description" content="1. Upload file to web server with HTTP request The html code:
1 2 &lt;input id=&#34;upload-file&#34; type=&#34;file&#34; /&gt; &lt;input id=&#34;upload-file-btn&#34; type=&#34;submit&#34; value=&#34;upload&#34; /&gt; I fInd the docs about fetch and write code like this to upload file to the server with http request:
1 2 3 4 5 6 7 8 9 10 11 12 13 document.getElementById(&#34;upload-file-btn&#34;).addEventListener(&#34;click&#34;, uploadFile) async function uploadFile() { const url = &#34;http://127.0.0.1:8080/upload&#34; const fileInput = document.getElementById(&#34;upload-file&#34;) const formData = new FormData() formData."><meta itemprop="datePublished" content="2023-10-06T20:28:50+00:00" />
<meta itemprop="dateModified" content="2023-10-06T20:28:50+00:00" />
<meta itemprop="wordCount" content="1598">
<meta itemprop="keywords" content="golang,http," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="A File Station (1) - Go"/>
<meta name="twitter:description" content="1. Upload file to web server with HTTP request The html code:
1 2 &lt;input id=&#34;upload-file&#34; type=&#34;file&#34; /&gt; &lt;input id=&#34;upload-file-btn&#34; type=&#34;submit&#34; value=&#34;upload&#34; /&gt; I fInd the docs about fetch and write code like this to upload file to the server with http request:
1 2 3 4 5 6 7 8 9 10 11 12 13 document.getElementById(&#34;upload-file-btn&#34;).addEventListener(&#34;click&#34;, uploadFile) async function uploadFile() { const url = &#34;http://127.0.0.1:8080/upload&#34; const fileInput = document.getElementById(&#34;upload-file&#34;) const formData = new FormData() formData."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">David&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">David&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">A File Station (1) - Go</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-10-06 </span>
        <div class="post-category">
            <a href="/categories/golang/"> golang </a>
            <a href="/categories/practice/"> practice </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-upload-file-to-web-server-with-http-request">1. Upload file to web server with HTTP request</a></li>
        <li><a href="#2-why-cross-origin-requests-could-be-insecure">2. Why cross-origin requests could be insecure</a></li>
        <li><a href="#3-same-origin-policy">3. Same-origin policy</a></li>
        <li><a href="#4-cors">4. CORS</a>
          <ul>
            <li><a href="#41-origins">4.1. Origins</a></li>
            <li><a href="#42-example">4.2. Example</a></li>
          </ul>
        </li>
        <li><a href="#5-cors-vs-sop">5. CORS vs SOP</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-upload-file-to-web-server-with-http-request">1. Upload file to web server with HTTP request</h2>
<p>The html code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;upload-file&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;file&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;upload-file-btn&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;upload&#34;</span> <span class="p">/&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I fInd the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">docs about fetch</a> and write code like this to upload file to the server with http request:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;upload-file-btn&#34;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="nx">uploadFile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">async</span> <span class="kd">function</span> <span class="nx">uploadFile</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;http://127.0.0.1:8080/upload&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">fileInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;upload-file&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&#34;uploaded_file&#34;</span><span class="p">,</span> <span class="nx">fileInput</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span><span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;multipart/form-data&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nx">body</span><span class="o">:</span> <span class="nx">formData</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span> 
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then I got an error at my web server:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">no multipart boundary param in Content-Type
</span></span></code></pre></td></tr></table>
</div>
</div><p>I found an explanation on <a href="https://stackoverflow.com/a/42985029/16317008">stack overflow</a>, says that form boundary is the delimiter for the form data, and added boundary to the header:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span><span class="s2">&#34;Content-Type&#34;</span><span class="o">:</span> <span class="s2">&#34;multipart/form-data; boundary=----WebKitFormBoundaryyEmKNDsBKjB7QEqu&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">body</span><span class="o">:</span> <span class="nx">formData</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then got another error at server side:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">multipart: NextPart: bufio: buffer full
</span></span></code></pre></td></tr></table>
</div>
</div><p>And continue doing research on stackoverflow, find <a href="https://stackoverflow.com/a/39281156/16317008">a solution</a>: the solution to the problem is to explicitly set <code>Content-Type</code> to <code>undefined</code> so that your browser or whatever client you&rsquo;re using can set it and add that boundary value in there for you.</p>
<p>I removed the headers settings:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">body</span><span class="o">:</span> <span class="nx">formData</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then I got another error at the client side javascript console, so frustrated :(</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Access to fetch at &#39;http://127.0.0.1:8080/upload&#39; from origin &#39;http://localhost:8080&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.
</span></span></code></pre></td></tr></table>
</div>
</div><p>Three ways to solve this problem:</p>
<ul>
<li>
<p>This is because the <strong>target origin</strong> is different from the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><strong>origin</strong></a>, then I make the <code>fetch</code> function send request to <code>http://localhost:8080/upload</code> rather than <code>http://127.0.0.1:8080/upload</code>. Then the http request was sent successfully.</p>
</li>
<li>
<p>Another way is to enable <code>no-cors</code> mode in <code>fetch</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">method</span><span class="o">:</span> <span class="s2">&#34;POST&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">body</span><span class="o">:</span> <span class="nx">formData</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;no-cors&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>This will work fine but you should note that when the request is made with &ldquo;no-cors&rdquo; mode, the response&rsquo;s status code property is always 0. This is because <code>no-cors</code> mode restricts the information available in the response, including the status code.</li>
<li><code>mode: 'no-cors'</code> won’t magically make things work. In fact it makes things worse, because one effect it has is to tell browsers, <em>“Block my frontend JavaScript code from seeing contents of the response body and headers under all circumstances.”</em> Of course you never want that.</li>
<li>What happens with cross-origin requests from frontend JavaScript is that browsers by default block frontend code from accessing resources <strong>cross-origin</strong>. (If you know what <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin">origin</a> is, you will understand the term &ldquo;cross-origin&rdquo; easily). If <code>Access-Control-Allow-Origin</code> header is specified in a response, then browser relax that blocking and allow your code to access the response. Source: <a href="https://stackoverflow.com/a/43268098/16317008">https://stackoverflow.com/a/43268098/16317008</a></li>
</ul>
</li>
<li>
<p>The last way is to enable cors on the server side by setting the response header:</p>
<ul>
<li><strong>It&rsquo;s a bad practice to allow <code>CORS *</code></strong></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="nx">w</span><span class="p">.</span><span class="nx">Header</span><span class="p">().</span><span class="nx">Set</span><span class="p">(</span><span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="p">,</span> <span class="s2">&#34;*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="o">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s2">&#34;upload successful&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<blockquote>
<p>The first way is the correct way to solve this issue in this scenario.</p>
<p>Enabling <code>no-cors</code> mode in <code>fetch</code> will prevent from accessing the response, which you don&rsquo;t want.</p>
<p>Adding <code>Access-Control-Allow-Origin: *</code> header in http response on web server side is not safe. When the &ldquo;Access-Control-Allow-Origin&rdquo; header is set to &ldquo;*&rdquo;, it means that any website, regardless of its origin, can make <strong>cross-origin</strong> requests to the server and access its resources. This opens up the server to potential attacks, including cross-site scripting (XSS) and cross-site request forgery (CSRF).</p>
</blockquote>
<h2 id="2-why-cross-origin-requests-could-be-insecure">2. Why cross-origin requests could be insecure</h2>
<p>Suppose there is a user who is logged into their banking website, which is hosted on <a href="https://bank.example.com">https://bank.example.com</a>. This means there is authentication cookie (probably a session_id) stored on the user&rsquo;s browser.</p>
<p>Now, suppose an attacker creates a malicious website called <a href="https://evil.com">https://evil.com</a> and manages to trick a user into visiting it.</p>
<p>The attacker&rsquo;s JavaScript code running on <a href="https://evil.com">https://evil.com</a> could make a <strong>cross-origin request</strong> to the banking website&rsquo;s API (<a href="https://bank.example.com/api/userdata">https://bank.example.com/api/userdata</a>) <strong>on behalf of the user&rsquo;s browser</strong>. If the user&rsquo;s browser does not enforce strict same-origin policy, or the server set header <code>Access-Control-Allow-Origin: *</code> in response, which mean the browser will allow this request to be sent.</p>
<blockquote>
<p>If the user has an authentication cookie for the legitimate site, the cookies will be sent along with the request. So the malicious site can perform transactions in the legitimate site on behalf of the user, <strong>despite not having direct access</strong> to the authentication cookie.</p>
</blockquote>
<p>You probably wonder how does the server know where does the http request come from, e.g.,  <a href="https://evil.com/">https://evil.com</a> or <a href="https://bank.example.com">https://bank.example.com</a>:</p>
<p>The server can determine the origin of an HTTP request through the <code>Origin</code> header included in the request&rsquo;s headers. The <code>Origin</code> header will be added by the web browser automatically.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">Origin: https://evil.com
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>You may wonder could the hacker spoof the <code>Origin</code> header from <code>Origin: https://evil.com</code> to <code>Origin: https://bank.example.com</code>:</p>
<p>Browsers are in control of setting the <code>Origin</code> header, and users can&rsquo;t override this value. So you won&rsquo;t see the <code>Origin</code> header spoofed from a browser. A malicious user could craft a curl request that manually sets the <code>Origin</code> header, but this request would come from outside a browser, and may not have browser-specific info (such as cookies).</p>
<p>Remember: CORS is not security. Do not rely on CORS to secure your site. If you are serving protected data, use cookies or OAuth tokens or something other than the <code>Origin</code> header to secure that data. The <code>Access-Control-Allow-Origin</code> header in CORS only dictates which origins should be allowed to make cross-origin requests. Don&rsquo;t rely on it for anything more. Source: <a href="https://stackoverflow.com/a/21058346/16317008">https://stackoverflow.com/a/21058346/16317008</a></p>
<p>A <strong>forbidden header name</strong> is the name of any <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">HTTP header</a> that cannot be modified programmatically; specifically, an HTTP <strong>request</strong> header name . Learn more: <a href="https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name">https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name</a></p>
<h2 id="3-same-origin-policy">3. Same-origin policy</h2>
<p>The same-origin policy is a fundamental security feature <strong>implemented by web browsers</strong>. It is designed to prevent JavaScript code from making requests to a different origin (domain, scheme, or port) than the one from which it was originally loaded.</p>
<p>Normally, web browsers enforce a same-origin policy, which means that JavaScript code running in a web page can only make requests to the same origin from which the page was served. In simpler terms, when a web page is loaded from a particular origin (e.g., <a href="https://example.com/">https://example.com</a>), the same-origin policy ensures that any JavaScript code running within that page can only interact with resources (such as making HTTP requests or accessing data) from the same origin (<a href="https://example.com/">https://example.com</a>). It restricts the ability of JavaScript code to access resources from other origins. Learn more: <a href="https://stackoverflow.com/questions/3102819/disable-same-origin-policy-in-chrome">Disable same origin policy in Chrome - Stack Overflow</a></p>
<h2 id="4-cors">4. CORS</h2>
<p>Cross-origin resource sharing (CORS) can be understood as a controlled relaxation of the same-origin policy.</p>
<p><strong>Cross-Origin Resource Sharing</strong> (<a href="https://developer.mozilla.org/en-US/docs/Glossary/CORS">CORS</a>) is an <strong>HTTP-header based mechanism that allows a server</strong> to indicate any <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin">origins</a> (domain, scheme, or port) other than its own from which a browser should permit loading resources.</p>
<h3 id="41-origins">4.1. Origins</h3>
<p>These are same origin because they have the same scheme (<code>http</code>) and hostname (<code>example.com</code>), and the different file path does not matter:</p>
<ul>
<li><code>http://example.com/app1/index.html</code></li>
<li><code>http://example.com/app2/index.html</code></li>
</ul>
<p>These are not same origin because they use different schemes:</p>
<ul>
<li><code>http://example.com/app1</code></li>
<li><code>https://example.com/app2</code></li>
</ul>
<p>Now you know what is origin, then you should understand why CORS called <strong>Cross-Origin</strong> Resource Sharing.</p>
<p>Source: <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin">Origin - MDN Web Docs Glossary: Definitions of Web-related terms | MDN</a></p>
<h3 id="42-example">4.2. Example</h3>
<p>An example of a cross-origin request: the front-end JavaScript code served from <code>https://domain-a.com</code> uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest"><code>XMLHttpRequest</code></a> to make a request for <code>https://domain-b.com/data.json</code>.</p>
<p>For security reasons, browsers restrict cross-origin HTTP requests initiated from scripts. For example, <code>XMLHttpRequest</code> and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a> follow the <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">same-origin policy</a>. This means that a web application using those APIs can only request resources from the same origin the application was loaded from unless the response from other origins includes the right CORS headers.</p>
<p>Suppose web content at <code>https://foo.example</code> wishes to invoke content on domain <code>https://bar.other</code>. Code of this sort might be used in JavaScript deployed on <code>foo.example</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&#34;https://bar.other/resources/public-data/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="nx">someHandler</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s look at what the browser will send to the server in this case:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="nf">GET</span> <span class="nn">/resources/public-data/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n">Host</span><span class="o">:</span> <span class="l">bar.other</span>
</span></span><span class="line"><span class="cl"><span class="n">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:71.0) Gecko/20100101 Firefox/71.0</span>
</span></span><span class="line"><span class="cl"><span class="n">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span class="line"><span class="cl"><span class="n">Origin</span><span class="o">:</span> <span class="l">https://foo.example</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The request header of note is <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>Origin</code></a>, which shows that the invocation is coming from <code>https://foo.example</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
</span></span><span class="line"><span class="cl"><span class="n">Date</span><span class="o">:</span> <span class="l">Mon, 01 Dec 2008 00:23:53 GMT</span>
</span></span><span class="line"><span class="cl"><span class="n">Server</span><span class="o">:</span> <span class="l">Apache/2</span>
</span></span><span class="line"><span class="cl"><span class="n">Access-Control-Allow-Origin</span><span class="o">:</span> <span class="l">*</span>
</span></span><span class="line"><span class="cl"><span class="n">Content-Type</span><span class="o">:</span> <span class="l">application/xml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[…XML Data…]
</span></span></code></pre></td></tr></table>
</div>
</div><p>In response, the server returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin"><code>Access-Control-Allow-Origin</code></a> header with <code>Access-Control-Allow-Origin: *</code>, which means that the resource can be accessed by <strong>any</strong> origin. <code>*</code> acts as a wildcard here in header for any origin.</p>
<p>Source: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing (CORS) - HTTP | MDN</a></p>
<p>Set the <code>Access-Control-Allow-Origin</code> header for response in Go:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nx">w</span><span class="p">.</span><span class="nf">Header</span><span class="p">().</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Access-Control-Allow-Origin&#34;</span><span class="p">,</span> <span class="s">&#34;*&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;upload successful&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="5-cors-vs-sop">5. CORS vs SOP</h2>
<p>The Same-Origin Policy (SOP) is a security feature <strong>enforced by web browsers</strong> that restricts web pages (javascript) from interacting with resources (such as making requests or accessing data) from different origins.</p>
<p><strong>CORS allows servers</strong> to specify which origins are allowed to access their resources, even if they are from different origins. It provides a set of HTTP headers that the server includes in its responses to explicitly permit cross-origin requests from specific origins.</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">David</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-10-06
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/golang/">golang</a>
          <a href="/tags/http/">http</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/cs-basics/003-ssl-secure-communication/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">HTTPS SSL TLS</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/cs-basics/019-csrf-attack/">
            <span class="next-text nav-default">CSRF Attack and CORS</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:shwezhu@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/shwezhu" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/shwezhu" class="iconfont icon-github" title="github"></a>
  <a href="https://shaowenzhu.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>David</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
