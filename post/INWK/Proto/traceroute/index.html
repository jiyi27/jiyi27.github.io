<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Ping &amp; Traceroute Command - 课堂笔记 - David&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="David" /><meta name="description" content="1. Ping and Tracert Test A number of factors contribute to how fast your connection to our servers is, including: Your computer health The connection you have to your ISP (internet service provider) The number of network hops between your ISP and our servers The amount of traffic our servers are currently having Running a ping test can help you determine if your website is slow because of a connection" />






<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="https://shaowenzhu.top/post/inwk/proto/traceroute/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Ping &amp; Traceroute Command - 课堂笔记" />
<meta property="og:description" content="1. Ping and Tracert Test A number of factors contribute to how fast your connection to our servers is, including: Your computer health The connection you have to your ISP (internet service provider) The number of network hops between your ISP and our servers The amount of traffic our servers are currently having Running a ping test can help you determine if your website is slow because of a connection" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shaowenzhu.top/post/inwk/proto/traceroute/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-06-23T16:15:34+00:00" />
<meta property="article:modified_time" content="2023-06-23T16:15:34+00:00" />
<meta itemprop="name" content="Ping &amp; Traceroute Command - 课堂笔记">
<meta itemprop="description" content="1. Ping and Tracert Test A number of factors contribute to how fast your connection to our servers is, including: Your computer health The connection you have to your ISP (internet service provider) The number of network hops between your ISP and our servers The amount of traffic our servers are currently having Running a ping test can help you determine if your website is slow because of a connection"><meta itemprop="datePublished" content="2023-06-23T16:15:34+00:00" />
<meta itemprop="dateModified" content="2023-06-23T16:15:34+00:00" />
<meta itemprop="wordCount" content="2314">
<meta itemprop="keywords" content="inwk," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Ping &amp; Traceroute Command - 课堂笔记"/>
<meta name="twitter:description" content="1. Ping and Tracert Test A number of factors contribute to how fast your connection to our servers is, including: Your computer health The connection you have to your ISP (internet service provider) The number of network hops between your ISP and our servers The amount of traffic our servers are currently having Running a ping test can help you determine if your website is slow because of a connection"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">David&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">David&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Ping &amp; Traceroute Command - 课堂笔记</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-06-23 </span>
        <div class="post-category">
            <a href="/categories/inwk/"> inwk </a>
            <a href="/categories/proto/"> proto </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-ping-and-tracert-test">1. Ping and Tracert Test</a></li>
        <li><a href="#2-traceroute">2. Traceroute</a>
          <ul>
            <li><a href="#21-how-to-read-a-traceroute-report">2.1. How To Read a Traceroute Report</a></li>
            <li><a href="#22-implementation-traceroute">2.2. Implementation Traceroute</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-ping-and-tracert-test">1. Ping and Tracert Test</h2>
<p>A number of factors contribute to how fast your connection to our servers is, including:</p>
<ul>
<li>Your computer health</li>
<li>The connection you have to your ISP (internet service provider)</li>
<li>The number of network hops between your ISP and our servers</li>
<li>The amount of traffic our servers are currently having</li>
</ul>
<p>Running a <strong>ping test</strong> can help you determine if your website is slow because of a connection issue. If it is, then running a <strong>traceroute test</strong> can help you to determine where in the connection there is a slowdown.</p>
<h2 id="2-traceroute">2. Traceroute</h2>
<p>A traceroute provides a map of how data on the internet travels from its source to its destination.  When you connect with a website, the data you get must travel across multiple devices and networks along the way, particularly routers.</p>
<p>A traceroute displays the path that the signal took as it traveled around the Internet to the website. It also displays times which are the response times that occurred at each stop along the route. If there is a connection problem or latency connecting to a site, it will show up in these times. You will be able to identify which of the stops (also called ‘hops’) along the route is the culprit.</p>
<h3 id="21-how-to-read-a-traceroute-report">2.1. How To Read a Traceroute Report</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ traceroute -n example.com
</span></span><span class="line"><span class="cl">traceroute to example.com <span class="o">(</span>93.184.216.34<span class="o">)</span>, <span class="m">64</span> hops max, <span class="m">52</span> byte packets
</span></span><span class="line"><span class="cl"> <span class="m">1</span>  192.168.2.1  6.037 ms  3.886 ms  2.796 ms
</span></span><span class="line"><span class="cl"> <span class="m">2</span>  10.178.218.5  5.090 ms  4.955 ms  13.188 ms
</span></span><span class="line"><span class="cl"> <span class="m">3</span>  142.166.181.21  4.901 ms
</span></span><span class="line"><span class="cl">    142.166.181.17  4.983 ms
</span></span><span class="line"><span class="cl">    142.166.181.21  4.881 ms
</span></span><span class="line"><span class="cl"> <span class="m">4</span>  207.231.227.62  25.595 ms
</span></span><span class="line"><span class="cl">    142.166.149.93  6.563 ms
</span></span><span class="line"><span class="cl">    207.231.227.62  23.943 ms
</span></span><span class="line"><span class="cl"> <span class="m">5</span>  * * *
</span></span><span class="line"><span class="cl"> <span class="m">6</span>  152.195.69.131  35.167 ms *  39.538 ms
</span></span><span class="line"><span class="cl"> <span class="m">7</span>  152.195.69.139  40.334 ms  41.953 ms  39.770 ms
</span></span><span class="line"><span class="cl"> <span class="m">8</span>  93.184.216.34  40.837 ms  36.249 ms  36.852 ms
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>Hop Number</th>
<th>RTT Attempt 1</th>
<th>RTT Attempt 2</th>
<th>RTT Attempt 3</th>
<th>Hop Details</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>2ms</td>
<td>1ms</td>
<td>1ms</td>
<td>10.0.0.1</td>
</tr>
<tr>
<td>2</td>
<td>10ms</td>
<td>10ms</td>
<td>10ms</td>
<td>96.120.40.245</td>
</tr>
<tr>
<td>3</td>
<td>10ms</td>
<td>11ms</td>
<td>12ms</td>
<td>96.110.175.85</td>
</tr>
</tbody>
</table>
<h4 id="do-you-see-an-asterisk---what-does-it-mean">Do You See an Asterisk <code>* </code>? What Does It Mean?</h4>
<p>The most common issue you will see with a traceroute is a timeout response, which is represented by an asterisk (*). These happen quite frequently and for a variety of different reasons. When you see an asterisk, it will mean one of the following things:</p>
<ul>
<li><strong>Single Asterisk on a Hop:</strong> This means that the request timed out on just one of the three attempts. This can be a sign that there is an intermittent problem at that hop.</li>
<li><strong>Three Asterisks, Then Failure:</strong> If you see all three attempts at a hop have asterisks and then the traceroute errors out, it means that the hop is completely down.</li>
<li><strong>Three Asterisks, Then Success:</strong> If you see three attempts at a hop failing but then the rest of the traceroute continues without an issue, that is actually not a problem at all. This simply means that probably the packets arrived at a router with a firewall that prevents traceroute online requests.</li>
</ul>
<p>如果RTT的位置出现了星号（*），表明数据包在期望的时间窗口内没有返回。</p>
<ul>
<li>一个或两个星号出现在单个跃点上，并不一定表明数据包丢失了。许多互联网路由器有意丢弃ping和路由追踪的数据包，但并不影响使用这些路由器的应用程序。这一招称为ICMP（网控协议）限流术，用来使路由器免遭拒绝服务（DoS)攻击。</li>
</ul>
<h4 id="checking-the-hop-times">Checking the Hop Times</h4>
<p>The times listed in the RTT columns are the main thing you want to look at when evaluating a traceroute. Consistent times are what you are looking for. There may be specific hops with increased latency times but they may not indicate that there is an issue. You need to look at a pattern over the whole report. Times above 150ms are considered to be long for a trip within the continental United States. (Times over 150ms may be normal if the signal crosses an ocean, however.) but issues may show up with very large numbers.</p>
<p>理论上讲，RTT值小于150ms将不会影响网络应用。很多应用在延时远高于150ms的时候也跑得挺欢，但150ms可以当成合理的上限，通常情况下是低于100ms的。
网络传输延时，主要受限两端的物理光纤距离。如果两地相隔好几千里，受到光速的限制，100-120ms的延时是可以接受的。</p>
<h3 id="22-implementation-traceroute">2.2. Implementation Traceroute</h3>
<p>看看 traceroute 使用什么数据包:</p>
<blockquote>
<p>On Windows, tracert sends ICMP Echo Request packets, rather than the UDP packets traceroute sends by default.</p>
<p>On Unix-like operating systems, traceroute sends, by default, a sequence of User Datagram Protocol (UDP) packets, with destination port numbers ranging from 33434 to 33534; the implementations of traceroute shipped with Linux, FreeBSD and macOS include an option to use ICMP Echo Request packets (-I), or any arbitrary protocol (-P) such as UDP, TCP using TCP SYN packets, or ICMP. <a href="https://en.wikipedia.org/wiki/Tracerout">traceroute</a></p>
</blockquote>
<p>具体过程如下:</p>
<p>The time-to-live (TTL) value, also known as hop limit, is used in determining the intermediate routers being traversed towards the destination. Traceroute sends packets with TTL values that gradually increase from packet to packet, starting with TTL value of one. Routers decrement TTL values of packets by one when routing and discard packets whose TTL value has reached zero, returning the ICMP error message ICMP Time Exceeded.[10] For the first set of packets, the first router receives the packet, decrements the TTL value and drops the packet because it then has TTL value zero. The router sends an ICMP Time Exceeded message back to the source. The next set of packets are given a TTL value of two, so the first router forwards the packets, but the second router drops them and replies with ICMP Time Exceeded. Proceeding in this way, traceroute uses the returned ICMP Time Exceeded messages to build a list of routers that packets traverse, until the destination is reached and returns an ICMP Destination Unreachable message if UDP packets are being used or an ICMP Echo Reply message if ICMP Echo messages are being used.</p>
<h4 id="linux-traceroute-实现原理">Linux traceroute 实现原理</h4>
<p><img src="a.png" alt="a"></p>
<ol>
<li>从源地址发出一个UDP探测包到目的地址，并将TTL设置为1；</li>
<li>到达路由器时，将TTL减1；</li>
<li>当TTL变为0时，包被丢弃，路由器向源地址发回一个ICMP超时通知（ICMP Time Exceeded Message），内含发送IP包的源地址，IP包的所有内容及路由器的IP地址；</li>
<li>当源地址收到该ICMP包时，显示这一跳路由信息；</li>
<li>重复1～5，并每次设置TTL加1；</li>
<li>直至目标地址收到探测数据包，并返回端口不可达通知（ICMP Port Unreachable）；</li>
<li>当源地址收到ICMP Port Unreachable包时停止traceroute。</li>
</ol>
<blockquote>
<p>注：</p>
<ol>
<li>
<p>Linux和Mac OS等系统使用UDP包进行探测，目标端口号默认为33434，每次探测目标端口号加1。Traceroute故意使用了一个大于 30000 的目标端口号，以保证目标地址收到数据包后能够返回一个“端口不可达”的 ICMP 报文，于是源地址就可将端口不可达报文当作跟踪结束的标志。</p>
</li>
<li>
<p>Traceroute每跳默认发送3个探测包（发包的数量可通过-q进行设置），探测包的返回会受到网络情况的影响。如果防火墙封掉了ICMP的返回信息，那么相应的延时位置会以*显示。如果某台网关阻塞或者某台DNS出现问题，那么相应行的延时会变长。可以加-n 参数来避免DNS解析，以IP格式输出数据。</p>
</li>
<li>
<p>每个探测包都有唯一的标识号，使得Traceroute能够识别返回的包。UDP数据包使用递增的目标端口号进行标识。</p>
</li>
</ol>
</blockquote>
<h4 id="windows-tracert-实现原理">Windows tracert 实现原理</h4>
<p><img src="b.png" alt="b"></p>
<ol>
<li>从源地址发出一个ICMP请求回显（ICMP Echo Request）数据包到目的地址，并将TTL设置为1；</li>
<li>到达路由器时，将TTL减1；</li>
<li>当TTL变为0时，包被丢弃，路由器向源地址发回一个ICMP超时通知（ICMP Time Exceeded Message），内含发送IP包的源地址，IP包的所有内容及路由器的IP地址；</li>
<li>当源地址收到该ICMP包时，显示这一跳路由信息；</li>
<li>重复1～5，并每次设置TTL加1；</li>
<li>直至目标地址收到探测数据包，并返回ICMP回应答复（ICMPEcho Reply）；</li>
<li>当源地址收到ICMP Echo Reply包时停止tracert。</li>
</ol>
<blockquote>
<p>注：</p>
<ol>
<li>
<p>Windows系统使用ICMP请求回显（ICMP Echo Request）数据包进行探测，源地址以目的地址返回的ICMP回应答复（ICMP Echo Reply）作为跟踪结束标志。</p>
</li>
<li>
<p>Traceroute每跳默认发送3个探测包。在未能到达路由器或未返回ICMP超时通知的情况下，相应的延时位置会以*显示。</p>
</li>
<li>
<p>每个探测包都有唯一的标识号，ICMP数据包使用seq进行标识</p>
</li>
</ol>
</blockquote>
<p>参考:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Tracerout">traceroute - Wiki</a></li>
<li><a href="https://www.fortinet.com/resources/cyberglossary/traceroutes">What is Traceroute: What Does it Do &amp; How Does It Work?</a></li>
<li><a href="https://www.inmotionhosting.com/support/website/why-is-my-server-slow-how-do-i-run-a-ping-and-tracert-test/">Why Is My Server Slow / How Do I Run a Ping and Tracert Test? | InMotion Hosting</a></li>
<li><a href="https://www.inmotionhosting.com/support/server/ssh/read-traceroute/">How to Read a Traceroute | InMotion Hosting</a></li>
<li><a href="https://www.jianshu.com/p/30b064a8b07c">看懂tracert数据 - 简书</a></li>
<li><a href="https://www.catchpoint.com/network-admin-guide/how-to-read-a-traceroute">How to Read a Traceroute: Step By Step Tutorial</a></li>
<li><a href="https://www.baeldung.com/linux/traceroute-three-stars">Meaning of * * * in the Output of traceroute | Baeldung on Linux</a></li>
<li><a href="https://www.cnblogs.com/machangwei-8/p/10353279.html">traceroute命令详解 - 马昌伟 - 博客园</a></li>
<li><a href="https://www.hackingarticles.in/working-of-traceroute-using-wireshark/">Working of Traceroute using Wireshark - Hacking Articles</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">David</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-06-23
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/inwk/">inwk</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/inwk/proto/wireshark/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">学习使用 Wireshark 抓包分析 - 课堂笔记</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/inwk/proto/ping-icmp-message/">
            <span class="next-text nav-default">Ping &amp; ICMP Message - 课堂笔记</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:shwezhu@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/shwezhu" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/shwezhu" class="iconfont icon-github" title="github"></a>
  <a href="https://shaowenzhu.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>David</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
