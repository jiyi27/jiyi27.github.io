<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>HTTP Messages - David&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="David" /><meta name="description" content="1. HTTP Messages 1.1. HTTP Requests 1.1.1. Start line A start line contains three parts:
Their start-line contain three elements:
An HTTP method, a verb (like GET, PUT or POST) or a noun (like HEAD or OPTIONS), that describes the action to be performed. The request target
Usually a URL Sometimes url followed by a &#39;?&#39; and query string: http://example.com/?bar1=a&amp;amp;bar2=b The HTTP version
1 POST www.example.com/test.html?username=alibaba HTTP/1.1 1.1.2. Headers An HTTP header consists of its case-insensitive name followed by a colon (:), then by its value." />






<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="https://shaowenzhu.top/post/cs-basics/018-http-messages/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="HTTP Messages" />
<meta property="og:description" content="1. HTTP Messages 1.1. HTTP Requests 1.1.1. Start line A start line contains three parts:
Their start-line contain three elements:
An HTTP method, a verb (like GET, PUT or POST) or a noun (like HEAD or OPTIONS), that describes the action to be performed. The request target
Usually a URL Sometimes url followed by a &#39;?&#39; and query string: http://example.com/?bar1=a&amp;bar2=b The HTTP version
1 POST www.example.com/test.html?username=alibaba HTTP/1.1 1.1.2. Headers An HTTP header consists of its case-insensitive name followed by a colon (:), then by its value." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shaowenzhu.top/post/cs-basics/018-http-messages/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-09-23T09:51:30+00:00" />
<meta property="article:modified_time" content="2023-09-23T09:51:30+00:00" />
<meta itemprop="name" content="HTTP Messages">
<meta itemprop="description" content="1. HTTP Messages 1.1. HTTP Requests 1.1.1. Start line A start line contains three parts:
Their start-line contain three elements:
An HTTP method, a verb (like GET, PUT or POST) or a noun (like HEAD or OPTIONS), that describes the action to be performed. The request target
Usually a URL Sometimes url followed by a &#39;?&#39; and query string: http://example.com/?bar1=a&amp;bar2=b The HTTP version
1 POST www.example.com/test.html?username=alibaba HTTP/1.1 1.1.2. Headers An HTTP header consists of its case-insensitive name followed by a colon (:), then by its value."><meta itemprop="datePublished" content="2023-09-23T09:51:30+00:00" />
<meta itemprop="dateModified" content="2023-09-23T09:51:30+00:00" />
<meta itemprop="wordCount" content="1812">
<meta itemprop="keywords" content="cs basics,http," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="HTTP Messages"/>
<meta name="twitter:description" content="1. HTTP Messages 1.1. HTTP Requests 1.1.1. Start line A start line contains three parts:
Their start-line contain three elements:
An HTTP method, a verb (like GET, PUT or POST) or a noun (like HEAD or OPTIONS), that describes the action to be performed. The request target
Usually a URL Sometimes url followed by a &#39;?&#39; and query string: http://example.com/?bar1=a&amp;bar2=b The HTTP version
1 POST www.example.com/test.html?username=alibaba HTTP/1.1 1.1.2. Headers An HTTP header consists of its case-insensitive name followed by a colon (:), then by its value."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">David&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">David&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">HTTP Messages</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-09-23 </span>
        <div class="post-category">
            <a href="/categories/cs-basics/"> cs basics </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-http-messages">1. HTTP Messages</a>
          <ul>
            <li><a href="#11-http-requests">1.1. HTTP Requests</a></li>
            <li><a href="#12-http-responses">1.2. HTTP Responses</a></li>
          </ul>
        </li>
        <li><a href="#2-form-data-vs-query-string">2. Form data vs query string</a>
          <ul>
            <li><a href="#21-client-side">2.1. Client side</a></li>
            <li><a href="#22-server-side">2.2. Server side</a></li>
          </ul>
        </li>
        <li><a href="#3-post-data">3. POST data</a>
          <ul>
            <li><a href="#31-example-in-real-code">3.1. Example in real code</a></li>
          </ul>
        </li>
        <li><a href="#4-form-data-restriction">4. Form data restriction</a></li>
        <li><a href="#5-some-common-headers">5. Some common headers</a>
          <ul>
            <li><a href="#51-cooke">5.1. cooke</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="1-http-messages">1. HTTP Messages</h2>
<h3 id="11-http-requests">1.1. HTTP Requests</h3>
<h4 id="111-start-line">1.1.1. Start line</h4>
<p>A start line contains three parts:</p>
<ul>
<li>
<p>Their <em>start-line</em> contain three elements:</p>
<ul>
<li>An HTTP method, a verb (like <code>GET</code>, <code>PUT</code> or <code>POST</code>) or a noun (like HEAD or OPTIONS), that describes the action to be performed.</li>
</ul>
</li>
<li>
<p>The <em>request target</em></p>
<ul>
<li>Usually a URL</li>
<li>Sometimes url followed by a <code>'?'</code> and <strong>query string</strong>: <code>http://example.com/?bar1=a&amp;bar2=b</code></li>
</ul>
</li>
<li>
<p>The <em>HTTP version</em></p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST www.example.com/test.html?username=alibaba HTTP/1.1
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="112-headers">1.1.2. Headers</h4>
<p>An HTTP header consists of its case-insensitive name followed by a colon (<code>:</code>), then by its value. Whitespace before the value is ignored. This is an HTTP header:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Content-Type: text/html; charset=utf-8
</span></span></code></pre></td></tr></table>
</div>
</div><p>Usually, a request or response consist of many headers:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /home.html HTTP/1.1
</span></span><span class="line"><span class="cl">Host: developer.mozilla.org
</span></span><span class="line"><span class="cl">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:50.0) Gecko/20100101 Firefox/50.0
</span></span><span class="line"><span class="cl">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
</span></span><span class="line"><span class="cl">Accept-Language: en-US,en;q=0.5
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Referer: https://developer.mozilla.org/testpage.html
</span></span><span class="line"><span class="cl">Connection: keep-alive
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you can see above, there are 7 headers in this request, a header like a key-value string, <strong>different header usually has different syntax and its own type</strong>. For example:</p>
<p>The type of <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept"><code>Accept header</code></a> is a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Request_header"> Request header</a>, and its syntax is below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Accept: &lt;MIME_type&gt;/&lt;MIME_subtype&gt;
</span></span><span class="line"><span class="cl">Accept: &lt;MIME_type&gt;/*
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">// Multiple types, weighted with the quality value syntax:
</span></span><span class="line"><span class="cl">Accept: text/html, application/xhtml+xml, application/xml;q=0.9, image/webp, */*;q=0.8
</span></span></code></pre></td></tr></table>
</div>
</div><p>The type of  <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type header</code></a> is <a href="https://developer.mozilla.org/en-US/docs/Glossary/Representation_header">Representation header</a>, and its syntax:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Content-Type: text/html; charset=utf-8
</span></span><span class="line"><span class="cl">Content-Type: multipart/form-data; boundary=something
</span></span></code></pre></td></tr></table>
</div>
</div><p>The offcial way to indicate aobve is:</p>
<p>Many different headers can appear in an HTTP request. They can be divided in several groups:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/General_header">General headers</a>, like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Via"><code>Via</code></a>, apply to the message as a whole.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Request_header">Request headers</a>, like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent"><code>User-Agent</code></a> or <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept"><code>Accept</code></a>, modify the request by specifying it further (like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language"><code>Accept-Language</code></a>), by giving context (like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer"><code>Referer</code></a>), or by conditionally restricting it (like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None"><code>If-None</code></a>).</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Representation_header">Representation headers</a> like <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a> that describe the original format of the message data and any encoding applied (only present if the message has a body).</li>
</ul>
<p><img src="/018-http/a.png" alt="a"></p>
<h4 id="113-body">1.1.3. Body</h4>
<p>The final part of the request is its body. Not all requests have one: requests fetching resources, like <code>GET</code>, <code>HEAD</code>, <code>DELETE</code>, or <code>OPTIONS</code>, usually don&rsquo;t need one. Some requests send data to the server in order to update it: as often the case with <code>POST</code> requests (containing HTML form data).</p>
<p>Bodies can be broadly divided into two categories:</p>
<ul>
<li>Single-resource bodies, consisting of one single file, defined by the two headers: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Length"><code>Content-Length</code></a>.</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types#multipartform-data">Multiple-resource bodies</a>, consisting of a multipart body, each containing a different bit of information. This is typically associated with <a href="https://developer.mozilla.org/en-US/docs/Learn/Forms">HTML Forms</a>.</li>
</ul>
<h3 id="12-http-responses">1.2. HTTP Responses</h3>
<p>HTTP Reponse also contains three parts:</p>
<ul>
<li>
<p>Status line</p>
<ul>
<li>Three part:  <em>protocol version</em>, a <em>status code</em>, a <em>status text</em> (A brief, purely informational, textual description of the status code to help a human understand the HTTP message.)</li>
<li><code>HTTP/1.1 404 Not Found</code></li>
</ul>
</li>
<li>
<p>Headers</p>
<ul>
<li>Same as http request.</li>
</ul>
</li>
<li>
<p>Body</p>
<ul>
<li>Same as http request.</li>
</ul>
</li>
</ul>
<p><img src="/018-http/b.png" alt="b"></p>
<p>Source: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages">https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages</a></p>
<h2 id="2-form-data-vs-query-string">2. Form data vs query string</h2>
<h3 id="21-client-side">2.1. Client side</h3>
<p>Query string resides in the url:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">http://www.blabla.com?a=1&amp;b=2
</span></span></code></pre></td></tr></table>
</div>
</div><p>Form data is sent with the request body. Therefore, when there is sensitive data, we usually put data in the form not the query string. Because the requested URL might show up in <strong>Web server logs</strong> and <strong>browser history/bookmarks</strong> which is not a good thing. <a href="https://stackoverflow.com/a/830092/16317008">source</a></p>
<h3 id="22-server-side">2.2. Server side</h3>
<h4 id="221-go-web">2.2.1. Go Web</h4>
<p>When POST data to server, the <code>Content-Type</code> header in the request is important, for example in Go there is a method to parse the form data in the request:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// Parse username and password in form.
</span></span><span class="line"><span class="cl">_ = req.ParseForm()
</span></span><span class="line"><span class="cl">username := req.Form.Get(&#34;username&#34;)
</span></span><span class="line"><span class="cl">password := req.Form.Get(&#34;password&#34;)
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s check the <code>ParseForm()</code> method in the doc:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">Request</span><span class="p">)</span> <span class="nf">ParseForm</span><span class="p">()</span> <span class="kt">error</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ParseForm populates <code>r.Form</code> and <code>r.PostForm</code>.</p>
<p><strong>For all requests</strong>, <code>ParseForm()</code> parses the raw query from the URL and updates r.Form.</p>
<p>For POST, PUT, and PATCH requests, <strong>it also reads</strong> the request body, parses it as a form and puts the results into both r.PostForm and r.Form. Request body parameters take precedence over URL query string values in r.Form.</p>
<p>For other HTTP methods, or when the Content-Type is not <code>application/x-www-form-urlencoded</code>, the request Body is not read, and r.PostForm is initialized to a non-nil, empty value.</p>
<p>This means when you call <code>r.ParseForm()</code>, for all types of request, it will try to parse the query string resides in thr url automatically, and put the data (key-value) into <code>r.Form</code>  which is a map in <code>Go</code>. If your request is POST, PUT, PATCH <strong>and</strong> the <code>Content-Type</code> header of the request is <code>application/x-www-form-urlencoded</code>, <code>r.ParseForm()</code> will also try to parse the request body, and if there are same data parsed from request body, they will take place of the data parsed from query string. Otherwise the request body will be ignored by <code>r.ParseForm()</code>.</p>
<p>This means the command below will achieve same thing for Go server if the server call <code>ParseForm()</code> to parse form:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># with -d option curl will make request POST automatically</span>
</span></span><span class="line"><span class="cl">curl localhost:8080/hello -d <span class="s2">&#34;username=davidzhu&amp;password=778899a&#34;</span> 
</span></span><span class="line"><span class="cl">curl -X POST <span class="s2">&#34;localhost:8080/hello?username=david&amp;password=778899a&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Reference: <a href="https://pkg.go.dev/net/http#Request.ParseForm">https://pkg.go.dev/net/http#Request.ParseForm</a></p>
<p>Learn more about curl: <a href="https://davidzhu.xyz/post/cs-basics/017-curl/">https://davidzhu.xyz/post/cs-basics/017-curl/</a></p>
<p>Learn more about Go parse form and request body: <a href="https://davidzhu.xyz/post/golang/practice/010-go-web-2/">https://davidzhu.xyz/post/golang/practice/010-go-web-2/</a></p>
<h4 id="222-spring-web">2.2.2. Spring Web</h4>
<p>If your server is wiritten in Java Spring, and you need to POST form data to the server, you need to set your <code>Content-Type</code> header of your request to <code>application/json</code>.</p>
<p>When we write test we usually use <code>curl</code> command, looks like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl localhost:8080/hello -d <span class="s1">&#39;{&#34;username&#34;:&#34;davidzhu&#34;, &#34;password&#34;:&#34;778899a&#34;}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, this command with <code>-d</code> option will set <code>Content-Type</code> header to <code>application/x-www-form-urlencoded</code>  by default, which is not accepted on Spring&rsquo;s side.</p>
<p>Therefore you have to set <code>Content-Type</code> explicitly:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl localhost:8080/postbody 
</span></span><span class="line"><span class="cl">		-d <span class="s1">&#39;{&#34;username&#34;:&#34;davidzhu&#34;, &#34;password&#34;:&#34;778899a&#34;}&#39;</span> 
</span></span><span class="line"><span class="cl">		-H <span class="s2">&#34;Content-Type: application/json&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note the format of the <code>-d</code> is josn format not url query string format: <code>&quot;username=davidzhu&amp;password=778899a&quot;</code>, this format is <code>application/x-www-form-urlencoded</code>, not <code>application/json</code>.</p>
<p>Source: <a href="https://stackoverflow.com/a/7173011/16317008">https://stackoverflow.com/a/7173011/16317008</a></p>
<p>Learn more about curl post: <a href="https://reqbin.com/req/c-dwjszac0/curl-post-json-example">https://reqbin.com/req/c-dwjszac0/curl-post-json-example</a></p>
<h2 id="3-post-data">3. POST data</h2>
<p>The <strong>HTTP <code>POST</code> method</strong> sends data to the server. The type of the body of the request is indicated by the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a> header.</p>
<p>A <code>POST</code> request is typically sent via an <a href="https://developer.mozilla.org/en-US/docs/Learn/Forms">HTML form</a> and results in a change on the server. In this case, the content type is selected by putting the adequate string in the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form#enctype"><code>enctype</code></a> attribute of the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/form"><code>form</code></a>  element or the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#formenctype"><code>formenctype</code></a> attribute of the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input"><code>input</code></a> or <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button"><code>button</code></a> elements:</p>
<ul>
<li><code>application/x-www-form-urlencoded</code>: the keys and values are encoded in key-value tuples separated by <code>'&amp;'</code>, with a <code>'='</code> between the key and the value.</li>
<li><code>multipart/form-data</code>: each value is sent as a block of data (&ldquo;body part&rdquo;), with a user agent-defined delimiter (&ldquo;boundary&rdquo;) separating each part. The keys are given in the <code>Content-Disposition</code> header of each part.</li>
<li><code>text/plain</code></li>
</ul>
<p><img src="/018-http-messages/a.png" alt="a"></p>
<p>Source: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST">https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST</a></p>
<h3 id="31-example-in-real-code">3.1. Example in real code</h3>
<p>Let&rsquo;s say I have a html code like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;http://localhost:8080/postform&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-example&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-example&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;username&#34;</span><span class="p">&gt;</span>username<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;usernam&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;username&#34;</span> <span class="na">required</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-example&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&#34;password&#34;</span><span class="p">&gt;</span>password<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;passwor&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">required</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-example&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">value</span><span class="o">=</span><span class="s">&#34;register&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>And when I push the regiser buttion to submit the form, the http request looks like this:</p>
<p><img src="/018-http-messages/c.png" alt="c"></p>
<p><img src="/018-http-messages/d.png" alt="d"></p>
<p>As you can see the form data resides in the request body, not in the URL.</p>
<p>Sometimes when you put data in the URL as a query string <strong>or</strong> put data in the form, and make a POST request, these two cases may result same thing (the server will get same data), which gives you a wrong impression that form data wil be put into URL too.</p>
<p>Looks like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl -X POST localhost:8080/postform -d <span class="s2">&#34;username=davidzhu&amp;password=778899a&#34;</span> 
</span></span><span class="line"><span class="cl">$ curl -X POST <span class="s2">&#34;localhost:8080/postform?username=david&amp;password=778899a&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The server may get same data for these two command, this is because the server may try to parse the query string and form data at the same time, we have talked this above in Go web.</p>
<h2 id="4-form-data-restriction">4. Form data restriction</h2>
<p>As we talk above, form data can only be these three type by by default:<code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, <code>text/plain</code>, and you have to set the <code>Content-Type</code> to the corresponding type with correct format.</p>
<p>If you want <code>application/json</code> type, you need encode the form data into josn at client and decode the request body at server side. Besides, don&rsquo;t forget to set the <code>Content-Type</code> header to <code>application/json</code> which will tell the server the data format resides in the request body.</p>
<p><a href="https://stackoverflow.com/a/22195153/16317008">A answer</a> from stackoverflow, hope it will help:</p>
<p>HTML provides no way to generate JSON from form data. If you really want to handle it from the client, then you would have to resort to using JavaScript to:</p>
<ol>
<li>gather your data from the form via DOM</li>
<li>organise it in an object or array</li>
<li>generate JSON with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify">JSON.stringify</a></li>
<li>POST it with <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest">XMLHttpRequest</a></li>
</ol>
<p>You&rsquo;d probably be better off sticking to <code>application/x-www-form-urlencoded</code> data and processing that on the server instead of JSON. Your form doesn&rsquo;t have any complicated hierarchy that would benefit from a JSON data structure.</p>
<p>This is same in Go, if you want send json data in the request body, you should encode it into bytes and decode request body at server:</p>
<p>client:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// string in back quote is raw string which means
</span></span></span><span class="line"><span class="cl"><span class="c1">// the double quote here will lose its special meaning
</span></span></span><span class="line"><span class="cl"><span class="c1">// decode the json string into 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">reader_json</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="s">`{&#34;username&#34;: &#34;david&#34;, &#34;password&#34;: &#34;my_password&#34;}`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPost</span><span class="p">,</span> <span class="s">&#34;/postbody&#34;</span><span class="p">,</span> <span class="nx">reader_json</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>server:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// Parse username and password in form.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">type</span> <span class="nx">info</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Username</span> <span class="kt">string</span> <span class="s">`json:&#34;username&#34;`</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Password</span> <span class="kt">string</span> <span class="s">`json:&#34;password&#34;`</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">user</span> <span class="o">:=</span> <span class="nx">info</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// note that r.Body is an io.Reader
</span></span></span><span class="line"><span class="cl"><span class="c1">// which means decoder.Decode() method will consume data stroed in r.Body
</span></span></span><span class="line"><span class="cl"><span class="c1">// you cannot read same data twice
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">decoder</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">NewDecoder</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">decoder</span><span class="p">.</span><span class="nf">Decode</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="5-some-common-headers">5. Some common headers</h2>
<h3 id="51-cooke">5.1. cooke</h3>
<p>There are two headers related to cookie, one is <code>Set-Cookie</code> header another is <code>Cookie</code> header.</p>
<p>After receiving an HTTP request, a server can send one or more <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie"><code>Set-Cookie</code></a> headers with the response. The browser usually stores the cookie and sends it with requests made to the same server inside a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cookie"><code>Cookie</code></a> HTTP header.</p>
<p>For example, a response from server contains cookie headers may looks like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">HTTP/2.0 200 OK
</span></span><span class="line"><span class="cl">Content-Type: text/html
</span></span><span class="line"><span class="cl">Set-Cookie: yummy_cookie=choco
</span></span><span class="line"><span class="cl">Set-Cookie: tasty_cookie=strawberry
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[page content]
</span></span></code></pre></td></tr></table>
</div>
</div><p>A HTTP request may looks like this below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">GET /sample_page.html HTTP/2.0
</span></span><span class="line"><span class="cl">Host: www.example.org
</span></span><span class="line"><span class="cl">Cookie: yummy_cookie=choco; tasty_cookie=strawberry
</span></span></code></pre></td></tr></table>
</div>
</div><p>Therefore, when I want set cookie manually for my http request, I&rsquo;ll probably do something like this (I do this in Go):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">req</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewRequest</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPost</span><span class="p">,</span> <span class="s">&#34;/chat&#34;</span><span class="p">,</span> <span class="nx">your_encoded_message</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// set content-type header
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Content-Type&#34;</span><span class="p">,</span> <span class="s">&#34;application/x-www-form-urlencoded&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">// set cookie header (cookie is a key value data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">req</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="s">&#34;Cookie&#34;</span><span class="p">,</span> <span class="s">&#34;session_id=xxxxxxxxxxx&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If I want get cookie from repsonse, I&rsquo;ll probably retrieve the cookie like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">response</span> <span class="o">:=</span> <span class="nf">makeRequest</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">my_cooke</span> <span class="o">:=</span> <span class="nx">response</span><span class="p">.</span><span class="nf">Header</span><span class="p">().</span><span class="nf">Get</span><span class="p">(</span><span class="s">&#34;Set-Cookie&#34;</span><span class="p">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Cookie is just a header which having no doubt resides in the header of HTTP mesages, don&rsquo;t overthinking.</p>
<p>Reference: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#creating_cookies">https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#creating_cookies</a></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">David</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-09-23
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/cs-basics/">cs basics</a>
          <a href="/tags/http/">http</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/golang/practice/010-go-web-2/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Parse Form Data in Go Server</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/cs-basics/017-curl/">
            <span class="next-text nav-default">Curl Basics</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:shwezhu@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/shwezhu" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/shwezhu" class="iconfont icon-github" title="github"></a>
  <a href="https://shaowenzhu.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>David</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
