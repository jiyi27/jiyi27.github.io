<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Docker Basic Operations - David&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="David" /><meta name="description" content="Video: https://youtu.be/Ozb9mZg7MVM?si=zFkftI_gXloSrZLh
Assume the Dockerfile under the file-station folder.
1. Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 FROM golang:alpine LABEL authors=&amp;#34;David&amp;#34; # All the following command will treated as inside this folder of docker WORKDIR /app # copy all the files of our project into the /app folder of docker COPY ." />






<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="https://shaowenzhu.top/post/docker/001-basics/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Docker Basic Operations" />
<meta property="og:description" content="Video: https://youtu.be/Ozb9mZg7MVM?si=zFkftI_gXloSrZLh
Assume the Dockerfile under the file-station folder.
1. Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 FROM golang:alpine LABEL authors=&#34;David&#34; # All the following command will treated as inside this folder of docker WORKDIR /app # copy all the files of our project into the /app folder of docker COPY ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://shaowenzhu.top/post/docker/001-basics/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-10-09T21:09:35+00:00" />
<meta property="article:modified_time" content="2023-10-09T21:09:35+00:00" />
<meta itemprop="name" content="Docker Basic Operations">
<meta itemprop="description" content="Video: https://youtu.be/Ozb9mZg7MVM?si=zFkftI_gXloSrZLh
Assume the Dockerfile under the file-station folder.
1. Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 FROM golang:alpine LABEL authors=&#34;David&#34; # All the following command will treated as inside this folder of docker WORKDIR /app # copy all the files of our project into the /app folder of docker COPY ."><meta itemprop="datePublished" content="2023-10-09T21:09:35+00:00" />
<meta itemprop="dateModified" content="2023-10-09T21:09:35+00:00" />
<meta itemprop="wordCount" content="1493">
<meta itemprop="keywords" content="docker,golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Docker Basic Operations"/>
<meta name="twitter:description" content="Video: https://youtu.be/Ozb9mZg7MVM?si=zFkftI_gXloSrZLh
Assume the Dockerfile under the file-station folder.
1. Dockerfile 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 FROM golang:alpine LABEL authors=&#34;David&#34; # All the following command will treated as inside this folder of docker WORKDIR /app # copy all the files of our project into the /app folder of docker COPY ."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">David&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">David&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Docker Basic Operations</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-10-09 </span>
        <div class="post-category">
            <a href="/categories/docker/"> docker </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-dockerfile">1. Dockerfile</a></li>
        <li><a href="#2-build-image">2. Build image</a></li>
        <li><a href="#3-dockerignore-file">3. <code>.dockerignore</code> File</a></li>
        <li><a href="#4-run-your-image-as-a-container">4. Run your image as a container</a>
          <ul>
            <li><a href="#41-run-container">4.1. Run container</a></li>
            <li><a href="#42-publish-a-port">4.2. Publish a port</a></li>
            <li><a href="#43-run-in-detached-mode">4.3. Run in detached mode</a></li>
            <li><a href="#44-operations-on-containers">4.4. Operations on containers</a></li>
          </ul>
        </li>
        <li><a href="#5-share-your-image">5. Share your image</a></li>
        <li><a href="#6-install-docker-on-ubuntu">6. Install docker on Ubuntu</a></li>
        <li><a href="#7-build-cgo-with-errors">7. Build CGO with errors</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/Ozb9mZg7MVM" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>
<p>Video: <a href="https://youtu.be/Ozb9mZg7MVM?si=zFkftI_gXloSrZLh">https://youtu.be/Ozb9mZg7MVM?si=zFkftI_gXloSrZLh</a></p>
<p>Assume the <code>Dockerfile</code> under the <code>file-station</code> folder.</p>
<h2 id="1-dockerfile">1. Dockerfile</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> golang:alpine</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">LABEL</span> <span class="nv">authors</span><span class="o">=</span><span class="s2">&#34;David&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># All the following command will treated as inside this folder of docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /app</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># copy all the files of our project into the /app folder of docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> ./ ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> go mod download<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Optional:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># To bind to a TCP port, runtime parameters must be supplied to the docker command.</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># But we can document in the Dockerfile what ports</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># the application is going to listen on by default.</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># https://docs.docker.com/engine/reference/builder/#expose</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 8080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># GOOS=linux: set target os to linux</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># CGO_ENABLED=0: CGO is a feature in the Go programming language used for calling C code, </span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># this parameter&#39;s purpose is to disable CGO.</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># &#39;go build -o /server .&#39;: &#39;go build&#39; is a command, &#39;-o /server&#39; output,</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># &#39;.&#39; tells the compiler to build the Go program located in the current directory.</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span> <span class="nv">GOOS</span><span class="o">=</span>linux  go build -o /server .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/server&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>To simplify things, and because this is a simple application, we statically compile the binary by setting <code>CGO_ENABLED=0</code>. This means that the resulting binary will not be linked to any C libraries. If your application uses any system libraries (like the system’s cryptography library) then you will not be able to statically compile the binary like this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker run -p 80:80 shwezhu/file-station:v1
</span></span><span class="line"><span class="cl">2023/10/10 02:06:25 failed to connect database
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">2023/10/10 02:06:25 /app/main.go:12
</span></span><span class="line"><span class="cl"><span class="o">[</span>error<span class="o">]</span> failed to initialize database, got error Binary was compiled with <span class="s1">&#39;CGO_ENABLED=0&#39;</span>, go-sqlite3 requires cgo to work. This is a stub
</span></span></code></pre></td></tr></table>
</div>
</div><p>Source: <a href="https://www.docker.com/blog/containerize-your-go-developer-environment-part-1/">Containerize Your Go Developer Environment - Part 1 | Docker</a></p>
<h2 id="2-build-image">2. Build image</h2>
<p>The <code>docker build</code> command is used to build a Docker image from a Dockerfile and a &ldquo;context&rdquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker build <span class="o">[</span>OPTIONS<span class="o">]</span> PATH <span class="p">|</span> URL <span class="p">|</span> -
</span></span></code></pre></td></tr></table>
</div>
</div><p>The Docker <strong>build context</strong> is the collection of files and directories that will be accessible to the Docker engine when we run <em><code>docker build</code></em>, and anything that is not part of the build context will not be accessible to commands in our <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile</a>.</p>
<p>During the build, those files (build context) are sent to the Docker <strong>daemon</strong> so that the <strong>image</strong> can use them as files. The <strong>build context</strong> is usually at the current folder.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># -t image_name:tag_name</span>
</span></span><span class="line"><span class="cl">$ docker build -t go-learning:1 . 
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>build</code> command optionally takes a <code>--tag</code> or <code>-t</code> flag. This flag is used to label the image with a string value, which is easy for humans to read and recognise. If you do not pass a <code>--tag</code>, Docker will use <code>latest</code> as the default value.</p>
<blockquote>
<p>When use <code>-t</code> with <code>dcoker build</code>  ensure that the <code>FROM</code> instruction in the <em>Dockerfile</em> does not specify the <code>latest</code> tag explicitly. If the FROM instruction is like FROM base_image:latest, it will inherit the &ldquo;latest&rdquo; tag from the base image. Which means <code>-t</code> won&rsquo;t take effect.</p>
</blockquote>
<p>After build image, you can check your images:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker image ls                      
</span></span><span class="line"><span class="cl">REPOSITORY    TAG       IMAGE ID       CREATED          SIZE
</span></span><span class="line"><span class="cl">go-learning   <span class="m">1</span>         5907982380c7   <span class="m">11</span> seconds ago   299MB
</span></span></code></pre></td></tr></table>
</div>
</div><p>Delete your image:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># docker rmi image_name:tage_name</span>
</span></span><span class="line"><span class="cl">$ docker rmi go-learning:1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-dockerignore-file">3. <code>.dockerignore</code> File</h2>
<p>In order to reduce the Docker build context. We can use the <em>.dockerignore</em> file to solve the build context issue.</p>
<p><strong>The Docker CLI searches for a file named *.dockerignore* in the context’s root directory before sending it to the Docker daemon.</strong> In case the file exists, the CLI excludes directories and files that match its patterns. This will prevent large files or sensitive directories from being sent unnecessarily to the Docker daemon.</p>
<p>Here, we’ll add the <em>jdk-8u202-linux-x64.tar.gz</em> file into the <em>.dockerignore</em> file in order to ignore it while creating the build:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;jdk-8u202-linux-x64.tar.gz&#34;</span> &gt; .dockerignoreCopy
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let’s now build the Docker image:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker build -t baeldung  .
</span></span><span class="line"><span class="cl">Sending build context to Docker daemon  178.4MB
</span></span><span class="line"><span class="cl">Step 1/3 : FROM   centos:7
</span></span><span class="line"><span class="cl"> ---&gt; eeb6ee3f44bdCopy
</span></span></code></pre></td></tr></table>
</div>
</div><p>Here, we can clearly see that the Docker build context sent to the Docker daemon has been reduced from <em>372.5MB</em> to <em>178.4MB.</em></p>
<blockquote>
<p>Now you should understand that &ldquo;docker image is built from a <code>Dockerfile</code> and a &ldquo;context&rdquo; &ldquo;.</p>
</blockquote>
<p>Source: <a href="https://www.baeldung.com/ops/docker-reduce-build-context">Reduce Build Context for Docker Build Command | Baeldung</a></p>
<h2 id="4-run-your-image-as-a-container">4. Run your image as a container</h2>
<h3 id="41-run-container">4.1. Run container</h3>
<p>In the previous parts we created a <code>Dockerfile</code> for our example application and then we created our Docker image using the command <code>docker build</code>. Now that we have the image, we can run that image and see if our application is running correctly.</p>
<p>A container is a normal operating system process except that this process is isolated and has its own file system, its own networking, and its own isolated process tree separate from the host.</p>
<p>To run an image inside of a container, we use the <code>docker run</code> command. It requires one parameter and that is the image name. Let’s start our image and make sure it is running correctly. Execute the following command in your terminal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker run go-learning:1
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Note that if you are deploying a web server to a container, you need to publish a port for your container.</p>
</blockquote>
<h3 id="42-publish-a-port">4.2. Publish a port</h3>
<p>To publish a port for our container, we’ll use the <code>--publish</code> flag (<code>-p</code> for short) on the docker run command. The format of the <code>--publish</code> command is <code>[host_port]:[container_port]</code>. So if we wanted to expose port <code>8080</code> inside the container to port <code>3000</code> outside the container, we would pass <code>3000:8080</code> to the <code>--publish</code> flag.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker run -p 80:80 go-learning:1
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is my web server which is listening on port <code>80</code>,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">srv</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">NewServeMux</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="nx">srv</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/&#34;</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprint</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="s">&#34;hello world&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="nx">_</span> <span class="p">=</span> <span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:80&#34;</span><span class="p">,</span> <span class="nx">srv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then when I run my image, I use <code>docker run -p 80:80 go-learning:1</code>, then I can make a http request successfully:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ curl http://localhost:80
</span></span><span class="line"><span class="cl">hello world
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="43-run-in-detached-mode">4.3. Run in detached mode</h3>
<p>This is great so far, but our sample application is a web server and we should not have to have our terminal connected to the container. Docker can run your container in detached mode, that is in the background. To do this, we can use the <code>--detach</code> or <code>-d</code> for short. Docker will start your container the same as before but this time will “detach” from the container and return you to the terminal prompt.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker run -d -p 80:80 go-learning:1
</span></span><span class="line"><span class="cl">0908f98ed45af3f6481e49031a9cc24aa5e7c1bd77a375da07371880812415f6
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="44-operations-on-containers">4.4. Operations on containers</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker ps
</span></span><span class="line"><span class="cl">CONTAINER ID   IMAGE           COMMAND     CREATED          STATUS          PORTS                          NAMES
</span></span><span class="line"><span class="cl">0908f98ed45a   go-learning:1   <span class="s2">&#34;/server&#34;</span>   <span class="m">45</span> seconds ago   Up <span class="m">44</span> seconds   0.0.0.0:80-&gt;80/tcp, 8080/tcp   stupefied_hellman
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker stop stupefied_hellman
</span></span><span class="line"><span class="cl">stupefied_hellman
</span></span></code></pre></td></tr></table>
</div>
</div><p>Source: <a href="https://docs.docker.com/language/golang/run-containers/">https://docs.docker.com/language/golang/run-containers/</a></p>
<h2 id="5-share-your-image">5. Share your image</h2>
<p>Learn more: <a href="https://docs.docker.com/get-started/04_sharing_app/">https://docs.docker.com/get-started/04_sharing_app/</a></p>
<p>Note that the image name should be same to the remote repository, the name of your image should include your docker hub username:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker build -t davidzhu/go-learning:1 . 
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then push:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker push shwezhu/file-station:v1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="6-install-docker-on-ubuntu">6. Install docker on Ubuntu</h2>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04">How To Install and Use Docker on Ubuntu 20.04 | DigitalOcean</a></p>
<p>Then pull the shared repository:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo docker pull davidzhu/file-station:v1
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then run the image in docker container:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo docker run -d -p 80:80 shwezhu/file-station:v1
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="7-build-cgo-with-errors">7. Build CGO with errors</h2>
<p>When run image:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ docker run -p 80:80 shwezhu/file-station:v1
</span></span><span class="line"><span class="cl">2023/10/10 02:15:15 /app/main.go:12
</span></span><span class="line"><span class="cl">[error] failed to initialize database, got error Binary was compiled with &#39;CGO_ENABLED=0&#39;, go-sqlite3 requires cgo to work. This is a stub
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then change the dockerfile above to:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">RUN</span> apk update<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apk add <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  g++ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  git <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  musl-dev <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  go <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  tesseract-ocr-dev<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">1</span> <span class="nv">GOOS</span><span class="o">=</span>linux go build -o /server .<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>...<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Then it works, but because my computer is linux/arm64, and my EC2 server is linux/amd64:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker run -p 80:80 shwezhu/file-station:v1
</span></span><span class="line"><span class="cl">WARNING: The requested image<span class="err">&#39;</span>s platform <span class="o">(</span>linux/arm64<span class="o">)</span> does not match the detected host platform <span class="o">(</span>linux/amd64<span class="o">)</span> and no specific platform was requested
</span></span></code></pre></td></tr></table>
</div>
</div><p>so I need built a linux/amd64 image:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker buildx build --platform linux/amd64 -t shwezhu/file-station:v2 .
</span></span></code></pre></td></tr></table>
</div>
</div><p>Because there is <code>--platform linux/amd64</code>, so you can remove <code>CGO_ENABLED=1 GOOS=linux</code> from <code>RUN CGO_ENABLED=1 GOOS=linux go build -o /server .</code> It takes about 5 mintues to build this image.</p>
<p>Docker images can support multiple platforms, which means that a single image may contain variants for different architectures, and sometimes for different operating systems, such as Windows.</p>
<p>When you run an image with multi-platform support, Docker automatically selects the image that matches your OS and architecture.</p>
<p>Most of the Docker Official Images on Docker Hub provide a <a href="https://github.com/docker-library/official-images#architectures-other-than-amd64">variety of architecturesopen_in_new</a>. For example, the <code>busybox</code> image supports <code>amd64</code>, <code>arm32v5</code>, <code>arm32v6</code>, <code>arm32v7</code>, <code>arm64v8</code>, <code>i386</code>, <code>ppc64le</code>, and <code>s390x</code>. When running this image on an <code>x86_64</code> / <code>amd64</code> machine, the <code>amd64</code> variant is pulled and run.</p>
<p>Learn more:</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">David</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-10-09
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/docker/">docker</a>
          <a href="/tags/golang/">golang</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/golang/advance/011-cross-compilation/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Cross Compilation - Go</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/build-website/007-nginx/">
            <span class="next-text nav-default">Nginx</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:shwezhu@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/shwezhu" class="iconfont icon-twitter" title="twitter"></a>
      <a href="http://localhost:1313" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://github.com/shwezhu" class="iconfont icon-github" title="github"></a>
  <a href="https://shaowenzhu.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>David</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
