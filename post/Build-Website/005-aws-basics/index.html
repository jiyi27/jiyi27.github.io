<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>AWS EC2 - Basic Settings of a Server - David&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="David" /><meta name="description" content="1 2 # Change password of supervisor $ sudo passwd ubuntu 1. Connect to EC2 Instance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ ssh -i aws-key.pem root@your-ec2-ip-address The authenticity of host &amp;#39;xx.xx.xx.xx&amp;#39; can&amp;#39;t be established. ED25519 key fingerprint is SHA256:UULuI08gIJRb&#43;vQnFPpjcSW7hAtLIgf5g. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &amp;#39;xx." />






<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="https://davidzhu.xyz/post/build-website/005-aws-basics/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="AWS EC2 - Basic Settings of a Server" />
<meta property="og:description" content="1 2 # Change password of supervisor $ sudo passwd ubuntu 1. Connect to EC2 Instance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ ssh -i aws-key.pem root@your-ec2-ip-address The authenticity of host &#39;xx.xx.xx.xx&#39; can&#39;t be established. ED25519 key fingerprint is SHA256:UULuI08gIJRb&#43;vQnFPpjcSW7hAtLIgf5g. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;xx." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://davidzhu.xyz/post/build-website/005-aws-basics/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-09-09T15:53:57+00:00" />
<meta property="article:modified_time" content="2023-09-09T15:53:57+00:00" />
<meta itemprop="name" content="AWS EC2 - Basic Settings of a Server">
<meta itemprop="description" content="1 2 # Change password of supervisor $ sudo passwd ubuntu 1. Connect to EC2 Instance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ ssh -i aws-key.pem root@your-ec2-ip-address The authenticity of host &#39;xx.xx.xx.xx&#39; can&#39;t be established. ED25519 key fingerprint is SHA256:UULuI08gIJRb&#43;vQnFPpjcSW7hAtLIgf5g. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;xx."><meta itemprop="datePublished" content="2023-09-09T15:53:57+00:00" />
<meta itemprop="dateModified" content="2023-09-09T15:53:57+00:00" />
<meta itemprop="wordCount" content="665">
<meta itemprop="keywords" content="aws,build website," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AWS EC2 - Basic Settings of a Server"/>
<meta name="twitter:description" content="1 2 # Change password of supervisor $ sudo passwd ubuntu 1. Connect to EC2 Instance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ ssh -i aws-key.pem root@your-ec2-ip-address The authenticity of host &#39;xx.xx.xx.xx&#39; can&#39;t be established. ED25519 key fingerprint is SHA256:UULuI08gIJRb&#43;vQnFPpjcSW7hAtLIgf5g. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added &#39;xx."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">David&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">David&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">AWS EC2 - Basic Settings of a Server</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-09-09 </span>
        <div class="post-category">
            <a href="/categories/build-website/"> build website </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#1-connect-to-ec2-instance">1. Connect to EC2 Instance</a>
          <ul>
            <li><a href="#11-unprotected-private-key-file-error">1.1. “UNPROTECTED PRIVATE KEY FILE!” Error</a></li>
            <li><a href="#12-fix-error">1.2. Fix error</a></li>
            <li><a href="#13-verify">1.3. Verify</a></li>
          </ul>
        </li>
        <li><a href="#2-login">2. Login</a>
          <ul>
            <li><a href="#21-login-without-using-keypairs-from-aws">2.1. Login without using keypairs from aws</a></li>
            <li><a href="#22-recommend-ways">2.2. Recommend ways</a></li>
          </ul>
        </li>
        <li><a href="#3-set-up-oh-my-zsh-shell">3. Set up oh-my-zsh shell</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Change password of supervisor</span>
</span></span><span class="line"><span class="cl">$ sudo passwd ubuntu
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="1-connect-to-ec2-instance">1. Connect to EC2 Instance</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ssh -i aws-key.pem root@your-ec2-ip-address
</span></span><span class="line"><span class="cl">The authenticity of host <span class="s1">&#39;xx.xx.xx.xx&#39;</span> can<span class="s1">&#39;t be established.
</span></span></span><span class="line"><span class="cl"><span class="s1">ED25519 key fingerprint is SHA256:UULuI08gIJRb+vQnFPpjcSW7hAtLIgf5g.
</span></span></span><span class="line"><span class="cl"><span class="s1">This key is not known by any other names
</span></span></span><span class="line"><span class="cl"><span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes 
</span></span></span><span class="line"><span class="cl"><span class="s1">Warning: Permanently added &#39;</span>xx.xx.xx.xx<span class="s1">&#39; (ED25519) to the list of known hosts.
</span></span></span><span class="line"><span class="cl"><span class="s1">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
</span></span></span><span class="line"><span class="cl"><span class="s1">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
</span></span></span><span class="line"><span class="cl"><span class="s1">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
</span></span></span><span class="line"><span class="cl"><span class="s1">Permissions 0644 for &#39;</span>aws-key.pem<span class="err">&#39;</span> are too open.
</span></span><span class="line"><span class="cl">It is required that your private key files are NOT accessible by others.
</span></span><span class="line"><span class="cl">This private key will be ignored.
</span></span><span class="line"><span class="cl">Load key <span class="s2">&#34;aws-key.pem&#34;</span>: bad permissions
</span></span><span class="line"><span class="cl">root@xx.xx.xx.xx: Permission denied <span class="o">(</span>publickey<span class="o">)</span>.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="11-unprotected-private-key-file-error">1.1. “UNPROTECTED PRIVATE KEY FILE!” Error</h3>
<p>The “UNPROTECTED PRIVATE KEY FILE!” error occurs when the permissions on your private key file are too permissive. Specifically, it means that the file is readable and/or writable by other users or processes on your system.</p>
<p>To understand why this is a problem, it’s important to understand how SSH keys work. When you create an SSH key pair, you generate two files: a public key and a private key. <strong>The public key is stored on the Amazon EC2 instance, while the private key is stored on your local machine</strong>.</p>
<p>When you attempt to log in to the Amazon EC2 instance using SSH, your local machine sends a request to the instance. The instance responds by sending a challenge message that can only be decrypted using the private key associated with the public key stored on the instance. If your local machine is able to decrypt the challenge message, then you’re granted access to the instance.</p>
<p>However, if the permissions on your private key file are too permissive, then other users or processes on your system may be able to access the file and use it to decrypt the challenge message. This is a security risk, as it means that your private key is no longer private.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls -all
</span></span><span class="line"><span class="cl">-rw-r--r--@  <span class="m">1</span> David  staff   <span class="m">1674</span>  <span class="m">8</span> Sep 23:54 aws-key.pem
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>The first character &ldquo;-&rdquo; indicates that it is a regular file.</li>
<li>The following three characters &ldquo;rw-&rdquo; represent the owner&rsquo;s permissions: read (r) and write (w) are allowed, while execute (-) permission is not granted.</li>
<li>The next three characters &ldquo;r&ndash;&rdquo; represent the group permissions: only read permission is allowed.</li>
<li>The final three characters &ldquo;r&ndash;&rdquo; represent the permissions for others (users not in the owner or group): only read permission is allowed.</li>
</ul>
<p>Learn more: <a href="https://saturncloud.io/blog/unprotected-private-key-file-error-using-ssh-into-amazon-ec2-instance-aws/#what-causes-the-unprotected-private-key-file-error">https://saturncloud.io/blog/unprotected-private-key-file-error-using-ssh-into-amazon-ec2-instance-aws/#what-causes-the-unprotected-private-key-file-error</a></p>
<h3 id="12-fix-error">1.2. Fix error</h3>
<p>This will change the permissions on the file so that only the owner (i.e., you) can read and write to it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ chmod <span class="m">400</span> aws-key.pem
</span></span><span class="line"><span class="cl">$ ls -all
</span></span><span class="line"><span class="cl">-r--------@  <span class="m">1</span> David  staff   <span class="m">1674</span>  <span class="m">8</span> Sep 23:54 aws-key.pem
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="13-verify">1.3. Verify</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ssh -i aws-key.pem root@xx.xx.xx.xx
</span></span><span class="line"><span class="cl">Please login as the user <span class="s2">&#34;ubuntu&#34;</span> rather than the user <span class="s2">&#34;root&#34;</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ssh -i aws-key.pem ubuntu@xx.xx.xx.xx
</span></span><span class="line"><span class="cl"><span class="c1"># success ...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="2-login">2. Login</h2>
<h3 id="21-login-without-using-keypairs-from-aws">2.1. Login without using keypairs from aws</h3>
<p>Copy your ssh public key on your computer into the <code>~/.ssh/authorized_keys</code> file on you EC2 instance.</p>
<p>On you loacl machine:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cat ~/.ssh/id_rsa.pub 
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Copy the content into your EC2 instance:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo vi .ssh/authorized_keys
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then you can login directly:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ssh ubuntu@xx.xx.xx.xx
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-recommend-ways">2.2. Recommend ways</h3>
<p>Here&rsquo;s what I did on a <code>Ubuntu EC2</code>:</p>
<p><strong>A) Login as root using the keypairs</strong></p>
<p><strong>B) Setup the necessary users and their passwords with</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo adduser USERNAME
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>C) Edit <code>/etc/ssh/sshd_config</code> setting</strong></p>
<p>For a valid user to login with no key:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PasswordAuthentication yes
</span></span></code></pre></td></tr></table>
</div>
</div><p>D) Restart the <code>ssh</code> daemon with</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo service ssh restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>Just change ssh to sshd if you are using centOS, Now you can login into your <code>ec2</code> instance without key pairs.</p>
<blockquote>
<p><strong>NOTE</strong>: you should edit <code>/etc/ssh/sshd_config</code> not <code>/etc/ssh/ssh_config</code> file.</p>
</blockquote>
<p>Difference between these two files:</p>
<p>Source: <a href="https://stackoverflow.com/a/7696451/16317008">https://stackoverflow.com/a/7696451/16317008</a></p>
<h2 id="3-set-up-oh-my-zsh-shell">3. Set up oh-my-zsh shell</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt install zsh -y
</span></span><span class="line"><span class="cl">sh -c <span class="s2">&#34;</span><span class="k">$(</span>wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -<span class="k">)</span><span class="s2">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">David</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2023-09-09
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/aws/">aws</a>
          <a href="/tags/build-website/">build website</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/networking/007-tunneling-protocols/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Tunneling Protocols</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/networking/004-ddos-attack/">
            <span class="next-text nav-default">DDoS Attack</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:shwezhu@qq.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/shwezhu" class="iconfont icon-github" title="github"></a>
  <a href="https://davidzhu.xyz/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>David</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
